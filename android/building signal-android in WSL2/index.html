<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link href=https://phlip9.com/notes/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>building signal-android in WSL2 | philip's notes</title><meta content="a collection of my notes" name=description><link href="https://phlip9.com/notes/android/building signal-android in WSL2/" rel=canonical><meta content=summary name=twitter:card><meta content="building signal-android in WSL2" name=twitter:title><meta content=@phlip9 name=twitter:site><meta content=@phlip9 name=twitter:creator><meta content="building signal-android in WSL2" property=og:title><meta content="a collection of my notes" property=og:description><meta content=article property=og:type><meta content="https://phlip9.com/notes/android/building signal-android in WSL2/" property=og:url><meta content=2024-10-21T04:08:44.978615 property=og:updated_time><meta content="philip's notes" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "/android/building signal-android in WSL2/"
    },
    "headline": "building signal-android in WSL2",
    "image": ,
    "datePublished": "2021-12-15",
    "dateModified": "2024-10-21",
    "author": {
      "@type": "Person",
      "name": "Philip Hayes"
    },
    "publisher": {
      "@type": "Person",
      "name": "Philip Hayes",
      
    },
    "description": "a collection of my notes"
  }
  </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://phlip9.com/notes/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Android",
            "item": "https://phlip9.com/notes/android/"
          },
        
      
        
        
        
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Building Signal Android In Wsl2",
            "item": "https://phlip9.com/notes/android/building signal-android in WSL2/"
          },
        
      
    
  }
</script><meta content=#383866 name=theme-color><link href=https://phlip9.com/notes/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://phlip9.com/notes/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://phlip9.com/notes/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://phlip9.com/notes/site.webmanifest rel=manifest><script>// https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html
        window.MathJax = {
          tex: {
            inlineMath: [
              ['$', '$']
            ],
            displayMath: [
              ['$$', '$$'],
              ['\\[', '\\]']
            ],
            processEscapes: true,
            processEnvironments: true,
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          }
        };</script><script integrity="sha256-z47L98YXVhVIaY0uyDzt675P5Ea+w3RsPh9VD5NuoTY=" async crossorigin=anonymous defer id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js></script><body class="notes single dark"><div class=container role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 notes-sidebar"><nav aria-label="Main navigation" class=notes-links><a class="navbar-brand link-internal" href=https://phlip9.com/notes/> philip's notes </a><a class="notes-link sidebar-social" href=https://twitter.com/phlip9> <svg class="feather feather-twitter" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg> <span class=visually-hidden>Twitter</span> </a><a class="notes-link sidebar-social" href=https://github.com/phlip9> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> <span class=visually-hidden>GitHub</span> </a><a class="notes-link sidebar-social" href=# id=sidebar-open-search> <svg aria-labelledby="title desc" viewbox="0 0 19.9 19.7" fill=none height=20 id=search-icon role=img stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 tabindex=0 width=20 xmlns=http://www.w3.org/2000/svg> <g class=search-path><path d="M18.5 18.3l-5.4-5.4"></path><circle cx=8 cy=8 r=7></circle> </g> </svg> </a><hr><ol id=sidebar-tree-root><li><input id=sidebar-input-ai-ml type=checkbox> <label class=h3 for=sidebar-input-ai-ml>AI ML</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Expectimax Search/"> Expectimax Search </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Markov Decision Process (MDP)/"> Markov Decision Process (MDP) </a></ol><li><input id=sidebar-input-wsl type=checkbox> <label class=h3 for=sidebar-input-wsl>WSL</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/WSL/WSL2 custom kernel/"> WSL2 custom kernel </a></ol><li><li><input checked id=sidebar-input-android type=checkbox> <label class=h3 for=sidebar-input-android>android</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/ADB over TCP inside WSL2/"> ADB over TCP inside WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/OTA updates for rooted android phone/"> OTA updates for rooted android phone </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/android cli setup/"> android cli setup </a><li class=sidebar-note><a class="notes-link link-internal active" href="https://phlip9.com/notes/android/building signal-android in WSL2/"> building signal-android in WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/linux ADB udev setup/"> linux ADB udev setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/root phone with magisk/"> root phone with magisk </a></ol><li><input id=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n type=checkbox> <label class=h3 for=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n>b i g m o n e y l a w r e g u l a t i o n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/financial instituion/"> financial instituion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/foreign bank account report (FBAR)/"> foreign bank account report (FBAR) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/monetary instruments/"> monetary instruments </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/money services business (MSB)/"> money services business (MSB) </a></ol><li><input id=sidebar-input-b-l-o-c-k-c-h-a-i-n type=checkbox> <label class=h3 for=sidebar-input-b-l-o-c-k-c-h-a-i-n>b l o c k c h a i n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/aptos/"> aptos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/bip158 - compact block filters/"> bip158 - compact block filters </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/btc utreexo - utxo accumulator/"> btc utreexo - utxo accumulator </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/fastpay/"> fastpay </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/oasis/"> oasis </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/sui/"> sui </a></ol><li><input id=sidebar-input-btc-ln type=checkbox> <label class=h3 for=sidebar-input-btc-ln>btc-ln</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 11 - invoices/"> BOLT 11 - invoices </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 2 - channel management protocol/"> BOLT 2 - channel management protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 4 - onion routing protocol/"> BOLT 4 - onion routing protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 7 - p2p node and channel discovery/"> BOLT 7 - p2p node and channel discovery </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 8 - secure noise transport/"> BOLT 8 - secure noise transport </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/atomic multipath payments (AMP)/"> atomic multipath payments (AMP) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/breez lightning service providers/"> breez lightning service providers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/hosted channels/"> hosted channels </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning libs/"> lightning libs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning network notes/"> lightning network notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning rod/"> lightning rod </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightningdevkit - rust-lightning/"> lightningdevkit - rust-lightning </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/submarine swaps/"> submarine swaps </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/zero-conf channels/"> zero-conf channels </a></ol><li><input id=sidebar-input-combinatorics type=checkbox> <label class=h3 for=sidebar-input-combinatorics>combinatorics</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/combinatorics/k-combinations of a multiset/"> k-combinations of a multiset </a></ol><li><input id=sidebar-input-confidential-computing type=checkbox> <label class=h3 for=sidebar-input-confidential-computing>confidential computing</label> <ol><li><input id=sidebar-input-confidential-computing-intel-sgx type=checkbox> <label class=h3 for=sidebar-input-confidential-computing-intel-sgx>intel SGX</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/"> SGX lingo </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/overview/"> overview </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/remote attestation/"> remote attestation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/sealing/"> sealing </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/secure time/"> secure time </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/"> enarx (WASM TEE) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/fortanix rust tutorial/"> fortanix rust tutorial </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/gramine/"> gramine </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel TDX/"> intel TDX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/marblerun/"> marblerun </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/mystikos/"> mystikos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/remote attestation protocols/"> remote attestation protocols </a></ol><li><input id=sidebar-input-crypto type=checkbox> <label class=h3 for=sidebar-input-crypto>crypto</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/(talk) authenticated data structures for stateless validation/"> (talk) authenticated data structures for stateless validation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/TLS self-signed pubkey-only certs/"> TLS self-signed pubkey-only certs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/acme protocol/"> acme protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/biscuit authz/"> biscuit authz </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/dex - open-source OIDC & OAuth 2.0 provider/"> dex - open-source OIDC & OAuth 2.0 provider </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/hkdf-sha256/> hkdf-sha256 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/smallstep - private online CA & ACME server/"> smallstep - private online CA & ACME server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/tls exported keying material/"> tls exported keying material </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/zkdocs/> zkdocs </a></ol><li><input id=sidebar-input-design type=checkbox> <label class=h3 for=sidebar-input-design>design</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/design/form design/"> form design </a></ol><li><input id=sidebar-input-devops type=checkbox> <label class=h3 for=sidebar-input-devops>devops</label> <ol><li><input id=sidebar-input-devops-o11y type=checkbox> <label class=h3 for=sidebar-input-devops-o11y>o11y</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/o11y/jaeger oss e2e tracing/"> jaeger oss e2e tracing </a></ol><li><input id=sidebar-input-devops-secrets type=checkbox> <label class=h3 for=sidebar-input-devops-secrets>secrets</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/1password - secrets automation/"> 1password - secrets automation </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/doppler/> doppler </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson (Shopify)/"> ejson (Shopify) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson-kms (AWS)/"> ejson-kms (AWS) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/envkey/> envkey </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/fortanix DSM/"> fortanix DSM </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/mozilla SOPS/"> mozilla SOPS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/sops-nix/> sops-nix </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/sy - share secrets safely/"> sy - share secrets safely </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/AKS - azure kubernetes service/"> AKS - azure kubernetes service </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/algo wireguard VPN server/"> algo wireguard VPN server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/azure CLI/"> azure CLI </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/consul/> consul </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/deployment strategies/"> deployment strategies </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/docker compose/"> docker compose </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/k3s/> k3s </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/kind (kubernetes in docker)/"> kind (kubernetes in docker) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/kubernetes/> kubernetes </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/linkerd/> linkerd </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/minikube/> minikube </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/nomad/> nomad </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/service mesh/"> service mesh </a></ol><li><input id=sidebar-input-distributed-systems type=checkbox> <label class=h3 for=sidebar-input-distributed-systems>distributed systems</label> <ol><li><input id=sidebar-input-distributed-systems-papers type=checkbox> <label class=h3 for=sidebar-input-distributed-systems-papers>papers</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast/"> (2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2021) Leaderless Consensus/"> (2021) Leaderless Consensus </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/the siren song of backpressure/"> the siren song of backpressure </a></ol><li><input id=sidebar-input-fuzzing type=checkbox> <label class=h3 for=sidebar-input-fuzzing>fuzzing</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/fuzzing/bolero - fuzzing + property testing/"> bolero - fuzzing + property testing </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzcheck-rs/> fuzzcheck-rs </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzing/> fuzzing </a></ol><li><input id=sidebar-input-ios type=checkbox> <label class=h3 for=sidebar-input-ios>ios</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/ios/ios setup/"> ios setup </a></ol><li><input id=sidebar-input-keyboards type=checkbox> <label class=h3 for=sidebar-input-keyboards>keyboards</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/keyboards/moergo glove80/"> moergo glove80 </a></ol><li><input id=sidebar-input-lang type=checkbox> <label class=h3 for=sidebar-input-lang>lang</label> <ol><li><input id=sidebar-input-lang-ats type=checkbox> <label class=h3 for=sidebar-input-lang-ats>ATS</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/"> ATS2 Notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/Install ATS2/"> Install ATS2 </a></ol><li><input id=sidebar-input-lang-flutter type=checkbox> <label class=h3 for=sidebar-input-lang-flutter>flutter</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/dart lang/"> dart lang </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/flutter setup/"> flutter setup </a></ol><li><input id=sidebar-input-lang-rust type=checkbox> <label class=h3 for=sidebar-input-lang-rust>rust</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/optimizing binary size/"> optimizing binary size </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rr with rust/"> rr with rust </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust verification tools/"> rust verification tools </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust x SGX/"> rust x SGX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/self-referencing structs/"> self-referencing structs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/sycamore x futures/"> sycamore x futures </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/understanding sycamore reactivity/"> understanding sycamore reactivity </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/gdb ref/"> gdb ref </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/koka-lang/> koka-lang </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/lua/> lua </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/operator fixity and precedence/"> operator fixity and precedence </a></ol><li><input id=sidebar-input-management type=checkbox> <label class=h3 for=sidebar-input-management>management</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/management/relieve often - why generals were more successful in WWII/"> relieve often - why generals were more successful in WWII </a></ol><li><input id=sidebar-input-misc type=checkbox> <label class=h3 for=sidebar-input-misc>misc</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/arm target triples/"> arm target triples </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/envsubst/> envsubst </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/git multirepo to monorepo/"> git multirepo to monorepo </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/kintsugi/> kintsugi </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/optimization solvers/"> optimization solvers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/pop_OS! tweaks/"> pop_OS! tweaks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/prepping RPI for embedded dev/"> prepping RPI for embedded dev </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/rgbxmas/> rgbxmas </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/scanning QR codes on desktop/"> scanning QR codes on desktop </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/setting up a headless raspbian boot image/"> setting up a headless raspbian boot image </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/uptime to downtime conversion/"> uptime to downtime conversion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/water distillation setup/"> water distillation setup </a></ol><li><input id=sidebar-input-networking type=checkbox> <label class=h3 for=sidebar-input-networking>networking</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/networking/CIDR/> CIDR </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/ipv6 address space/"> ipv6 address space </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interface card (NIC)/"> network interface card (NIC) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interfaces/"> network interfaces </a></ol><li><input id=sidebar-input-nvim type=checkbox> <label class=h3 for=sidebar-input-nvim>nvim</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/nvim/universal-ctags Notes/"> universal-ctags Notes </a></ol><li><input id=sidebar-input-performance type=checkbox> <label class=h3 for=sidebar-input-performance>performance</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/bit hacks/"> bit hacks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/dtrace on macOS/"> dtrace on macOS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/performance/profiling/> profiling </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/simdjson talk/"> simdjson talk </a></ol><li><input id=sidebar-input-postgres type=checkbox> <label class=h3 for=sidebar-input-postgres>postgres</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/postgres performance tuning/"> postgres performance tuning </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/postgres/snippets/> snippets </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/types of scans/"> types of scans </a></ol><li><input id=sidebar-input-reproducible-builds type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds>reproducible builds</label> <ol><li><input id=sidebar-input-reproducible-builds-nix type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds-nix>nix</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/links/"> links </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix auto-allocate-uids -> nixbld users/"> nix auto-allocate-uids -> nixbld users </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug broken package build/"> nix debug broken package build </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug spurrious rebuilds/"> nix debug spurrious rebuilds </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/earthly/"> earthly </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/rebuilderd/"> rebuilderd </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/reproducible-builds.org/"> reproducible-builds.org </a></ol><li><input id=sidebar-input-router type=checkbox> <label class=h3 for=sidebar-input-router>router</label> <ol><li><input id=sidebar-input-router-lightning-router type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router>lightning router</label> <ol><li><input id=sidebar-input-router-lightning-router-captive-portal type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router-captive-portal>captive portal</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/RFC 6585 (Additional HTTP Status Codes)/"> RFC 6585 (Additional HTTP Status Codes) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/arubanetworks captive portal/"> arubanetworks captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal/"> captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal (wikipedia)/"> captive portal (wikipedia) </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/lightning router overview/"> lightning router overview </a></ol></ol><li><input id=sidebar-input-statistics-probability type=checkbox> <label class=h3 for=sidebar-input-statistics-probability>statistics probability</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/CDF confidence bands - DKW inequality/"> CDF confidence bands - DKW inequality </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/G-test - multinomial goodness-of-fit/"> G-test - multinomial goodness-of-fit </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/MAD - median absolute deviation/"> MAD - median absolute deviation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/cheat sheet/"> cheat sheet </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/herbie - float error fixer/"> herbie - float error fixer </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/kelly criterion + ELO/"> kelly criterion + ELO </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/multinomial distribution/"> multinomial distribution </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/p-value/"> p-value </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/standard error/"> standard error </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/testing whether a coin is fair/"> testing whether a coin is fair </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/winsorize/"> winsorize </a></ol></ol></nav></div><nav aria-label="Secondary navigation" class="notes-toc d-none d-xl-block col-xl-4"><div class=page-links><h3 class=text-muted>on this page</h3><nav id=table-of-contents><ul><li><a href="https://phlip9.com/notes/android/building signal-android in WSL2/#building-signal-android-in-wsl2" class=link-internal>building signal-android in WSL2</a> <ul><li><a href="https://phlip9.com/notes/android/building signal-android in WSL2/#build" class=link-internal>Build</a><li><a href="https://phlip9.com/notes/android/building signal-android in WSL2/#todo" class=link-internal>TODO</a></ul></ul></nav></div></nav><main class="notes-content tags-content col-lg-11 col-xl-8"><h1 id=building-signal-android-in-wsl2>building signal-android in WSL2</h1><p class=text-muted>2021-12-15 · 8 min read<ul class=tags></ul><p>Be warned, these instructions are more devlog, less polished tutorial.<h2 id=build>Build <a aria-label="anchor link" class=anchor-link href=#build> # </a></h2><ol><li><p>swtich from non-existant motherboard-connected TPM to integrated Intel CPU TPM + restart > BIOS > Advanced\PCH > TPM -> Firmware TPM</p><li><p>Windows PC Health Check says machine meets all requirements, but windows update incorrectly refuses to upgrade + Manually run Windows11 Installation Assistant (https://www.microsoft.com/software-download/windows11)</p><li><p>Windows11 Installation Assistant errors with cryptic error code 0x8007007f + Need to explicitly run as administrator</p><li><p>Update Nvidia GeForce drivers to 510 (https://developer.nvidia.com/cuda/wsl)</p><li><p>Update wsl</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># In Powershell/cmd (run as admin)
</span><span style=color:#bf616a;>$</span><span> wsl</span><span style=color:#bf616a;> --update
</span><span style=color:#bf616a;>$</span><span> wsl</span><span style=color:#bf616a;> --shutdown
</span></code></pre><li><p>test GUI apps (in WSL)</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> sudo apt-get install x11-apps
</span><span style=color:#bf616a;>$</span><span> xcalc
</span></code></pre> <p>This should run an x11 calculator GUI app in windows.</p><li><p>Install android sdks (https://developer.android.com/studio) + Download android studio and extract into <code>~/android-studio</code>.</p> <p>Probably copy these snippets that I have in my <code>~/.bashrc</code></p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># file: ~/.bashrc
</span><span>
</span><span style=color:#65737e;># ..
</span><span>
</span><span style=color:#65737e;># Java SDKMAN
</span><span style=color:#b48ead;>export </span><span style=color:#bf616a;>SDKMAN_DIR</span><span>="$</span><span style=color:#bf616a;>HOME</span><span style=color:#a3be8c;>/.sdkman</span><span>"
</span><span>
</span><span style=color:#65737e;># Android
</span><span style=color:#b48ead;>export </span><span style=color:#bf616a;>ANDROID_SDK_ROOT</span><span>=$</span><span style=color:#bf616a;>HOME</span><span style=color:#a3be8c;>/android
</span><span style=color:#bf616a;>ANDROID_STUDIO</span><span>=$</span><span style=color:#bf616a;>HOME</span><span style=color:#a3be8c;>/android-studio
</span><span style=color:#bf616a;>ANDROID_SDK_VERSION</span><span>=</span><span style=color:#a3be8c;>31.0.0
</span><span style=color:#bf616a;>ANDROID_PATH</span><span>=$</span><span style=color:#bf616a;>ANDROID_SDK_ROOT</span><span style=color:#a3be8c;>/cmdline-tools/latest/bin
</span><span style=color:#bf616a;>ANDROID_PATH</span><span>=$</span><span style=color:#bf616a;>ANDROID_PATH</span><span style=color:#a3be8c;>:</span><span>$</span><span style=color:#bf616a;>ANDROID_SDK_ROOT</span><span style=color:#a3be8c;>/build-tools/</span><span>$</span><span style=color:#bf616a;>ANDROID_SDK_VERSION
</span><span style=color:#bf616a;>ANDROID_PATH</span><span>=$</span><span style=color:#bf616a;>ANDROID_PATH</span><span style=color:#a3be8c;>:</span><span>$</span><span style=color:#bf616a;>ANDROID_SDK_ROOT</span><span style=color:#a3be8c;>/tools
</span><span style=color:#bf616a;>ANDROID_PATH</span><span>=$</span><span style=color:#bf616a;>ANDROID_PATH</span><span style=color:#a3be8c;>:</span><span>$</span><span style=color:#bf616a;>ANDROID_SDK_ROOT</span><span style=color:#a3be8c;>/tools/bin
</span><span style=color:#bf616a;>ANDROID_PATH</span><span>=$</span><span style=color:#bf616a;>ANDROID_PATH</span><span style=color:#a3be8c;>:</span><span>$</span><span style=color:#bf616a;>ANDROID_SDK_ROOT</span><span style=color:#a3be8c;>/platform-tools
</span><span>
</span><span style=color:#65737e;># ..
</span><span>
</span><span style=color:#65737e;># PATH
</span><span style=color:#b48ead;>export </span><span style=color:#bf616a;>PATH</span><span>=$</span><span style=color:#bf616a;>PATH</span><span style=color:#a3be8c;>:</span><span>$</span><span style=color:#bf616a;>ANDROID_PATH
</span><span>
</span><span style=color:#65737e;># ..
</span><span>
</span><span style=color:#65737e;># Java SDKMAN
</span><span style=color:#96b5b4;>[[ </span><span style=color:#bf616a;>-s </span><span>"$</span><span style=color:#bf616a;>HOME</span><span style=color:#a3be8c;>/.sdkman/bin/sdkman-init.sh</span><span>" </span><span style=color:#96b5b4;>]] </span><span>&& </span><span style=color:#96b5b4;>source </span><span>"$</span><span style=color:#bf616a;>HOME</span><span style=color:#a3be8c;>/.sdkman/bin/sdkman-init.sh</span><span>"
</span></code></pre><li><p>Install some missing x11 lib needed to run android studio.</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> sudo apt-get install libxtst6
</span></code></pre><li><p>Install JDK 1.8 (version required by Signal) and JDK 11 (version required by gradle)</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> curl</span><span style=color:#bf616a;> --proto </span><span>'</span><span style=color:#a3be8c;>=https</span><span>'</span><span style=color:#bf616a;> --tlsv1</span><span>.2</span><span style=color:#bf616a;> -sSf </span><span>"</span><span style=color:#a3be8c;>https://get.sdkman.io?rcupdate=false</span><span>" | </span><span style=color:#bf616a;>bash
</span><span style=color:#bf616a;>$</span><span> source </span><span style=color:#bf616a;>~</span><span>/.bashrc
</span><span style=color:#bf616a;>$</span><span> sdk install java 8.0.302-open
</span><span style=color:#bf616a;>$</span><span> sdk install java 11.0.12-open
</span></code></pre><li><p>Open android studio</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$ ~</span><span>/android-studio/bin/studio.sh
</span></code></pre> <p>Ensure you choose the newly installed JDK1.8 when following initial setup.</p> <p>Download generic SDK, SDK v31, and device emulator into <code>$HOME/android</code> directory. My bashrc should already have <code>$PATH</code>s setup for this.</p><li><p>Update android studio plugins. Try building a sample app (I chose Sunflower)</p><li><p>Install additional SDK libs</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> sdkmanager</span><span style=color:#bf616a;> --sdk_root</span><span>="$</span><span style=color:#a3be8c;>{</span><span style=color:#bf616a;>ANDROID_HOME</span><span style=color:#a3be8c;>}</span><span>"</span><span style=color:#bf616a;> --update
</span><span style=color:#bf616a;>$</span><span> sdkmanager</span><span style=color:#bf616a;> --sdk_root</span><span>="$</span><span style=color:#a3be8c;>{</span><span style=color:#bf616a;>ANDROID_HOME</span><span style=color:#a3be8c;>}</span><span>"</span><span style=color:#bf616a;> --install </span><span>\
</span><span>	"</span><span style=color:#a3be8c;>cmdline-tools;latest</span><span>" \
</span><span>	"</span><span style=color:#a3be8c;>extras;google;m2repository</span><span>" \
</span><span>	"</span><span style=color:#a3be8c;>extras;android;m2repository</span><span>" \
</span><span>	"</span><span style=color:#a3be8c;>extras;google;google_play_services</span><span>"
</span></code></pre><li><p>Try building Signal-Android</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> git clone ..
</span><span style=color:#bf616a;>$</span><span> cd Signal-Android
</span><span style=color:#bf616a;>$</span><span> ./gradlew clean assemblePlayProdRelease
</span><span>
</span><span style=color:#bf616a;>$</span><span> cd app/build/outputs/apk/playProd/release/
</span><span style=color:#bf616a;>$</span><span> ls
</span><span style=color:#bf616a;>Signal-Android-play-prod-arm64-v8a-release-unsigned-5.27.13.apk</span><span>    Signal-Android-play-prod-x86-release-unsigned-5.27.13.apk
</span><span style=color:#bf616a;>Signal-Android-play-prod-armeabi-v7a-release-unsigned-5.27.13.apk</span><span>  Signal-Android-play-prod-x86_64-release-unsigned-5.27.13.apk
</span><span style=color:#bf616a;>Signal-Android-play-prod-universal-release-unsigned-5.27.13.apk</span><span>    output-metadata.json
</span><span style=color:#65737e;># Sign apk so we can install
</span><span style=color:#65737e;># Since I already built/installed a sample app, there's already debug
</span><span style=color:#65737e;># keys generated from android studio in `~/.android/debug.keystore`.
</span><span style=color:#65737e;># Note: the default password is "android"
</span><span style=color:#65737e;># EDIT: doesn't work $ jarsigner -verbose -keystore ~/.android/debug.keystore Signal-Android-play-prod-x86_64-release-unsigned-5.27.13.apk androiddebugkey
</span><span style=color:#bf616a;>$</span><span> apksigner sign \
</span><span style=color:#bf616a;>	--verbose </span><span>\
</span><span style=color:#bf616a;>	--v4-signing-enabled </span><span>\
</span><span style=color:#bf616a;>	--ks ~</span><span>/.android/debug.keystore \
</span><span style=color:#bf616a;>	--ks-pass</span><span> pass:android \
</span><span style=color:#bf616a;>	--in</span><span> Signal-Android-play-prod-x86_64-release-unsigned-5.27.13.apk \
</span><span style=color:#bf616a;>	--out</span><span> Signal-Android-play-prod-x86_64-release-signed-5.27.13.apk
</span></code></pre><li><p>Setting up virtual device</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> sudo adduser $</span><span style=color:#bf616a;>USER</span><span> kvm
</span><span>
</span><span style=color:#65737e;># in WSL2 need to do this every restart...
</span><span style=color:#bf616a;>$</span><span> sudo chgrp kvm /dev/kvm && </span><span style=color:#bf616a;>sudo</span><span> chmod g+rw /dev/kvm
</span><span>
</span><span style=color:#65737e;># verify
</span><span style=color:#bf616a;>$</span><span> ls</span><span style=color:#bf616a;> -la</span><span> /dev/kvm
</span><span style=color:#bf616a;>crw-------</span><span> 1 root kvm 10, 232 Dec  8 11:46 /dev/kvm
</span></code></pre> <p>In the IDE AVD Manager, choose an image to download. IDK what is good lmao</p> <p>+If <code>avdmanager list</code> returns <code>Exception .. NoClassDefFoundError .. XmlSchema</code> + Default <code>platform-tools</code> fail when run with java 11 but not java 8 + Works with the <code>cmdline-tools/latest</code> versions. Those are now set higher prio in my <code>$PATH</code></p> <p>Installing random missing dependencies</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> sudo apt-get install libnss3 libxcomposite1
</span></code></pre> <p>can verify kvm should work</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> sudo apt-get install cpu-checker
</span><span style=color:#bf616a;>$</span><span> kvm-ok
</span><span style=color:#bf616a;>INFO:</span><span> /dev/kvm exists
</span><span style=color:#bf616a;>KVM</span><span> acceleration can be used
</span></code></pre> <p>Testing emulator on cli</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># Why does it fail when run outside of this directory?????
</span><span style=color:#bf616a;>$</span><span> cd </span><span style=color:#bf616a;>~</span><span>/android/emulator
</span><span style=color:#bf616a;>$</span><span> ./emulator</span><span style=color:#bf616a;> -avd</span><span> Pixel_2_API_31
</span></code></pre> <p>Holy shit it actually worked lmao. It complains a bit about "nested emulation" not supported well.</p> <p>It's not clear that this made any sort of difference?</p> <pre class=language-toml data-lang=toml style=background-color:#2b303b;color:#c0c5ce;><code class=language-toml data-lang=toml><span style=color:#65737e;># file: /mnt/c/Users/phlip9/.wslconfig
</span><span style=color:#65737e;># Settings apply across all Linux distros running on WSL 2
</span><span>[wsl2]
</span><span style=color:#65737e;># Enable nested virtualization
</span><span style=color:#65737e;># I believe this will improve perf when running an Android emulator inside WSL2?
</span><span style=color:#bf616a;>nestedVirtualization</span><span>=</span><span style=color:#d08770;>true
</span></code></pre> <p>Reporting error connecting to adb daemon on some port 5XXX. Dunno if this is important or not.</p> <p>Successfully ran "Sunflower" sample app on emulator!! :D</p><li><p>Testing Signal-Android on emulator</p> <p>Check that device is visible from <code>adb</code> and we can connect</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> adb devices
</span><span style=color:#bf616a;>List</span><span> of devices attached
</span><span style=color:#bf616a;>emulator-5554</span><span>	device
</span><span>
</span><span style=color:#bf616a;>$</span><span> adb</span><span style=color:#bf616a;> -s</span><span> emulator-5554 shell
</span><span style=color:#bf616a;>emulator64_x86_64_arm64:/</span><span> $ uname</span><span style=color:#bf616a;> -a
</span><span style=color:#bf616a;>Linux</span><span> localhost 5.10.43-android12-9-00031-g02d62d5cece1-ab7792588 </span><span style=color:#65737e;>#1 SMP PREEMPT Mon Oct 4 21:48:11 UTC 2021 x86_64
</span><span>
</span><span style=color:#bf616a;>$</span><span> adb</span><span style=color:#bf616a;> -s</span><span> emulator-5554 install</span><span style=color:#bf616a;> -r</span><span> Signal-Android-play-prod-x86_64-release-signed-5.27.13.apk
</span></code></pre> <p>Run the Signal app</p> <p>It works!! Need working phone SIM I think to get past setup screen...</p><li><p>Setup google voice (https://voice.google.com) number and use it to get past setup screen</p><li><p>Android Studio / IDEA setup for Signal Android</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> cd Signal-Android
</span><span style=color:#65737e;># generates .idea project files
</span><span style=color:#bf616a;>$</span><span> ./gradlew idea
</span></code></pre> <p>Then start Android Studio and open <code>~/dev/Signal-Android</code> project directory.</p> <p>Hit > Load Gradle Project and then > Trust Project</p> <p>Gradle will complain about some partially supported <code>distributionSha256Sum</code> option in <code>gradle-wrapper.properties</code>. Tell it to STFU and keep going (first option).</p> <p>Everything should finish first build successfully.</p><li><p>Understanding Signal build variants</p> <p>In the base <code>build.gradle</code> you can see they define a bunch of different build variants, which end up generating a billion different gradle tasks and really complicating my life.</p> <p>TLDR; target <code>PlayStagingDebug</code></p> <p>AFAICT, there's effectively <code>{ Play, Website, Nightly, Study } x { Prod, Staging } x { Debug, Release, Flipper, Perf, Mock }</code> targets +/- some cases.</p> <p>For developing, I think we want <code>Debug</code>, which uses the debug.keystore for signing (vs actual keys for pushing to Play store).</p> <p>I'm not sure what <code>Study</code> is, maybe a mock UI or something. Probably target <code>Play</code> or <code>Website</code>.</p> <p>It looks like <code>Flipper</code> refers to https://fbflipper.com/ which is some nice app UI/UX debug/development thing. IDK how to use it yet tho.</p> <p>During development, we probably target <code>Staging</code> so don't accidentally fuck up Signal's prod services. You can also see the MobileCoin config switches to testnet on <code>Staging</code> vs <code>Prod</code>. Need to see if hitting <code>Staging</code> works with a real phone #.</p> <p>Building PlayStagingDebug and then installing onto device/emulator:</p> <p>In CLI:</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>./gradlew</span><span> installPlayStagingDebug
</span></code></pre> <p>In IDE:</p> <p>(gradle tasks must be synced) Gradle Tab > Signal > Tasks > install > installPlayStagingDebug</p><li><p>Understanding Android x Gradle</p> <ul><li>When you make changes to any <code>build.gradle</code> or w/e you need to re-sync Gradle in the IDE.<li>I also enabled "update Gradle tasks during sync option" Default project structure:</ul> <p><img src=https://developer.android.com/images/tools/studio/project-structure_2x.png></p> <p><code>Signal-Android/app/src/test</code>: local unit tests. these are actually run on your local machine and must have no dependency on the Android framework (or only mocks).</p> <p><code>Signal-Android/app/src/androidTest</code>: on-device instrumented tests. these tests must run on a device or emulator. they also have an app <code>Context</code> and access to the <code>Instrumentation</code> API for manipulating UIs etc...</p> <p>I'm having a lot of trouble building + deploying to the emulator via the IDE. Dunno if this is some local config/setup issue but for now going to try just doing all build+deploy from the cli.</p> <p>Run local unit tests</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> ./gradlew testPlayStagingDebugUnitTest
</span></code></pre> <p>Run specific test (more filter rules: https://docs.gradle.org/current/userguide/java_testing.html#test_filtering)</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> ./gradlew testPlayStagingDebugUnitTest</span><span style=color:#bf616a;> --tests </span><span>*.myTestMethod
</span></code></pre> <p>Continuously run tests (or any task)</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> ./gradlew</span><span style=color:#bf616a;> --continuous</span><span> testPlayStagingDebugUnitTest
</span></code></pre><li><p>Actually running the unit tests</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> ./gradlew testPlayStagingDebugUnitTest
</span></code></pre> <p>Unfortunately I got like 33 errors initially, claiming the following:</p> <pre style=background-color:#2b303b;color:#c0c5ce;><code><span>org.thoughtcrime.securesms.database.model.GroupsV2UpdateMessageProducerTest > you_requested_to_join_the_group FAILED
</span><span>
</span><span>		java.lang.UnsatisfiedLinkError:
</span><span>			/tmp/resource8597950725831998403.so: /lib/x86_64-linux-gnu/libm.so.6: version 'GLIBC_2.29' not found (required by /tmp/resource8597950725831998403.so)
</span></code></pre> <p>This means the installed libc version is too outdated compared to the compiled library's requirements. In this case, I needed to update Ubuntu from a fairly old version (18.04) to the next LTS (20.04).</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># Confirm that we're on ubuntu 18.04 right now
</span><span style=color:#bf616a;>$</span><span> lsb_release</span><span style=color:#bf616a;> -a
</span><span style=color:#bf616a;>No</span><span> LSB modules are available.
</span><span style=color:#bf616a;>Distributor</span><span> ID: Ubuntu
</span><span style=color:#bf616a;>Description:</span><span>    Ubuntu 18.04.6 LTS
</span><span style=color:#bf616a;>Release:</span><span>        18.04
</span><span style=color:#bf616a;>Codename:</span><span>       bionic
</span><span>
</span><span style=color:#65737e;># For some reason need to do this o/w upgrade silently aborts
</span><span style=color:#bf616a;>$</span><span> sudo apt purge snapd
</span><span>
</span><span style=color:#65737e;># Upgrade and clean up everything before upgrading
</span><span style=color:#bf616a;>$</span><span> sudo apt update
</span><span style=color:#bf616a;>$</span><span> sudo apt list</span><span style=color:#bf616a;> --upgradable
</span><span style=color:#bf616a;>$</span><span> sudo apt upgrade
</span><span style=color:#bf616a;>$</span><span> sudo apt</span><span style=color:#bf616a;> --purge</span><span> autoremove
</span><span>
</span><span style=color:#65737e;># Begin the upgrade
</span><span style=color:#bf616a;>$</span><span> sudo apt install update-manager-core
</span><span style=color:#bf616a;>$</span><span> sudo do-release-upgrade
</span><span>
</span><span style=color:#65737e;># also needed to rebuild tmux after this????
</span></code></pre> <p>After finishing that, all local unit tests completed successfully :^)</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> ./gradlew testPlayStagingDebugUnitTest
</span><span style=color:#65737e;># ..
</span><span style=color:#bf616a;>BUILD</span><span> SUCCESSFUL in 2m 20s
</span><span style=color:#bf616a;>194</span><span> actionable tasks: 186 executed, 8 up-to-date
</span></code></pre><li><p>Deploying to real device</p> <p>First setup <a href=https://phlip9.com/notes/android/ADB%20over%20TCP%20inside%20WSL2/>ADB over TCP inside WSL2</a>, then simply</p> <pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> ./gradlew installPlayStagingDebug
</span></code></pre></ol><h2 id=todo>TODO <a aria-label="anchor link" class=anchor-link href=#todo> # </a></h2><ul><li><input disabled type=checkbox> look into "Configure hardware acceleration for the Android Emulator" (https://developer.android.com/studio/run/emulator-acceleration)</ul></main></div></div></div><form class=d-none id=search-bar><div class=container><div class="row justify-content-center"><div class="col col-lg-11 col-xl-9" id=search-container><input aria-label="Search notes..." class="form-control is-search" placeholder="Search notes..." autocomplete=off id=userinput type=search><div class="shadow rounded" id=suggestions></div></div></div></div></form><script defer src=https://phlip9.com/notes/js/elasticlunr.min.js></script><script defer src=https://phlip9.com/notes/search_index.en.js></script><script defer src=https://phlip9.com/notes/js/search.js></script>