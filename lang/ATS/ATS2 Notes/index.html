<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link href=https://phlip9.com/notes/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>ATS2 Notes | philip's notes</title><meta content="a collection of my notes" name=description><link href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/" rel=canonical><meta content=summary name=twitter:card><meta content="ATS2 Notes" name=twitter:title><meta content=@phlip9 name=twitter:site><meta content=@phlip9 name=twitter:creator><meta content="ATS2 Notes" property=og:title><meta content="a collection of my notes" property=og:description><meta content=article property=og:type><meta content="https://phlip9.com/notes/lang/ATS/ATS2 Notes/" property=og:url><meta content=2024-10-21T04:08:44.990615 property=og:updated_time><meta content="philip's notes" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "/lang/ATS/ATS2 Notes/"
    },
    "headline": "ATS2 Notes",
    "image": ,
    "datePublished": "2022-01-17",
    "dateModified": "2024-10-21",
    "author": {
      "@type": "Person",
      "name": "Philip Hayes"
    },
    "publisher": {
      "@type": "Person",
      "name": "Philip Hayes",
      
    },
    "description": "a collection of my notes"
  }
  </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://phlip9.com/notes/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Lang",
            "item": "https://phlip9.com/notes/lang/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Ats",
            "item": "https://phlip9.com/notes/lang/ATS/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Ats2 Notes",
            "item": "https://phlip9.com/notes/lang/ATS/ATS2 Notes/"
          },
        
      
    
  }
</script><meta content=#383866 name=theme-color><link href=https://phlip9.com/notes/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://phlip9.com/notes/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://phlip9.com/notes/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://phlip9.com/notes/site.webmanifest rel=manifest><script>// https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html
        window.MathJax = {
          tex: {
            inlineMath: [
              ['$', '$']
            ],
            displayMath: [
              ['$$', '$$'],
              ['\\[', '\\]']
            ],
            processEscapes: true,
            processEnvironments: true,
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          }
        };</script><script integrity="sha256-z47L98YXVhVIaY0uyDzt675P5Ea+w3RsPh9VD5NuoTY=" async crossorigin=anonymous defer id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js></script><body class="notes single dark"><div class=container role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 notes-sidebar"><nav aria-label="Main navigation" class=notes-links><a class="navbar-brand link-internal" href=https://phlip9.com/notes/> philip's notes </a><a class="notes-link sidebar-social" href=https://twitter.com/phlip9> <svg class="feather feather-twitter" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg> <span class=visually-hidden>Twitter</span> </a><a class="notes-link sidebar-social" href=https://github.com/phlip9> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> <span class=visually-hidden>GitHub</span> </a><a class="notes-link sidebar-social" href=# id=sidebar-open-search> <svg aria-labelledby="title desc" viewbox="0 0 19.9 19.7" fill=none height=20 id=search-icon role=img stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 tabindex=0 width=20 xmlns=http://www.w3.org/2000/svg> <g class=search-path><path d="M18.5 18.3l-5.4-5.4"></path><circle cx=8 cy=8 r=7></circle> </g> </svg> </a><hr><ol id=sidebar-tree-root><li><input id=sidebar-input-ai-ml type=checkbox> <label class=h3 for=sidebar-input-ai-ml>AI ML</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Expectimax Search/"> Expectimax Search </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Markov Decision Process (MDP)/"> Markov Decision Process (MDP) </a></ol><li><input id=sidebar-input-wsl type=checkbox> <label class=h3 for=sidebar-input-wsl>WSL</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/WSL/WSL2 custom kernel/"> WSL2 custom kernel </a></ol><li><li><input id=sidebar-input-android type=checkbox> <label class=h3 for=sidebar-input-android>android</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/ADB over TCP inside WSL2/"> ADB over TCP inside WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/OTA updates for rooted android phone/"> OTA updates for rooted android phone </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/android cli setup/"> android cli setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/building signal-android in WSL2/"> building signal-android in WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/linux ADB udev setup/"> linux ADB udev setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/root phone with magisk/"> root phone with magisk </a></ol><li><input id=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n type=checkbox> <label class=h3 for=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n>b i g m o n e y l a w r e g u l a t i o n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/financial instituion/"> financial instituion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/foreign bank account report (FBAR)/"> foreign bank account report (FBAR) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/monetary instruments/"> monetary instruments </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/money services business (MSB)/"> money services business (MSB) </a></ol><li><input id=sidebar-input-b-l-o-c-k-c-h-a-i-n type=checkbox> <label class=h3 for=sidebar-input-b-l-o-c-k-c-h-a-i-n>b l o c k c h a i n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/aptos/"> aptos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/bip158 - compact block filters/"> bip158 - compact block filters </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/btc utreexo - utxo accumulator/"> btc utreexo - utxo accumulator </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/fastpay/"> fastpay </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/oasis/"> oasis </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/sui/"> sui </a></ol><li><input id=sidebar-input-btc-ln type=checkbox> <label class=h3 for=sidebar-input-btc-ln>btc-ln</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 11 - invoices/"> BOLT 11 - invoices </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 2 - channel management protocol/"> BOLT 2 - channel management protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 4 - onion routing protocol/"> BOLT 4 - onion routing protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 7 - p2p node and channel discovery/"> BOLT 7 - p2p node and channel discovery </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 8 - secure noise transport/"> BOLT 8 - secure noise transport </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/atomic multipath payments (AMP)/"> atomic multipath payments (AMP) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/breez lightning service providers/"> breez lightning service providers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/hosted channels/"> hosted channels </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning libs/"> lightning libs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning network notes/"> lightning network notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning rod/"> lightning rod </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightningdevkit - rust-lightning/"> lightningdevkit - rust-lightning </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/submarine swaps/"> submarine swaps </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/zero-conf channels/"> zero-conf channels </a></ol><li><input id=sidebar-input-combinatorics type=checkbox> <label class=h3 for=sidebar-input-combinatorics>combinatorics</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/combinatorics/k-combinations of a multiset/"> k-combinations of a multiset </a></ol><li><input id=sidebar-input-confidential-computing type=checkbox> <label class=h3 for=sidebar-input-confidential-computing>confidential computing</label> <ol><li><input id=sidebar-input-confidential-computing-intel-sgx type=checkbox> <label class=h3 for=sidebar-input-confidential-computing-intel-sgx>intel SGX</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/"> SGX lingo </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/overview/"> overview </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/remote attestation/"> remote attestation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/sealing/"> sealing </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/secure time/"> secure time </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/"> enarx (WASM TEE) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/fortanix rust tutorial/"> fortanix rust tutorial </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/gramine/"> gramine </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel TDX/"> intel TDX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/marblerun/"> marblerun </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/mystikos/"> mystikos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/remote attestation protocols/"> remote attestation protocols </a></ol><li><input id=sidebar-input-crypto type=checkbox> <label class=h3 for=sidebar-input-crypto>crypto</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/(talk) authenticated data structures for stateless validation/"> (talk) authenticated data structures for stateless validation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/TLS self-signed pubkey-only certs/"> TLS self-signed pubkey-only certs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/acme protocol/"> acme protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/biscuit authz/"> biscuit authz </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/dex - open-source OIDC & OAuth 2.0 provider/"> dex - open-source OIDC & OAuth 2.0 provider </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/hkdf-sha256/> hkdf-sha256 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/smallstep - private online CA & ACME server/"> smallstep - private online CA & ACME server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/tls exported keying material/"> tls exported keying material </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/zkdocs/> zkdocs </a></ol><li><input id=sidebar-input-design type=checkbox> <label class=h3 for=sidebar-input-design>design</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/design/form design/"> form design </a></ol><li><input id=sidebar-input-devops type=checkbox> <label class=h3 for=sidebar-input-devops>devops</label> <ol><li><input id=sidebar-input-devops-o11y type=checkbox> <label class=h3 for=sidebar-input-devops-o11y>o11y</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/o11y/jaeger oss e2e tracing/"> jaeger oss e2e tracing </a></ol><li><input id=sidebar-input-devops-secrets type=checkbox> <label class=h3 for=sidebar-input-devops-secrets>secrets</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/1password - secrets automation/"> 1password - secrets automation </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/doppler/> doppler </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson (Shopify)/"> ejson (Shopify) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson-kms (AWS)/"> ejson-kms (AWS) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/envkey/> envkey </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/fortanix DSM/"> fortanix DSM </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/mozilla SOPS/"> mozilla SOPS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/sops-nix/> sops-nix </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/sy - share secrets safely/"> sy - share secrets safely </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/AKS - azure kubernetes service/"> AKS - azure kubernetes service </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/algo wireguard VPN server/"> algo wireguard VPN server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/azure CLI/"> azure CLI </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/consul/> consul </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/deployment strategies/"> deployment strategies </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/docker compose/"> docker compose </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/k3s/> k3s </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/kind (kubernetes in docker)/"> kind (kubernetes in docker) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/kubernetes/> kubernetes </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/linkerd/> linkerd </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/minikube/> minikube </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/nomad/> nomad </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/service mesh/"> service mesh </a></ol><li><input id=sidebar-input-distributed-systems type=checkbox> <label class=h3 for=sidebar-input-distributed-systems>distributed systems</label> <ol><li><input id=sidebar-input-distributed-systems-papers type=checkbox> <label class=h3 for=sidebar-input-distributed-systems-papers>papers</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast/"> (2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2021) Leaderless Consensus/"> (2021) Leaderless Consensus </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/the siren song of backpressure/"> the siren song of backpressure </a></ol><li><input id=sidebar-input-fuzzing type=checkbox> <label class=h3 for=sidebar-input-fuzzing>fuzzing</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/fuzzing/bolero - fuzzing + property testing/"> bolero - fuzzing + property testing </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzcheck-rs/> fuzzcheck-rs </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzing/> fuzzing </a></ol><li><input id=sidebar-input-ios type=checkbox> <label class=h3 for=sidebar-input-ios>ios</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/ios/ios setup/"> ios setup </a></ol><li><input id=sidebar-input-keyboards type=checkbox> <label class=h3 for=sidebar-input-keyboards>keyboards</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/keyboards/moergo glove80/"> moergo glove80 </a></ol><li><input checked id=sidebar-input-lang type=checkbox> <label class=h3 for=sidebar-input-lang>lang</label> <ol><li><input checked id=sidebar-input-lang-ats type=checkbox> <label class=h3 for=sidebar-input-lang-ats>ATS</label> <ol><li class=sidebar-note><a class="notes-link link-internal active" href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/"> ATS2 Notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/Install ATS2/"> Install ATS2 </a></ol><li><input id=sidebar-input-lang-flutter type=checkbox> <label class=h3 for=sidebar-input-lang-flutter>flutter</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/dart lang/"> dart lang </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/flutter setup/"> flutter setup </a></ol><li><input id=sidebar-input-lang-rust type=checkbox> <label class=h3 for=sidebar-input-lang-rust>rust</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/optimizing binary size/"> optimizing binary size </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rr with rust/"> rr with rust </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust verification tools/"> rust verification tools </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust x SGX/"> rust x SGX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/self-referencing structs/"> self-referencing structs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/sycamore x futures/"> sycamore x futures </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/understanding sycamore reactivity/"> understanding sycamore reactivity </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/gdb ref/"> gdb ref </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/koka-lang/> koka-lang </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/lua/> lua </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/operator fixity and precedence/"> operator fixity and precedence </a></ol><li><input id=sidebar-input-management type=checkbox> <label class=h3 for=sidebar-input-management>management</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/management/relieve often - why generals were more successful in WWII/"> relieve often - why generals were more successful in WWII </a></ol><li><input id=sidebar-input-misc type=checkbox> <label class=h3 for=sidebar-input-misc>misc</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/arm target triples/"> arm target triples </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/envsubst/> envsubst </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/git multirepo to monorepo/"> git multirepo to monorepo </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/kintsugi/> kintsugi </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/optimization solvers/"> optimization solvers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/pop_OS! tweaks/"> pop_OS! tweaks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/prepping RPI for embedded dev/"> prepping RPI for embedded dev </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/rgbxmas/> rgbxmas </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/scanning QR codes on desktop/"> scanning QR codes on desktop </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/setting up a headless raspbian boot image/"> setting up a headless raspbian boot image </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/uptime to downtime conversion/"> uptime to downtime conversion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/water distillation setup/"> water distillation setup </a></ol><li><input id=sidebar-input-networking type=checkbox> <label class=h3 for=sidebar-input-networking>networking</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/networking/CIDR/> CIDR </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/ipv6 address space/"> ipv6 address space </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interface card (NIC)/"> network interface card (NIC) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interfaces/"> network interfaces </a></ol><li><input id=sidebar-input-nvim type=checkbox> <label class=h3 for=sidebar-input-nvim>nvim</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/nvim/universal-ctags Notes/"> universal-ctags Notes </a></ol><li><input id=sidebar-input-performance type=checkbox> <label class=h3 for=sidebar-input-performance>performance</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/bit hacks/"> bit hacks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/dtrace on macOS/"> dtrace on macOS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/performance/profiling/> profiling </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/simdjson talk/"> simdjson talk </a></ol><li><input id=sidebar-input-postgres type=checkbox> <label class=h3 for=sidebar-input-postgres>postgres</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/postgres performance tuning/"> postgres performance tuning </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/postgres/snippets/> snippets </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/types of scans/"> types of scans </a></ol><li><input id=sidebar-input-reproducible-builds type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds>reproducible builds</label> <ol><li><input id=sidebar-input-reproducible-builds-nix type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds-nix>nix</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/links/"> links </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix auto-allocate-uids -> nixbld users/"> nix auto-allocate-uids -> nixbld users </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug broken package build/"> nix debug broken package build </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug spurrious rebuilds/"> nix debug spurrious rebuilds </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/earthly/"> earthly </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/rebuilderd/"> rebuilderd </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/reproducible-builds.org/"> reproducible-builds.org </a></ol><li><input id=sidebar-input-router type=checkbox> <label class=h3 for=sidebar-input-router>router</label> <ol><li><input id=sidebar-input-router-lightning-router type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router>lightning router</label> <ol><li><input id=sidebar-input-router-lightning-router-captive-portal type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router-captive-portal>captive portal</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/RFC 6585 (Additional HTTP Status Codes)/"> RFC 6585 (Additional HTTP Status Codes) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/arubanetworks captive portal/"> arubanetworks captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal/"> captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal (wikipedia)/"> captive portal (wikipedia) </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/lightning router overview/"> lightning router overview </a></ol></ol><li><input id=sidebar-input-statistics-probability type=checkbox> <label class=h3 for=sidebar-input-statistics-probability>statistics probability</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/CDF confidence bands - DKW inequality/"> CDF confidence bands - DKW inequality </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/G-test - multinomial goodness-of-fit/"> G-test - multinomial goodness-of-fit </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/MAD - median absolute deviation/"> MAD - median absolute deviation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/cheat sheet/"> cheat sheet </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/herbie - float error fixer/"> herbie - float error fixer </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/kelly criterion + ELO/"> kelly criterion + ELO </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/multinomial distribution/"> multinomial distribution </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/p-value/"> p-value </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/standard error/"> standard error </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/testing whether a coin is fair/"> testing whether a coin is fair </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/winsorize/"> winsorize </a></ol></ol></nav></div><nav aria-label="Secondary navigation" class="notes-toc d-none d-xl-block col-xl-4"><div class=page-links><h3 class=text-muted>on this page</h3><nav id=table-of-contents><ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#ats2-notes" class=link-internal>ATS2 notes</a> <ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#syntax" class=link-internal>Syntax</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#staload" class=link-internal>staload</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#dynload" class=link-internal>dynload</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#libraries" class=link-internal>Libraries</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#mutual-recursion" class=link-internal>Mutual Recursion</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#tail-call-optimization" class=link-internal>Tail-call Optimization</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#function-types" class=link-internal>Function Types</a> <ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#syntax-1" class=link-internal>Syntax</a></ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#operators" class=link-internal>Operators</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#local-bindings" class=link-internal>Local Bindings</a> <ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#let" class=link-internal>Let</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#where" class=link-internal>Where</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#local" class=link-internal>Local</a></ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#on-types" class=link-internal>On Types</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#tuples" class=link-internal>Tuples</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#records" class=link-internal>Records</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#sequence-expressions" class=link-internal>Sequence Expressions</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#datatypes" class=link-internal>Datatypes</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#templates" class=link-internal>Templates</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#termination-metric" class=link-internal>Termination Metric</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#case-expressions" class=link-internal>Case Expressions</a> <ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#mutate-in-place-fold" class=link-internal>Mutate In-place (fold@)</a></ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#val-expressions" class=link-internal>Val Expressions</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#templates-1" class=link-internal>Templates</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#polymorphic-functions-datatypes" class=link-internal>Polymorphic Functions/Datatypes</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#references" class=link-internal>References</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#arrays" class=link-internal>Arrays</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#matrices" class=link-internal>Matrices</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#abstract-types" class=link-internal>Abstract Types</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#theorem-proving" class=link-internal>Theorem Proving</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#views" class=link-internal>Views</a> <ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#manipulating-pointers" class=link-internal>Manipulating Pointers</a></ul><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#viewtypes" class=link-internal>Viewtypes</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#l-values-and-call-by-reference" class=link-internal>L-Values and Call-by-Reference</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#stack-allocated-variables" class=link-internal>Stack-Allocated Variables</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#variance-rust" class=link-internal>Variance (Rust)</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#variance-ats" class=link-internal>Variance (ATS)</a><li><a href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/#opt" class=link-internal>opt</a></ul></ul></nav></div></nav><main class="notes-content tags-content col-lg-11 col-xl-8"><h1 id=ats2-notes>ATS2 notes</h1><p class=text-muted>2022-01-17 Â· 17 min read<ul class=tags><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/ats/>#ats</a></ul><h3 id=syntax>Syntax <a aria-label="anchor link" class=anchor-link href=#syntax> # </a></h3><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>abstype</span><span> 			define an abstract </span><span style=color:#b48ead;>type
</span><span>vtypedef
</span><span>viewtypedef 		define a viewtype
</span><span>typedef             define binding b/w name </span><span style=color:#b48ead;>and </span><span style=color:#8fa1b3;>sort</span><span> (eff. an alias)
</span><span>stadef              define _static_ binding b/w name </span><span style=color:#b48ead;>and </span><span style=color:#8fa1b3;>sort
</span><span>
</span><span style=color:#b48ead;>fun </span><span style=color:#8fa1b3;>foo</span><span>(..): res = "</span><span style=color:#a3be8c;>#mac</span><span>"
</span><span>					compile to C function without name mangling? often
</span><span>					seen with `extern` </span><span style=color:#b48ead;>before</span><span> `fun`. is the `extern`
</span><span>					necessary?
</span><span>
</span><span>lam (..): res => expr
</span><span>					an anonymous lambda function
</span><span>
</span><span>fix foo(..): res => </span><span style=color:#b48ead;>val
</span><span>					a recursive, anonymous function named `foo`
</span><span>
</span><span>{...} 				universal quantification
</span><span>[...] 				existential quantification
</span><span>(... | ...) 		(proof | value)
</span><span>@(_, _, ...) 		flat tuple
</span><span>.<...>. 			termination metric
</span><span>
</span><span>@[T][N]     		flat array </span><span style=color:#b48ead;>of</span><span> N values </span><span style=color:#b48ead;>of type</span><span> T
</span><span>@[T][N]()   		array instance
</span><span>@[T][N](x)  		array initialized with N x's
</span><span>
</span><span>sortdef nat = {a: int | a >= </span><span style=color:#d08770;>0</span><span>}
</span><span>
</span><span style=color:#b48ead;>type</span><span>				a sort for w/ machine word size types (boxed types)
</span><span>t@ype 				a sort for unspecified length types (unboxed types)
</span><span>viewtype 			a sort for a linear view + </span><span style=color:#b48ead;>type</span><span> sort
</span><span>viewt@ype           a sort for a linear view + unboxed t@ype sort
</span></code></pre><h3 id=staload>staload <a aria-label="anchor link" class=anchor-link href=#staload> # </a></h3><p>Static load: creates a namespace containing loaded package<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>staload FOO = "</span><span style=color:#a3be8c;>foo.sats</span><span>"
</span><span>
</span><span style=color:#b48ead;>val</span><span> a: $FOO.foo_t = $FOO.A()
</span><span>
</span><span style=color:#65737e;>(* like `use foo::*;` in rust *)
</span><span>staload = "</span><span style=color:#a3be8c;>foo.sats</span><span>"
</span><span>
</span><span style=color:#b48ead;>val</span><span> a: foo_t = A()
</span><span>
</span><span style=color:#65737e;>(* only load package; useful for pulling in DATS file containing *)
</span><span style=color:#65737e;>(* implementations of forward declared fns/types/etc... *)
</span><span>staload _ = "</span><span style=color:#a3be8c;>bar.dats</span><span>"
</span></code></pre><h3 id=dynload>dynload <a aria-label="anchor link" class=anchor-link href=#dynload> # </a></h3><p>TL;DR: if you get a link-time error about some undefined reference to a variable ending in <code>__dynloadflag</code>, you probably need a <code>dynload &LTpkg>.dats</code> somewhere.<h3 id=libraries>Libraries <a aria-label="anchor link" class=anchor-link href=#libraries> # </a></h3><ul><li><code>$PATSHOME/prelude</code>: prelude library targetting C codegen<li><code>$PATSHOME/libats</code>: libats library targetting C codegen</ul><blockquote><p>If a function is implemented as a template, the ATS compiler needs to access the source of the function implementation in order to generate code for each instance call of the function.</blockquote><p>This is why we <code>#include "share/atspre_staload.hats"</code>, which is basically a list of <code>#staload _ = "prelude/DATS/&LTprelude-file>.dats"</code>, pulling in all the template function sources.<h3 id=mutual-recursion>Mutual Recursion <a aria-label="anchor link" class=anchor-link href=#mutual-recursion> # </a></h3><p><code>iseven</code> and <code>isodd</code> are mutually recursive; you need the <code>and</code> keyword before <code>isodd</code> so that it's visible inside <code>isevn</code><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>fun </span><span style=color:#8fa1b3;>isevn</span><span> (n: int): bool =
</span><span>  </span><span style=color:#b48ead;>if</span><span> n > </span><span style=color:#d08770;>0 </span><span style=color:#b48ead;>then</span><span> isodd (n-</span><span style=color:#d08770;>1</span><span>) </span><span style=color:#b48ead;>else </span><span style=color:#d08770;>true
</span><span style=color:#b48ead;>and </span><span style=color:#8fa1b3;>isodd</span><span> (n: int): bool =
</span><span>  </span><span style=color:#b48ead;>if</span><span> n > </span><span style=color:#d08770;>0 </span><span style=color:#b48ead;>then</span><span> isevn (n-</span><span style=color:#d08770;>1</span><span>) </span><span style=color:#b48ead;>else </span><span style=color:#d08770;>false
</span></code></pre><p>ATS won't be able to tail-call optimize the above as-is. instead you need to replace <code>fun</code> with <code>fxn</code> to indicate that the functions need to be combined. Then ATS will place a copy of <code>isodd</code> inside <code>isevn</code>.<h3 id=tail-call-optimization>Tail-call Optimization <a aria-label="anchor link" class=anchor-link href=#tail-call-optimization> # </a></h3><p>A classic list_append that is not tail-recursive<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>fun {a: t@ype} list_append {m, n: nat} (
</span><span>	xs: list(a, m),
</span><span>	ys: list(a, n)
</span><span>) : list(a, m + n) =
</span><span>	</span><span style=color:#b48ead;>case</span><span>+ xs </span><span style=color:#b48ead;>of
</span><span>	| list_nil() => ys
</span><span>	| list_cons(x, xs) => list_cons(x, list_append(xs, ys))
</span></code></pre><p>Translating to a tail-recursive apparently requires "separating" the allocation of the new list element from initiailizing it with x and (inductive step).<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>fun {a: t@ype} list_append2 {m, n: nat} (
</span><span>	xs: list(a, m),
</span><span>	ys: list(a, n)
</span><span>) : list(a, m+n) =
</span><span>	</span><span style=color:#b48ead;>let </span><span style=color:#65737e;>(* tail recursive inner loop *)
</span><span>		</span><span style=color:#b48ead;>fun </span><span style=color:#8fa1b3;>loop</span><span> {m: nat} (
</span><span>			xs: list(a, m),
</span><span>			ys: list(a, n),
</span><span>			res: &ptr? >> list(a, m+n)
</span><span>		) : void =
</span><span>			</span><span style=color:#b48ead;>case</span><span>+ xs </span><span style=color:#b48ead;>of
</span><span>			| list_nil() => res := ys
</span><span>			| list_cons(x, xs1) =>
</span><span>				</span><span style=color:#b48ead;>let </span><span style=color:#65737e;>(* allocate a list node with an _uninitialized_ *)
</span><span>					</span><span style=color:#65737e;>(* tail (hole) *)
</span><span>					</span><span style=color:#b48ead;>val</span><span> () = res := list_cons{a}{</span><span style=color:#d08770;>0</span><span>}(x, _)
</span><span>					</span><span style=color:#65737e;>(* pattern match on res to grab a handle to the *)
</span><span>					</span><span style=color:#65737e;>(* tail *)
</span><span>					</span><span style=color:#b48ead;>val</span><span>+list_cons(_, res1) = res
</span><span>					</span><span style=color:#65737e;>(* recurse, which places xs1 || ys into res1, *)
</span><span>					</span><span style=color:#65737e;>(* which  means res now contains the full xs || ys *)
</span><span>					</span><span style=color:#b48ead;>val</span><span> () = loop(xs1, ys, res1)
</span><span>				</span><span style=color:#b48ead;>in  </span><span style=color:#65737e;>(* folding translates into a no-op at run-time *)
</span><span>					fold@(res)
</span><span>				</span><span style=color:#b48ead;>end
</span><span>		</span><span style=color:#65737e;>(* uninitialized result (stack allocated?) *)
</span><span>		var res: ptr
</span><span>		</span><span style=color:#b48ead;>val</span><span> () = loop (xs, ys, res)
</span><span>  	</span><span style=color:#b48ead;>in</span><span> res
</span><span>	</span><span style=color:#b48ead;>end
</span></code></pre><p>This technique is called "<em>tail-recursion modulo allocation</em>"<p>// TODO: wtf is <code>fold@(_)</code>???<h3 id=function-types>Function Types <a aria-label="anchor link" class=anchor-link href=#function-types> # </a></h3><p>Two kinds of functions in ATS (like Rust), env-less and closure functions.<ul><li>env-less: like a function ptr; doesn't capture any variables in the scope/environment<li>closure: a function ptr + a captured environment (represented as a tuple of values apparently)</ul><h4 id=syntax-1>Syntax <a aria-label="anchor link" class=anchor-link href=#syntax-1> # </a></h4><ul><li>env-less: + <code>(int) -&LTfun1> void</code> + <code>(int) -> void</code> (shorthand)<li>closure: + <code>(int) -&LTcloref1> void</code> + <code>cfun(int, void)</code> (shorthand) (from <code>libats/ML</code>)</ul><h3 id=operators>Operators <a aria-label="anchor link" class=anchor-link href=#operators> # </a></h3><p>Can refer to operator function w/o infix via <code>op</code> keyword, e.g., <code>op+(1,2)</code> vs <code>1 + 2</code>.<h3 id=local-bindings>Local Bindings <a aria-label="anchor link" class=anchor-link href=#local-bindings> # </a></h3><h4 id=let>Let <a aria-label="anchor link" class=anchor-link href=#let> # </a></h4><p>Introduces bindings for use in subsequent bindings and inside the final <code>in .. end</code> expression<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>val</span><span> area =
</span><span>  </span><span style=color:#b48ead;>let
</span><span>    </span><span style=color:#b48ead;>val</span><span> pi = </span><span style=color:#d08770;>3.1415
</span><span>    </span><span style=color:#b48ead;>val</span><span> radius = </span><span style=color:#d08770;>10.0
</span><span>  </span><span style=color:#b48ead;>in
</span><span>    pi * radius * radius
</span><span>  </span><span style=color:#b48ead;>end
</span></code></pre><h4 id=where>Where <a aria-label="anchor link" class=anchor-link href=#where> # </a></h4><p>Introduces bindings inside the expression immediately before <code>where</code><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>val</span><span> area = pi * radius * radius </span><span style=color:#b48ead;>where</span><span> {
</span><span>  </span><span style=color:#b48ead;>val</span><span> pi = </span><span style=color:#d08770;>3.1415
</span><span>  </span><span style=color:#b48ead;>val</span><span> radius = </span><span style=color:#d08770;>10.0
</span><span>}
</span></code></pre><h4 id=local>Local <a aria-label="anchor link" class=anchor-link href=#local> # </a></h4><p>Forms a sequence of declarations rather than an expression at the end<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>local
</span><span>  </span><span style=color:#b48ead;>val</span><span> pi = </span><span style=color:#d08770;>3.1415
</span><span>  </span><span style=color:#b48ead;>val</span><span> radius = </span><span style=color:#d08770;>10.0
</span><span style=color:#b48ead;>in
</span><span>  </span><span style=color:#65737e;>(* visible in the containing scope *)
</span><span>  </span><span style=color:#b48ead;>val</span><span> area = pi * radius * radius
</span><span style=color:#b48ead;>end
</span></code></pre><h3 id=on-types>On Types <a aria-label="anchor link" class=anchor-link href=#on-types> # </a></h3><ul><li>Rather than viewing a type as the set of values it classifies, consider a type as a set of static, semantics meanings.<li>an expression that <em>can be assigned</em> type T has the set of semantics implied by that type.<li>an expression is "well-typed" if <em>there exists</em> a type T that <em>can be assigned</em> to the expression<li>In other words, there can be many types and many different and possibly disjoint static semantics assignable to an expression.<li>In this way, choosing a type for an expression is a statement of which static semantics are important or useful in the current context.</ul><p><strong>Property (Preservation):</strong> Consider an expression <code>expr0</code> which can be assigned type <code>T</code>. If <code>expr1 := eval(expr0)</code>, then <code>expr1</code> can also be assigned type <code>T</code>. In other words, static type meaning is preserved under evaluation.<p><strong>Property (Progress):</strong> Evaluation of an expression always "makes progress" towards a value. In other words, calling <code>eval</code> on an expression (and then on the result and so on) should eventually become a value.<p>I Imagine <em>progress</em> is necessary for the compiler to prove that certain inductive types or recursive functions terminate or become structurally simpler with every inductive step.<h3 id=tuples>Tuples <a aria-label="anchor link" class=anchor-link href=#tuples> # </a></h3><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#65737e;>(* unboxed, flat tuple *)
</span><span style=color:#b48ead;>val</span><span> xy = (</span><span style=color:#d08770;>123</span><span>, "</span><span style=color:#a3be8c;>abc</span><span>")
</span><span style=color:#b48ead;>val</span><span> x = xy</span><span style=color:#d08770;>.0 </span><span style=color:#b48ead;>and </span><span style=color:#8fa1b3;>y</span><span> = xy</span><span style=color:#d08770;>.1
</span><span>
</span><span style=color:#65737e;>(* boxed tuple (ptr sized) *)
</span><span style=color:#b48ead;>val</span><span> zw = '( -</span><span style=color:#d08770;>1.0</span><span>, "</span><span style=color:#a3be8c;>foo</span><span>")
</span><span style=color:#b48ead;>val</span><span> z = zw</span><span style=color:#d08770;>.0 </span><span style=color:#b48ead;>and </span><span style=color:#8fa1b3;>w</span><span> = zw</span><span style=color:#d08770;>.1
</span></code></pre><p>Note that the space b/w <code>'(</code> and <code>-1.0</code> is required for boxed tuples. Tuples are also sometimes written with <code>@</code> in front like <code>@("foo", 123)</code><h3 id=records>Records <a aria-label="anchor link" class=anchor-link href=#records> # </a></h3><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#65737e;>(* unboxed record *)
</span><span>typedef point2D = @{
</span><span>  x = double,
</span><span>  y = double
</span><span>}
</span><span>
</span><span style=color:#b48ead;>val</span><span> origin = @{ x = </span><span style=color:#d08770;>0.0</span><span>, y = </span><span style=color:#d08770;>0.0</span><span> } : point2D
</span><span>
</span><span style=color:#b48ead;>val</span><span> x = origin.x </span><span style=color:#b48ead;>and </span><span style=color:#8fa1b3;>y</span><span> = origin.y
</span><span>
</span><span style=color:#b48ead;>val</span><span> @{ x = x, y = y } = origin
</span><span>
</span><span style=color:#b48ead;>val</span><span> @{ y = y, ... } = origin
</span><span>
</span><span style=color:#65737e;>(* boxed record *)
</span><span>typedef point2D = '{
</span><span>  x = double,
</span><span>  y = double
</span><span>}
</span></code></pre><h3 id=sequence-expressions>Sequence Expressions <a aria-label="anchor link" class=anchor-link href=#sequence-expressions> # </a></h3><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>(
</span><span>  print 'Hi'; </span><span style=color:#65737e;>(* return value must be void *)
</span><span>  </span><span style=color:#d08770;>123</span><span> + </span><span style=color:#d08770;>456 </span><span style=color:#65737e;>(* result of expression is result of whole block *)
</span><span>) </span><span style=color:#65737e;>(* has type int *)
</span><span>
</span><span style=color:#65737e;>(* can also use begin .. end *)
</span><span>begin
</span><span>  print 'Hi';
</span><span>  </span><span style=color:#d08770;>123</span><span> + </span><span style=color:#d08770;>456
</span><span style=color:#b48ead;>end
</span><span>
</span><span style=color:#65737e;>(* or let .. in .. end *)
</span><span style=color:#b48ead;>let
</span><span>  </span><span style=color:#b48ead;>val</span><span> () = print 'Hi'
</span><span>  </span><span style=color:#b48ead;>val</span><span> () = print 'asdf'
</span><span style=color:#b48ead;>in
</span><span>  </span><span style=color:#d08770;>123</span><span> + </span><span style=color:#d08770;>456
</span><span style=color:#b48ead;>end
</span></code></pre><h3 id=datatypes>Datatypes <a aria-label="anchor link" class=anchor-link href=#datatypes> # </a></h3><p>datatypes == garbage collectable objects?<p>seem to be auto boxed<h3 id=templates>Templates <a aria-label="anchor link" class=anchor-link href=#templates> # </a></h3><p>templates are bound via first-find rather than best-find<h3 id=termination-metric>Termination Metric <a aria-label="anchor link" class=anchor-link href=#termination-metric> # </a></h3><p><code>.&LTexpr>.</code> in function signature tells that compiler that <code>expr</code> must be strictly decreasing on each function call<h3 id=case-expressions>Case Expressions <a aria-label="anchor link" class=anchor-link href=#case-expressions> # </a></h3><p>TL;DR: prefer <code>case+</code> and <code>val+</code> in almost all cases to mandate exhaustive pattern matches everywhere.<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>dataviewtype int_list_vt =
</span><span>  | nil_vt </span><span style=color:#b48ead;>of</span><span> ()
</span><span>  | cons_vt </span><span style=color:#b48ead;>of</span><span> (int, int_list_vt)
</span><span>
</span><span>// xs: int_list_vt
</span><span>// ~ is for freeing linear int_list_vt resource
</span><span style=color:#b48ead;>case</span><span> xs </span><span style=color:#b48ead;>of
</span><span>  | ~nil_vt() => ..
</span><span>  | ~cons_vt(_, xs) => ..
</span><span>
</span><span>// just plain `</span><span style=color:#b48ead;>case</span><span>` with non-exhaustive pattern
</span><span>// ==> WARNING: pattern match is non-exhaustive
</span><span style=color:#b48ead;>case</span><span> xs </span><span style=color:#b48ead;>of
</span><span>  | ~nil_vt() => ..
</span><span>
</span><span>// `</span><span style=color:#b48ead;>case</span><span>+` with non-exhaustive pattern
</span><span>// ==> ERROR: pattern match is non-exhaustive
</span><span style=color:#b48ead;>case</span><span>+ xs </span><span style=color:#b48ead;>of
</span><span>  | ~nil_vt() => ..
</span><span>
</span><span>// `</span><span style=color:#b48ead;>case</span><span>-` with non-exhaustive pattern means:
</span><span>// "</span><span style=color:#a3be8c;>ignore this problem compiler, I know what I'm doing : )</span><span>"
</span><span style=color:#b48ead;>case</span><span>- xs </span><span style=color:#b48ead;>of
</span><span>  | ~nil_vt() => ..
</span><span>
</span><span>// you can also add pattern guard conditions
</span><span style=color:#b48ead;>case</span><span> xs </span><span style=color:#b48ead;>of
</span><span>  | ~cons_vt(x, xs) when x < </span><span style=color:#d08770;>10</span><span> => ..
</span></code></pre><p>One detail to note is that while matching happens sequentially at <em>runtime</em>, typechecking of <code>case</code> clauses actually happens non-deterministically.<p>You can force a pattern to typecheck sequentially by using <code>=>></code>. For example, this won't typecheck w/o using <code>=>></code>:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>fun {T, U: t@ype} {V: t@ype}
</span><span>list_zipwith {n: nat} (
</span><span>  xs1: list (T, n),
</span><span>  xs2: list (U, n),
</span><span>  f: (T, U) -&LTcloref1> V
</span><span>) : list (V, n) =
</span><span>  </span><span style=color:#b48ead;>case</span><span>+ (xs1, xs2) </span><span style=color:#b48ead;>of
</span><span>  | (list_cons (x1, xs1), list_cons (x2, xs2)) =>
</span><span>      list_cons (f (x1, x2), list_zipwith (xs1, xs2, f))
</span><span>  | (_, _) =>> list_nil ()
</span></code></pre><h4 id=mutate-in-place-fold>Mutate In-place (fold@) <a aria-label="anchor link" class=anchor-link href=#mutate-in-place-fold> # </a></h4><p>Let's say we're matching on a linear list <code>list_vt</code> and want to modify the entry <em>in-place</em>. We don't to be free'ing and alloc'ing garbage cons nodes just to change the entry.<p>(ERROR) For example, we might try to do this first:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>fun </span><span style=color:#8fa1b3;>list_vt_add1</span><span> {n: nat} (xs: !list_vt(int, n)): void =
</span><span>	</span><span style=color:#b48ead;>case</span><span>+ xs </span><span style=color:#b48ead;>of
</span><span>	| cons_vt(x, xs1) =>
</span><span>		</span><span style=color:#b48ead;>let
</span><span>		  // ERROR: an l-value is required
</span><span>		  </span><span style=color:#b48ead;>val</span><span> () = x := x + </span><span style=color:#d08770;>1
</span><span>		</span><span style=color:#b48ead;>in
</span><span>		  // ..
</span><span>		</span><span style=color:#b48ead;>end
</span><span>	| nil_vt() => // ..
</span></code></pre><p>Since <code>x</code> and <code>xs1</code> are only treadted as <em>values</em> when we use a plain pattern (i.e., not an l-value) and are not allowed to be modified into other values or types.<p>(CORRECT) Instead, the right syntax here looks like this:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>fun </span><span style=color:#8fa1b3;>list_vt_add1</span><span> {n: nat} (xs: !list_vt(int, n)): void =
</span><span>	</span><span style=color:#b48ead;>case</span><span>+ xs </span><span style=color:#b48ead;>of
</span><span>//    .----- this is important
</span><span>//    v
</span><span>	| @cons_vt(x, xs1) =>
</span><span>		</span><span style=color:#b48ead;>let
</span><span>		  // CORRECT
</span><span>		  </span><span style=color:#b48ead;>val</span><span> () = x := x + </span><span style=color:#d08770;>1
</span><span>		  prval () = fold@(xs) // &LT--- this is important
</span><span>		</span><span style=color:#b48ead;>in
</span><span>		  // ..
</span><span>		</span><span style=color:#b48ead;>end
</span><span>	| nil_vt() => // ..
</span></code></pre><p>The <code>@</code> in the pattern <em>unfolds</em> the dataviewtype variant, which binds <code>x</code> and <code>xs1</code> to <em>pointers</em> to each field. This <code>@</code> binding also implicitly view-changes <code>xs</code> to viewtype <code>list_vt_cons_unfold(l_0, l_1, l_2)</code>. These <code>*_unfold(l_0, ..)</code> viewtype definitions an autogenerated for all dataviewtype variants, where <code>l_0</code> points to the outer dataviewtype and <code>l_i</code> points to field_i, where field_1 is the first field.<p>After modifying <code>x</code> in the above let-block, notice that we also need this <code>fold@(xs)</code> proof statement. This built-in proof function "folds" the <code>xs: list_vt_cons_unfold(l_0, l_1, l_2)</code> back into a <code>list_vt</code>.<h3 id=val-expressions>Val Expressions <a aria-label="anchor link" class=anchor-link href=#val-expressions> # </a></h3><p>Just like <code>case</code>/<code>case+</code>/<code>case-</code>, you can pattern match in <code>val</code> expressions with exhaustiveness or not.<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>// ==> WARNING: non-exhaustive
</span><span style=color:#b48ead;>val</span><span> ~cons_vt(x, xs1) = xs
</span><span>
</span><span>// ==> ERROR: non-exhaustive
</span><span style=color:#b48ead;>val</span><span>+~const_vt(x, xs1) = xs
</span><span>
</span><span>// silent : )
</span><span style=color:#b48ead;>val</span><span>-~cons_vt(x, xs1) = xs
</span></code></pre><h3 id=templates-1>Templates <a aria-label="anchor link" class=anchor-link href=#templates-1> # </a></h3><p>templates are monomorphized at compile time<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>fun {a,b: t@ype} swap(xy: (a, b)): (b, a) =
</span><span>  (xy</span><span style=color:#d08770;>.1</span><span>, xy</span><span style=color:#d08770;>.0</span><span>)
</span></code></pre><p>Note: the template parameters come <em>before</em> the function name<p><code>{a,b: t@ype}</code> are the template parameters<p><code>t@ype</code>: a sort for static terms representing size-unspecified (== unsized?) types <code>type</code>: machine word-sized types (usually boxed types)<h3 id=polymorphic-functions-datatypes>Polymorphic Functions/Datatypes <a aria-label="anchor link" class=anchor-link href=#polymorphic-functions-datatypes> # </a></h3><p>polymorphic functions/datatypes allow for dynamic dispatch. obv. polymorphic functions/datatypes are <em>not</em> monomorphized.<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>fun </span><span style=color:#8fa1b3;>swap_boxed</span><span> {T: </span><span style=color:#b48ead;>type</span><span>}{U: </span><span style=color:#b48ead;>type</span><span>} (xy: (T, U)): (U, T) =
</span><span>	(xy</span><span style=color:#d08770;>.1</span><span>, xy</span><span style=color:#d08770;>.0</span><span>)
</span></code></pre><p>Note: the polymorphic parameters come <em>after</em> the function name<p>Note: if we used <code>t@ype</code> here, we would get a C compiler error (not a typechecking error!) since the arguments have unspecified size.<h3 id=references>References <a aria-label="anchor link" class=anchor-link href=#references> # </a></h3><p>references in ATS are just heap allocated boxed values. they're really only useful in GC'd programs or as top-level program state since you need to manually free them (no linearity assistance).<p>the key interface is<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>val</span><span> int_ref = </span><span style=color:#b48ead;>ref</span><span>&LTint>(</span><span style=color:#d08770;>123</span><span>)
</span><span style=color:#b48ead;>val</span><span> () = !int_ref := </span><span style=color:#d08770;>69
</span><span style=color:#b48ead;>val</span><span> () = println!("</span><span style=color:#a3be8c;>int_ref = </span><span>", !int_ref)
</span><span>// > int_ref = </span><span style=color:#d08770;>69
</span></code></pre><h3 id=arrays>Arrays <a aria-label="anchor link" class=anchor-link href=#arrays> # </a></h3><p>There are a few "variants" of arrays<ul><li><code>array</code>: (TODO) static stack allocated array?<li><code>array_v</code>: (TODO) array view?<li><code>arrayptr</code>: (TODO): linear?<li><code>arrayref</code>: GC'd array reference (w/o size <em>attached</em>)<li><code>arrayszref</code>: GC'd array reference (with size attached, like a fat pointer)</ul><p>usage:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span style=color:#b48ead;>val</span><span> size = g0int2uint_int_size(</span><span style=color:#d08770;>10</span><span>)
</span><span style=color:#b48ead;>val</span><span> xs = arrszref_make_elt(size, </span><span style=color:#d08770;>42069</span><span>)
</span><span style=color:#b48ead;>val</span><span> x_3 = xs[</span><span style=color:#d08770;>3</span><span>]
</span><span style=color:#b48ead;>val</span><span> () = xs[</span><span style=color:#d08770;>4</span><span>] := </span><span style=color:#d08770;>123
</span></code></pre><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>
</span></code></pre><h3 id=matrices>Matrices <a aria-label="anchor link" class=anchor-link href=#matrices> # </a></h3><p>Note: row-major layout! (rather than column-major like C)<ul><li><code>matrixptr</code><li><code>matrixref</code><li><code>mtrxszref</code></ul><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>postfix sz
</span><span>#define sz(x) g0int2uint_int_size(x)
</span><span>
</span><span style=color:#b48ead;>val</span><span> X = mtrxszref_make_elt(10sz </span><span style=color:#65737e;>(*nrow*)</span><span>, 5sz </span><span style=color:#65737e;>(*ncol*)</span><span>, </span><span style=color:#d08770;>0 </span><span style=color:#65737e;>(*fill*)</span><span>)
</span><span style=color:#b48ead;>val</span><span> X_ij = X[i,j]
</span><span style=color:#b48ead;>val</span><span> () = X[i,j] := </span><span style=color:#d08770;>123
</span></code></pre><h3 id=abstract-types>Abstract Types <a aria-label="anchor link" class=anchor-link href=#abstract-types> # </a></h3><p>Types w/ encapsulation, i.e., structure is not visible to the user<p><code>abstype</code>: boxed abstract type (pointer-sized)<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>// declares abstract boxed intset </span><span style=color:#b48ead;>type of</span><span> size ptr
</span><span style=color:#b48ead;>abstype</span><span> intset = ptr
</span></code></pre><p><code>abst@ype</code>: unboxed abstract type<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>// declares abstract unboxed rational </span><span style=color:#b48ead;>type of</span><span> size </span><span style=color:#d08770;>2</span><span>*sizeof(int)
</span><span>abst@ype rational = (int, int)
</span></code></pre><p>Use <code>assume</code> to "concretize" the abstract type. This can happen at-most-once, globally.<p><code>assume my_abstract_type = my_concrete_type</code><h3 id=theorem-proving>Theorem Proving <a aria-label="anchor link" class=anchor-link href=#theorem-proving> # </a></h3><ul><li>ATS/LF component supports interactive theorem proving</ul><p><code>prop</code>: a builtin <code>sort</code> representing all proof types <code>dataprop</code>: a <code>prop</code> type declared in a manner similar to <code>datatype</code> defs.<p>A <code>dataprop</code> representing the fibonnacci relation <code>fib(n) = r</code><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>dataprop FIB(int, int) =
</span><span>  | FIB0(</span><span style=color:#d08770;>0</span><span>, </span><span style=color:#d08770;>0</span><span>) </span><span style=color:#b48ead;>of</span><span> ()
</span><span>  | FIB1(</span><span style=color:#d08770;>1</span><span>, </span><span style=color:#d08770;>1</span><span>) </span><span style=color:#b48ead;>of</span><span> ()
</span><span>  | {n: nat} {r0, r1: int} FIB2(n+</span><span style=color:#d08770;>2</span><span>, r0+r1) </span><span style=color:#b48ead;>of</span><span> (FIB(n, r0), FIB(n+</span><span style=color:#d08770;>1</span><span>, r1))
</span></code></pre><p>The <code>sort</code> assigned to <code>FIB</code> is <code>(int, int) -> prop</code>, i.e., <code>FIB</code> takes two <code>int</code>s and returns a proof. <code>FIB0</code> and <code>FIB1</code> constructors both take <code>()</code> and return a proof.<p>A dataprop for multiplication:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>// int * int = int
</span><span>dataprop MUL(int, int, int) =
</span><span>  // </span><span style=color:#d08770;>0</span><span> * n = </span><span style=color:#d08770;>0
</span><span>  | {n: int} MULbase(</span><span style=color:#d08770;>0</span><span>, n, </span><span style=color:#d08770;>0</span><span>) </span><span style=color:#b48ead;>of</span><span> ()
</span><span>  // (m+</span><span style=color:#d08770;>1</span><span>) * n = m*n + n
</span><span>  | {m: nat}{n: int}{p: int} MULind(m+</span><span style=color:#d08770;>1</span><span>, n, p+n) </span><span style=color:#b48ead;>of</span><span> MUL(m, n, p)
</span><span>  // (-m) * n = -(m * n)
</span><span>  | {m: pos}{n: int}{p: int} MULneg(~(m), n, ~(p)) </span><span style=color:#b48ead;>of</span><span> MUL(m, n, p)
</span></code></pre><p>To prove this relation, we want to construct values of <code>MUL</code> for each parameter. The most common way to do this is to construct a total function over all parameters:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>// â m â â, n â â¤, â p â â¤ : m * n = p
</span><span>prfun mul_nat_is_total {m: nat; n: int} .&LTm>. (): [p: int] MUL(m, n, p) =
</span><span>  sif m == </span><span style=color:#d08770;>0 </span><span style=color:#b48ead;>then
</span><span>    MULbas()
</span><span>  </span><span style=color:#b48ead;>else
</span><span>    MULind(mul_nat_is_total{m-</span><span style=color:#d08770;>1</span><span>, n}())
</span><span>
</span><span>// â m, n â â¤, â p â â¤ : m * n = p
</span><span>prfn mul_is_total {m, n: int} (): [p: int] MUL(m, n, p) =
</span><span>  sif m >= </span><span style=color:#d08770;>0 </span><span style=color:#b48ead;>then
</span><span>    mul_nat_is_total{m, n}()
</span><span>  </span><span style=color:#b48ead;>else
</span><span>    MULneg(mul_nat_is_total{~m, n}())
</span></code></pre><p>Note: the second proof function uses <code>prfn</code> rather than <code>prfun</code> for a specific reason: <code>prfun</code>s define recursive proof functions and thus require a termination metric. <code>prfn</code>s must be non-recursive and therefore don't need a termination metric.<p><code>datasort</code>: like a <code>datatype</code> but static. doesn't support any dependent type stuff i think. you must also use <code>scase</code> instead of <code>case</code> to match on <code>datasort</code>s.<p>Q: what is the difference b/w a <code>dataprop</code> and a <code>datasort</code>??<h3 id=views>Views <a aria-label="anchor link" class=anchor-link href=#views> # </a></h3><p>A <code>view</code> is a <em>linear</em> <code>prop</code> (linear as in must consume exactly once). <code>view</code>s power ATS's pointer ownership checking.<p>For example, an owned pointer with a view to an <code>a</code> at location <code>l</code> looks like<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>{a: t@ype} {l: addr} (pf: a @ l | p: ptr l)
</span></code></pre><p>or a maybe uninitialized <code>a</code><p><code>(pf: a? @ l | p: ptr l)</code><p>While managing these linear <code>view</code>s <em>can</em> be done by threading the proofs through the in-params and out-params of each function, ATS provides a convenient syntactic sugar for modifying the <code>view</code> <em>in-place</em>. Consider the <code>ptr_set</code> function:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>fun {a: t@ype} ptr_set {l: addr} (
</span><span>  pf: !a? @ l >> a @ l
</span><span>| p: ptr l,
</span><span>  x: a
</span><span>): void
</span></code></pre><p>We can read the <code>pf</code> as "the function takes a proof of a maybe-uninit <code>a</code> at location <code>l</code> and will modify this proof (in the caller's context) to a definitely-init <code>a</code> at location <code>l</code>".<p>In general, the format looks like <code>!V >> V'</code> to mean that the function changes the view <code>V</code> to <code>V'</code> upon its return. If <code>V = V'</code>, then you can just write <code>!V</code> or <code>!V >> _</code> (TODO: what does this mean? does typechecker fill the hole?).<h4 id=manipulating-pointers>Manipulating Pointers <a aria-label="anchor link" class=anchor-link href=#manipulating-pointers> # </a></h4><p>Manually pass the proof in and out:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>// (pf: a @ l | p: ptr l)
</span><span style=color:#b48ead;>val</span><span> x = ptr_get&LTint>(pf | p)
</span><span style=color:#b48ead;>val</span><span> () = ptr_set&LTint>(pf | p, </span><span style=color:#d08770;>123</span><span>)
</span></code></pre><p>Or use the pointer syntax:<pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>// these modify pf </span><span style=color:#b48ead;>in</span><span>-place
</span><span style=color:#b48ead;>val</span><span> x = !p
</span><span style=color:#b48ead;>val</span><span> () = !p := </span><span style=color:#d08770;>123
</span></code></pre><h3 id=viewtypes>Viewtypes <a aria-label="anchor link" class=anchor-link href=#viewtypes> # </a></h3><p><code>viewtypes</code> are linear types in ATS. The name <code>view</code> + <code>type</code> suggests that a <code>viewtype</code> consists of a linear view <code>V</code> and type <code>T</code>. Usually we refer to viewtypes by their definition <code>VT</code> but you can actually split viewtypes into their component view <code>V</code> and type <code>T</code> (via pattern matching.)<ul><li><p>This interpretation of a <code>VT</code> as a <code>(V | T)</code> could be thought of as encumbering a concrete, runtime value of type <code>T</code> with a linear tag <code>V</code> (which can also assert other properties ofc).</p><li><p>Given the viewtype <code>VT</code> we can compactly refer to the type portion by the syntax <code>VT?!</code></p><li><p><code>viewtype</code> and <code>viewt@ype</code> are two sorts with the type portion in sorts <code>type</code> and <code>t@ype</code> resp.</p></ul><p>http://blog.vmchale.com/article/ats-linear https://bluishcoder.co.nz/2011/04/25/sharing-linear-resources-in-ats.html<h3 id=l-values-and-call-by-reference>L-Values and Call-by-Reference <a aria-label="anchor link" class=anchor-link href=#l-values-and-call-by-reference> # </a></h3><ul><li>An l-value is a pointer and linear at-view proof / "value + address"<li>Like C/C++, l-values can appear on the left-hand side of assignments<li>Simplest l-value is <code>!p</code> where <code>p</code> is a <code>ptr l</code>. the typechecker must also find an at-view proof <code>a @ l</code> somewhere in the context.<li>Normally, ATS uses call-by-value; however, you can pass l-values by reference. When this happens, the address (and not the value) is passed.<li>Function can take reference with <code>&</code> like <code>fun foo(x: &a)</code>. Note that you <em>don't</em> use <code>!</code> to deref or assign, just the plain <code>x</code>.</ul><h3 id=stack-allocated-variables>Stack-Allocated Variables <a aria-label="anchor link" class=anchor-link href=#stack-allocated-variables> # </a></h3><ul><li>Use <code>var x: T</code> to declare uninit stack variable or <code>var y: T = val</code> to init with <code>val</code>.<li>Use <code>view@(x)</code> to get the view-type at the location inside <code>x</code><li>Use <code>addr@(x)</code> to get the location that <code>x</code> points to.<li>Interestingly, you can see the the uninit decl. actually has type <code>view@(x) = T? @ x</code> while the init decl. has type <code>view@(y) = T @ x</code><li><code>var z: int with pfz = 69</code> will bind <code>pfz = view@(z)</code> for you<li>ATS ensures there are no dangling or escaped stack pointers by requiring that the linear at-view proof must be present in the context when the function returns.<li>Can also stack allocate flat arrays in the obvious way</ul><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>var A = @[double][</span><span style=color:#d08770;>10</span><span>]()				// uninit stack array
</span><span>var B = @[double][</span><span style=color:#d08770;>10</span><span>](</span><span style=color:#d08770;>42.0</span><span>)			// size=</span><span style=color:#d08770;>10</span><span> stack array init w/ </span><span style=color:#d08770;>42.0
</span><span>var C = @[double](</span><span style=color:#d08770;>1.0</span><span>, </span><span style=color:#d08770;>2.0</span><span>, </span><span style=color:#d08770;>3.0</span><span>)    // size=</span><span style=color:#d08770;>3</span><span> init w/ (</span><span style=color:#d08770;>1.0</span><span>, ..)
</span></code></pre><ul><li>Can also stack allocate closures via <code>lam@</code> (non-rec) and <code>fix@</code> (rec)</ul><pre class=language-sml data-lang=sml style=background-color:#2b303b;color:#c0c5ce;><code class=language-sml data-lang=sml><span>var x: int = </span><span style=color:#d08770;>123
</span><span>var y: int = </span><span style=color:#d08770;>69
</span><span>
</span><span>var mul = lam@ (): int => x * y
</span></code></pre><h3 id=variance-rust>Variance (Rust) <a aria-label="anchor link" class=anchor-link href=#variance-rust> # </a></h3><p>The <code>variance</code> property of a generic type is relative to its generic arguments. For example, a generic type <code>F</code> has variance relative to its generic parameters (say <code>F&LTT></code>, so <code>F</code> has variance relative to <code>T</code>). Variance tells us how/how not e.g. traits impls "pass through" the inner parameter type <code>T</code> to/from the outer generic type <code>F</code>.<p><strong>subtype</strong>: <code>T: U</code>, <code>T</code> is "at least as useful as" <code>U</code>. For example, <code>'static: 'a</code> since you can use static lifetimes anywhere some stricter lifetime <code>'a</code> is needed.<p>There are three cases for variance: <em>covariant</em>, <em>contravariant</em>, and <em>invariant</em>.<ol><li><p><strong>covariant</strong>:</p> <p>have <code>fn foo(&'a str)</code>, can call <code>foo(&'static str)</code>. we can provide <code>foo</code> with a <em>stronger</em> type than it requires. in this case, <code>F<_> = &'_ str</code>.</p><li><p><strong>contravariant</strong>:</p> <p>have <code>fn foo(Fn(&'a str) -> ())</code>, <em>can't</em> provide <code>foo(fn(&'static str) {})</code>. need to provide <code>foo</code> with a <em>weaker</em> type than it expects.</p><li><p><strong>invariant</strong>:</p> <p>no additional subtyping relation can be derived</p></ol><h3 id=variance-ats>Variance (ATS) <a aria-label="anchor link" class=anchor-link href=#variance-ats> # </a></h3><p>You can express covariance and contravariance (I believe?) in some parameter by adding a <code>+</code> or <code>-</code> to certain keyword types or something<p>Confirmed this is true for <code>view+</code> and <code>prop+</code> for covariance. Just guessing on the rest.<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>prop+ prop-
</span><span>view+ view-
</span><span>
</span><span>type+ type-
</span><span>tbox+ tbox-
</span><span>tflt+ tflt-
</span><span>
</span><span>types+ types-
</span><span>
</span><span>vtype+ vtype-
</span><span>vtbox+ vtbox-
</span><span>vtflt+ vtflt-
</span><span>
</span><span>t0ype+ t0ype-
</span><span>vt0ype+ vt0ype-
</span><span>
</span><span>viewtype+ viewtype-
</span><span>viewt0ype+ viewt0ype-
</span></code></pre><h3 id=opt>opt <a aria-label="anchor link" class=anchor-link href=#opt> # </a></h3><p>There's a type constructor <code>opt(T, B)</code> where <code>T</code> is a type and <code>B</code> is a <code>bool</code>. If <code>B = true</code> then <code>opt(T, B)</code> is <code>T</code> and <code>T?</code> if <code>B = false</code>.<p><code>llam (..) => ..</code> appears to be a linear lambda closure?<p><code>(..) -&LTlin,prf> ..</code> appears to be type of linear, prfun closure?</main></div></div></div><form class=d-none id=search-bar><div class=container><div class="row justify-content-center"><div class="col col-lg-11 col-xl-9" id=search-container><input aria-label="Search notes..." class="form-control is-search" placeholder="Search notes..." autocomplete=off id=userinput type=search><div class="shadow rounded" id=suggestions></div></div></div></div></form><script defer src=https://phlip9.com/notes/js/elasticlunr.min.js></script><script defer src=https://phlip9.com/notes/search_index.en.js></script><script defer src=https://phlip9.com/notes/js/search.js></script>