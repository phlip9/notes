<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link href=https://phlip9.com/notes/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>git multirepo to monorepo | philip's notes</title><meta content="a collection of my notes" name=description><link href="https://phlip9.com/notes/misc/git multirepo to monorepo/" rel=canonical><meta content=summary name=twitter:card><meta content="git multirepo to monorepo" name=twitter:title><meta content=@phlip9 name=twitter:site><meta content=@phlip9 name=twitter:creator><meta content="git multirepo to monorepo" property=og:title><meta content="a collection of my notes" property=og:description><meta content=article property=og:type><meta content="https://phlip9.com/notes/misc/git multirepo to monorepo/" property=og:url><meta content=2024-10-21T04:08:44.994615 property=og:updated_time><meta content="philip's notes" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "/misc/git multirepo to monorepo/"
    },
    "headline": "git multirepo to monorepo",
    "image": ,
    "datePublished": "2022-08-16",
    "dateModified": "2024-10-21",
    "author": {
      "@type": "Person",
      "name": "Philip Hayes"
    },
    "publisher": {
      "@type": "Person",
      "name": "Philip Hayes",
      
    },
    "description": "a collection of my notes"
  }
  </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://phlip9.com/notes/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Misc",
            "item": "https://phlip9.com/notes/misc/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Git Multirepo To Monorepo",
            "item": "https://phlip9.com/notes/misc/git multirepo to monorepo/"
          },
        
      
    
  }
</script><meta content=#383866 name=theme-color><link href=https://phlip9.com/notes/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://phlip9.com/notes/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://phlip9.com/notes/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://phlip9.com/notes/site.webmanifest rel=manifest><script>// https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html
        window.MathJax = {
          tex: {
            inlineMath: [
              ['$', '$']
            ],
            displayMath: [
              ['$$', '$$'],
              ['\\[', '\\]']
            ],
            processEscapes: true,
            processEnvironments: true,
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          }
        };</script><script integrity="sha256-z47L98YXVhVIaY0uyDzt675P5Ea+w3RsPh9VD5NuoTY=" async crossorigin=anonymous defer id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js></script><body class="notes single dark"><div class=container role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 notes-sidebar"><nav aria-label="Main navigation" class=notes-links><a class="navbar-brand link-internal" href=https://phlip9.com/notes/> philip's notes </a><a class="notes-link sidebar-social" href=https://twitter.com/phlip9> <svg class="feather feather-twitter" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg> <span class=visually-hidden>Twitter</span> </a><a class="notes-link sidebar-social" href=https://github.com/phlip9> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> <span class=visually-hidden>GitHub</span> </a><a class="notes-link sidebar-social" href=# id=sidebar-open-search> <svg aria-labelledby="title desc" viewbox="0 0 19.9 19.7" fill=none height=20 id=search-icon role=img stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 tabindex=0 width=20 xmlns=http://www.w3.org/2000/svg> <g class=search-path><path d="M18.5 18.3l-5.4-5.4"></path><circle cx=8 cy=8 r=7></circle> </g> </svg> </a><hr><ol id=sidebar-tree-root><li><input id=sidebar-input-ai-ml type=checkbox> <label class=h3 for=sidebar-input-ai-ml>AI ML</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Expectimax Search/"> Expectimax Search </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Markov Decision Process (MDP)/"> Markov Decision Process (MDP) </a></ol><li><input id=sidebar-input-wsl type=checkbox> <label class=h3 for=sidebar-input-wsl>WSL</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/WSL/WSL2 custom kernel/"> WSL2 custom kernel </a></ol><li><li><input id=sidebar-input-android type=checkbox> <label class=h3 for=sidebar-input-android>android</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/ADB over TCP inside WSL2/"> ADB over TCP inside WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/OTA updates for rooted android phone/"> OTA updates for rooted android phone </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/android cli setup/"> android cli setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/building signal-android in WSL2/"> building signal-android in WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/linux ADB udev setup/"> linux ADB udev setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/root phone with magisk/"> root phone with magisk </a></ol><li><input id=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n type=checkbox> <label class=h3 for=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n>b i g m o n e y l a w r e g u l a t i o n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/financial instituion/"> financial instituion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/foreign bank account report (FBAR)/"> foreign bank account report (FBAR) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/monetary instruments/"> monetary instruments </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/money services business (MSB)/"> money services business (MSB) </a></ol><li><input id=sidebar-input-b-l-o-c-k-c-h-a-i-n type=checkbox> <label class=h3 for=sidebar-input-b-l-o-c-k-c-h-a-i-n>b l o c k c h a i n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/aptos/"> aptos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/bip158 - compact block filters/"> bip158 - compact block filters </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/btc utreexo - utxo accumulator/"> btc utreexo - utxo accumulator </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/fastpay/"> fastpay </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/oasis/"> oasis </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/sui/"> sui </a></ol><li><input id=sidebar-input-btc-ln type=checkbox> <label class=h3 for=sidebar-input-btc-ln>btc-ln</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 11 - invoices/"> BOLT 11 - invoices </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 2 - channel management protocol/"> BOLT 2 - channel management protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 4 - onion routing protocol/"> BOLT 4 - onion routing protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 7 - p2p node and channel discovery/"> BOLT 7 - p2p node and channel discovery </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 8 - secure noise transport/"> BOLT 8 - secure noise transport </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/atomic multipath payments (AMP)/"> atomic multipath payments (AMP) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/breez lightning service providers/"> breez lightning service providers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/hosted channels/"> hosted channels </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning libs/"> lightning libs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning network notes/"> lightning network notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning rod/"> lightning rod </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightningdevkit - rust-lightning/"> lightningdevkit - rust-lightning </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/submarine swaps/"> submarine swaps </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/zero-conf channels/"> zero-conf channels </a></ol><li><input id=sidebar-input-combinatorics type=checkbox> <label class=h3 for=sidebar-input-combinatorics>combinatorics</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/combinatorics/k-combinations of a multiset/"> k-combinations of a multiset </a></ol><li><input id=sidebar-input-confidential-computing type=checkbox> <label class=h3 for=sidebar-input-confidential-computing>confidential computing</label> <ol><li><input id=sidebar-input-confidential-computing-intel-sgx type=checkbox> <label class=h3 for=sidebar-input-confidential-computing-intel-sgx>intel SGX</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/"> SGX lingo </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/overview/"> overview </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/remote attestation/"> remote attestation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/sealing/"> sealing </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/secure time/"> secure time </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/"> enarx (WASM TEE) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/fortanix rust tutorial/"> fortanix rust tutorial </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/gramine/"> gramine </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel TDX/"> intel TDX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/marblerun/"> marblerun </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/mystikos/"> mystikos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/remote attestation protocols/"> remote attestation protocols </a></ol><li><input id=sidebar-input-crypto type=checkbox> <label class=h3 for=sidebar-input-crypto>crypto</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/(talk) authenticated data structures for stateless validation/"> (talk) authenticated data structures for stateless validation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/TLS self-signed pubkey-only certs/"> TLS self-signed pubkey-only certs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/acme protocol/"> acme protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/biscuit authz/"> biscuit authz </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/dex - open-source OIDC & OAuth 2.0 provider/"> dex - open-source OIDC & OAuth 2.0 provider </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/hkdf-sha256/> hkdf-sha256 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/smallstep - private online CA & ACME server/"> smallstep - private online CA & ACME server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/tls exported keying material/"> tls exported keying material </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/zkdocs/> zkdocs </a></ol><li><input id=sidebar-input-design type=checkbox> <label class=h3 for=sidebar-input-design>design</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/design/form design/"> form design </a></ol><li><input id=sidebar-input-devops type=checkbox> <label class=h3 for=sidebar-input-devops>devops</label> <ol><li><input id=sidebar-input-devops-o11y type=checkbox> <label class=h3 for=sidebar-input-devops-o11y>o11y</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/o11y/jaeger oss e2e tracing/"> jaeger oss e2e tracing </a></ol><li><input id=sidebar-input-devops-secrets type=checkbox> <label class=h3 for=sidebar-input-devops-secrets>secrets</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/1password - secrets automation/"> 1password - secrets automation </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/doppler/> doppler </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson (Shopify)/"> ejson (Shopify) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson-kms (AWS)/"> ejson-kms (AWS) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/envkey/> envkey </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/fortanix DSM/"> fortanix DSM </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/mozilla SOPS/"> mozilla SOPS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/sops-nix/> sops-nix </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/sy - share secrets safely/"> sy - share secrets safely </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/AKS - azure kubernetes service/"> AKS - azure kubernetes service </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/algo wireguard VPN server/"> algo wireguard VPN server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/azure CLI/"> azure CLI </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/consul/> consul </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/deployment strategies/"> deployment strategies </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/docker compose/"> docker compose </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/k3s/> k3s </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/kind (kubernetes in docker)/"> kind (kubernetes in docker) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/kubernetes/> kubernetes </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/linkerd/> linkerd </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/minikube/> minikube </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/nomad/> nomad </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/service mesh/"> service mesh </a></ol><li><input id=sidebar-input-distributed-systems type=checkbox> <label class=h3 for=sidebar-input-distributed-systems>distributed systems</label> <ol><li><input id=sidebar-input-distributed-systems-papers type=checkbox> <label class=h3 for=sidebar-input-distributed-systems-papers>papers</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast/"> (2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2021) Leaderless Consensus/"> (2021) Leaderless Consensus </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/the siren song of backpressure/"> the siren song of backpressure </a></ol><li><input id=sidebar-input-fuzzing type=checkbox> <label class=h3 for=sidebar-input-fuzzing>fuzzing</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/fuzzing/bolero - fuzzing + property testing/"> bolero - fuzzing + property testing </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzcheck-rs/> fuzzcheck-rs </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzing/> fuzzing </a></ol><li><input id=sidebar-input-ios type=checkbox> <label class=h3 for=sidebar-input-ios>ios</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/ios/ios setup/"> ios setup </a></ol><li><input id=sidebar-input-keyboards type=checkbox> <label class=h3 for=sidebar-input-keyboards>keyboards</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/keyboards/moergo glove80/"> moergo glove80 </a></ol><li><input id=sidebar-input-lang type=checkbox> <label class=h3 for=sidebar-input-lang>lang</label> <ol><li><input id=sidebar-input-lang-ats type=checkbox> <label class=h3 for=sidebar-input-lang-ats>ATS</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/"> ATS2 Notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/Install ATS2/"> Install ATS2 </a></ol><li><input id=sidebar-input-lang-flutter type=checkbox> <label class=h3 for=sidebar-input-lang-flutter>flutter</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/dart lang/"> dart lang </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/flutter setup/"> flutter setup </a></ol><li><input id=sidebar-input-lang-rust type=checkbox> <label class=h3 for=sidebar-input-lang-rust>rust</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/optimizing binary size/"> optimizing binary size </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rr with rust/"> rr with rust </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust verification tools/"> rust verification tools </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust x SGX/"> rust x SGX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/self-referencing structs/"> self-referencing structs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/sycamore x futures/"> sycamore x futures </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/understanding sycamore reactivity/"> understanding sycamore reactivity </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/gdb ref/"> gdb ref </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/koka-lang/> koka-lang </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/lua/> lua </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/operator fixity and precedence/"> operator fixity and precedence </a></ol><li><input id=sidebar-input-management type=checkbox> <label class=h3 for=sidebar-input-management>management</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/management/relieve often - why generals were more successful in WWII/"> relieve often - why generals were more successful in WWII </a></ol><li><input checked id=sidebar-input-misc type=checkbox> <label class=h3 for=sidebar-input-misc>misc</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/arm target triples/"> arm target triples </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/envsubst/> envsubst </a><li class=sidebar-note><a class="notes-link link-internal active" href="https://phlip9.com/notes/misc/git multirepo to monorepo/"> git multirepo to monorepo </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/kintsugi/> kintsugi </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/optimization solvers/"> optimization solvers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/pop_OS! tweaks/"> pop_OS! tweaks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/prepping RPI for embedded dev/"> prepping RPI for embedded dev </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/rgbxmas/> rgbxmas </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/scanning QR codes on desktop/"> scanning QR codes on desktop </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/setting up a headless raspbian boot image/"> setting up a headless raspbian boot image </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/uptime to downtime conversion/"> uptime to downtime conversion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/water distillation setup/"> water distillation setup </a></ol><li><input id=sidebar-input-networking type=checkbox> <label class=h3 for=sidebar-input-networking>networking</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/networking/CIDR/> CIDR </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/ipv6 address space/"> ipv6 address space </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interface card (NIC)/"> network interface card (NIC) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interfaces/"> network interfaces </a></ol><li><input id=sidebar-input-nvim type=checkbox> <label class=h3 for=sidebar-input-nvim>nvim</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/nvim/universal-ctags Notes/"> universal-ctags Notes </a></ol><li><input id=sidebar-input-performance type=checkbox> <label class=h3 for=sidebar-input-performance>performance</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/bit hacks/"> bit hacks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/dtrace on macOS/"> dtrace on macOS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/performance/profiling/> profiling </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/simdjson talk/"> simdjson talk </a></ol><li><input id=sidebar-input-postgres type=checkbox> <label class=h3 for=sidebar-input-postgres>postgres</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/postgres performance tuning/"> postgres performance tuning </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/postgres/snippets/> snippets </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/types of scans/"> types of scans </a></ol><li><input id=sidebar-input-reproducible-builds type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds>reproducible builds</label> <ol><li><input id=sidebar-input-reproducible-builds-nix type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds-nix>nix</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/links/"> links </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix auto-allocate-uids -> nixbld users/"> nix auto-allocate-uids -> nixbld users </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug broken package build/"> nix debug broken package build </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug spurrious rebuilds/"> nix debug spurrious rebuilds </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/earthly/"> earthly </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/rebuilderd/"> rebuilderd </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/reproducible-builds.org/"> reproducible-builds.org </a></ol><li><input id=sidebar-input-router type=checkbox> <label class=h3 for=sidebar-input-router>router</label> <ol><li><input id=sidebar-input-router-lightning-router type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router>lightning router</label> <ol><li><input id=sidebar-input-router-lightning-router-captive-portal type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router-captive-portal>captive portal</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/RFC 6585 (Additional HTTP Status Codes)/"> RFC 6585 (Additional HTTP Status Codes) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/arubanetworks captive portal/"> arubanetworks captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal/"> captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal (wikipedia)/"> captive portal (wikipedia) </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/lightning router overview/"> lightning router overview </a></ol></ol><li><input id=sidebar-input-statistics-probability type=checkbox> <label class=h3 for=sidebar-input-statistics-probability>statistics probability</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/CDF confidence bands - DKW inequality/"> CDF confidence bands - DKW inequality </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/G-test - multinomial goodness-of-fit/"> G-test - multinomial goodness-of-fit </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/MAD - median absolute deviation/"> MAD - median absolute deviation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/cheat sheet/"> cheat sheet </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/herbie - float error fixer/"> herbie - float error fixer </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/kelly criterion + ELO/"> kelly criterion + ELO </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/multinomial distribution/"> multinomial distribution </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/p-value/"> p-value </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/standard error/"> standard error </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/testing whether a coin is fair/"> testing whether a coin is fair </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/winsorize/"> winsorize </a></ol></ol></nav></div><nav aria-label="Secondary navigation" class="notes-toc d-none d-xl-block col-xl-4"><div class=page-links><h3 class=text-muted>on this page</h3><nav id=table-of-contents><ul><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#git-multirepo-to-monorepo" class=link-internal>git multirepo to monorepo</a> <ul><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#the-setup" class=link-internal>the setup</a> <ul><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#0-current-state" class=link-internal>(0) current state</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#1-move-all-files-in-pub-into-the-subdirectory" class=link-internal>(1) move all files in pub into the subdirectory</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#2-git-merge-allow-unrelated-histories" class=link-internal>(2) git merge --allow-unrelated-histories</a></ul><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#3-git-push-new-subrepo-history-upstream" class=link-internal>(3) git push new subrepo history upstream</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#appendix" class=link-internal>appendix</a> <ul><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#1-more-janky-git-mv-all-files-into-subdir" class=link-internal>(1) more janky git mv all files into subdir</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#1-alt-rewrite-history-into-subdirectory" class=link-internal>(1) (alt) rewrite history into subdirectory</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#2-alt-git-subrepo" class=link-internal>(2) (alt) git subrepo</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#2-alt-git-subtree-add" class=link-internal>(2) (alt) git subtree add</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#2-alt-git-read-write-commit-tree" class=link-internal>(2) (alt) git read/write/commit-tree</a><li><a href="https://phlip9.com/notes/misc/git multirepo to monorepo/#other-monorepo-tools" class=link-internal>other monorepo tools</a></ul></ul></ul></nav></div></nav><main class="notes-content tags-content col-lg-11 col-xl-8"><h1 id=git-multirepo-to-monorepo>git multirepo to monorepo</h1><p class=text-muted>2022-08-16 · 9 min read<ul class=tags><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/git/>#git</a></ul><h2 id=the-setup>the setup <a aria-label="anchor link" class=anchor-link href=#the-setup> # </a></h2><ul><li>We currently have a private repo and a public repo, <code>mono</code> and <code>pub</code>.<li>The <code>pub</code> repo is already exists as a published and open-source repo.<li>We'd like to merge <code>pub</code> into <code>mono</code> as a subdirectory <code>mono/pub-dir</code>.<li>The conversion must not lose the original <code>pub</code> subrepo history.<li>The migrated <code>pub</code> subrepo will still be published as a public, mostly read-only open source repo.<li>The conversion should not require a force-push rewrite of the <code>pub</code> subrepo history.<li>For privacy, new commits in <code>mono</code> that don't touch the <code>mono/pub-dir</code> subdirectory must not appear in the published <code>pub</code> subrepo.<li><code>git blame</code> must continue to work as expected.<li>Filtering and publishing changes from the monorepo to one of the subrepos should easily run in CI.<li>It should work with the built-in <code>git</code> tools.</ul><h3 id=0-current-state>(0) current state <a aria-label="anchor link" class=anchor-link href=#0-current-state> # </a></h3><p>First, let's orient ourselves with the two repos:<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>~/pub$</span><span> exa</span><span style=color:#bf616a;> --tree
</span><span style=color:#96b5b4;>.
</span><span style=color:#bf616a;>├──</span><span> README.md
</span><span style=color:#bf616a;>└──</span><span> client
</span><span>   </span><span style=color:#bf616a;>└──</span><span> ..
</span><span>
</span><span style=color:#bf616a;>~/pub$</span><span> git lg
</span><span style=color:#bf616a;>*</span><span> 5de880b - pub: add client (HEAD -> master)
</span><span style=color:#bf616a;>*</span><span> ff12305 - pub: initial commit
</span><span>
</span><span style=color:#bf616a;>~/mono$</span><span> exa</span><span style=color:#bf616a;> --tree
</span><span style=color:#96b5b4;>.
</span><span style=color:#bf616a;>├──</span><span> README.md
</span><span style=color:#bf616a;>└──</span><span> backend
</span><span>   </span><span style=color:#bf616a;>└──</span><span> ..
</span><span>
</span><span style=color:#bf616a;>~/mono$</span><span> git lg
</span><span style=color:#bf616a;>*</span><span> e89ca6f - mono: add backend (HEAD -> master)
</span><span style=color:#bf616a;>*</span><span> 5017487 - mono: initial commit
</span></code></pre><p>Ultimately we'd like our <code>mono</code> repo to look like:<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$ ~</span><span>/mono$ exa</span><span style=color:#bf616a;> --tree
</span><span style=color:#96b5b4;>.
</span><span style=color:#bf616a;>├──</span><span> README.md
</span><span style=color:#bf616a;>├──</span><span> backend
</span><span style=color:#bf616a;>│</span><span>  └── ..
</span><span style=color:#bf616a;>└──</span><span> pub-dir </span><span style=color:#65737e;># `pub-dir` will contain the `pub` subrepo
</span><span>   </span><span style=color:#bf616a;>├──</span><span> README.md
</span><span>   </span><span style=color:#bf616a;>└──</span><span> client
</span><span>      </span><span style=color:#bf616a;>└──</span><span> ..
</span></code></pre><p>The published <code>pub</code> subrepo will look the same immediately after conversion, but will exist as a "projected" view of the <code>mono</code> repo.<h3 id=1-move-all-files-in-pub-into-the-subdirectory>(1) move all files in <code>pub</code> into the subdirectory <a aria-label="anchor link" class=anchor-link href=#1-move-all-files-in-pub-into-the-subdirectory> # </a></h3><p>The first step is to prepare the <code>pub</code> subrepo by creating a commit that moves all files into the desired future subdirectory of the monorepo.<p>For this example, we'll move all the files in <code>pub</code> into a new <code>pub-dir</code> subdirectory:<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># prepare public repo by moving all files into new `pub-dir` subdir.
</span><span style=color:#bf616a;>~/pub$</span><span> git branch migration
</span><span style=color:#bf616a;>~/pub$</span><span> mkdir ./pub-dir
</span><span style=color:#bf616a;>~/pub$</span><span> git ls-tree</span><span style=color:#bf616a;> -z --name-only</span><span> HEAD \
</span><span>	| </span><span style=color:#bf616a;>xargs -0 -I</span><span>{} git mv "</span><span style=color:#a3be8c;>{}</span><span>" ./pub-dir/
</span><span style=color:#bf616a;>~/pub$</span><span> git commit</span><span style=color:#bf616a;> -m </span><span>"</span><span style=color:#a3be8c;>pub: prepare for monorepo migration</span><span>"
</span><span>
</span><span style=color:#bf616a;>~/pub$</span><span> git lg
</span><span style=color:#bf616a;>*</span><span> 33708aa - pub: prepare for monorepo migration (HEAD -> migration)
</span><span style=color:#bf616a;>*</span><span> 5de880b - pub: add client (master)
</span><span style=color:#bf616a;>*</span><span> ff12305 - pub: initial commit
</span></code></pre><p>This approach preserves the histories in both repos and doesn't require rewriting the public repo's existing history. When we push new changes from the <code>mono</code> repo to the <code>pub</code> subrepo, the existing public repo will continue to have its original history, just with new commits added on top!<h3 id=2-git-merge-allow-unrelated-histories>(2) git merge --allow-unrelated-histories <a aria-label="anchor link" class=anchor-link href=#2-git-merge-allow-unrelated-histories> # </a></h3><p>Once the <code>pub</code> repo is prepared, we move into the <code>mono</code> repo and merge the two independent histories into one.<p>The key trick here is to use <code>git merge --allow-unrelated-histories</code>, which lets us have <em>two</em> "root" initial commits in the repo. In other words, our git history is no longer a single tree, but a "forest", which eventually grows together into one linear history.<p>In diagram form:<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>* - mono+pub: merged linear history
</span><span>|
</span><span>⁞
</span><span>|
</span><span>* - mono+pub: merge commit
</span><span>|\
</span><span>| *
</span><span>*  \
</span><span>|   *
</span><span>⁞   ⁞
</span><span>⁞   * - pub: initial commit
</span><span>|
</span><span>* - mono: initial commit
</span></code></pre><p>Let's do that now. We import all commits on <code>master</code> from the subrepo into the main <code>mono</code> repo. Best part: this works flawlessly with <code>git blame</code>!<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># Fetch the public repo from a local directory or remote url.
</span><span style=color:#65737e;># In our case `pub` is just in the parent directory:
</span><span style=color:#bf616a;>~/mono$</span><span> git remote add pub ../pub
</span><span style=color:#bf616a;>~/mono$</span><span> git fetch</span><span style=color:#bf616a;> --no-tags</span><span> pub migration
</span><span style=color:#bf616a;>~/mono$</span><span> git merge</span><span style=color:#bf616a;> --allow-unrelated-histories</span><span> pub/migration
</span><span>
</span><span style=color:#65737e;># See the two independent histories merged into one linear
</span><span style=color:#65737e;># history, without losing either history.
</span><span style=color:#bf616a;>~/mono$</span><span> git lg
</span><span style=color:#bf616a;>*</span><span>   3888a45 - mono: merge pub repo into subdir (HEAD -> master)
</span><span>|\
</span><span>| </span><span style=color:#bf616a;>*</span><span> 33708aa - pub: prepare for monorepo migration (pub/migration)
</span><span>| </span><span style=color:#bf616a;>*</span><span> 5de880b - pub: add client (pub/master)
</span><span>| </span><span style=color:#bf616a;>*</span><span> ff12305 - pub: initial commit
</span><span style=color:#bf616a;>*</span><span> e89ca6f - mono: add backend
</span><span style=color:#bf616a;>*</span><span> 5017487 - mono: initial commit
</span><span>
</span><span style=color:#65737e;># Push the migrated `mono` history.
</span><span style=color:#bf616a;>~/mono$</span><span> git push origin master
</span></code></pre><p>Note: you can do this without <code>git push</code>'ing until the end, but it's somewhat tedious to describe in tutorial format.<h2 id=3-git-push-new-subrepo-history-upstream>(3) git push new subrepo history upstream <a aria-label="anchor link" class=anchor-link href=#3-git-push-new-subrepo-history-upstream> # </a></h2><p>Now that we have all the subrepos merged into <code>mono</code>, we only need to make changes in one place--no more PRs split across repos!<p>Of course we still want changes to the subrepos inside <code>mono</code> to get pushed out to the public repos. We can accomplish this with <code>git subtree split</code>. We'll do this in a fresh clone, since it mangles the current repo state...<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># We project the monorepo history into it's public-only form.
</span><span style=color:#65737e;># This approach completely preserves the original public commits!
</span><span style=color:#65737e;>#
</span><span style=color:#65737e;># NOTE: the subshell:
</span><span style=color:#65737e;>#
</span><span style=color:#65737e;># ```
</span><span style=color:#65737e;># git rev-list --max-parents=0 pub/migration | tail --lines=1
</span><span style=color:#65737e;># ```
</span><span style=color:#65737e;>#
</span><span style=color:#65737e;># simply picks out the root initial commit from the `pub`
</span><span style=color:#65737e;># subrepo history.
</span><span>
</span><span style=color:#65737e;># Get a fresh clone of the `mono` repo.
</span><span style=color:#bf616a;>~/$</span><span> git clone &LTorigin-mono-repo-git-url> mono && </span><span style=color:#96b5b4;>cd</span><span> mono
</span><span style=color:#bf616a;>~/mono$</span><span> git remote add pub &LTorigin-pub-repo-git-url>
</span><span style=color:#bf616a;>~/mono$</span><span> git fetch pub
</span><span style=color:#bf616a;>~/mono$</span><span> git switch master
</span><span>
</span><span style=color:#65737e;># Project the `pub` subrepo history from the `mono` repo history.
</span><span style=color:#bf616a;>~/mono$</span><span> git subtree split \
</span><span style=color:#bf616a;>	--prefix</span><span>=pub-dir/ \
</span><span style=color:#bf616a;>	--onto</span><span>=$(</span><span style=color:#bf616a;>git</span><span> rev-list</span><span style=color:#bf616a;> --max-parents</span><span>=0 pub/migration | </span><span style=color:#bf616a;>tail --lines</span><span>=1)
</span><span style=color:#bf616a;>198017b02ffa2d45f301f6b9ba6424c4e849251b
</span><span style=color:#bf616a;>~/mono$</span><span> git reset</span><span style=color:#bf616a;> --hard</span><span> 198017b02ffa2d45f301f6b9ba6424c4e849251b
</span><span>
</span><span style=color:#65737e;># This is the "projected" `pub` repo history with new commits from
</span><span style=color:#65737e;># the `mono` repo.
</span><span style=color:#65737e;>#
</span><span style=color:#65737e;># Note: commits that don't touch the `pub-dir/` subrepo will be
</span><span style=color:#65737e;># safely ignored.
</span><span style=color:#bf616a;>~/mono$</span><span> git lg
</span><span style=color:#bf616a;>*</span><span> 198017b - mono+pub: this commit touches files on / and pub-dir/ (HEAD -> master)
</span><span style=color:#bf616a;>*</span><span> 3269fbc - pub: this commit only touches files in pub-dir/
</span><span style=color:#bf616a;>*</span><span> c7b8b55 - pub: prepare for monorepo migration
</span><span style=color:#bf616a;>*</span><span> 5de880b - pub: add client (pub/master)
</span><span style=color:#bf616a;>*</span><span> ff12305 - pub: initial commit
</span><span>
</span><span style=color:#65737e;># Push the projected `pub` history to the upstream `pub` repo.
</span><span style=color:#bf616a;>~/mono$</span><span> git push pub master
</span></code></pre><p>Note: If we use <code>git subtree split</code> without <code>--onto=&LTpub-initial-commit></code>, it will fail to determine the original subrepo root commit. Instead it will just squash all changes pre-merge, which is not what we want!<h2 id=appendix>appendix <a aria-label="anchor link" class=anchor-link href=#appendix> # </a></h2><p>This section contains other alternative approaches that didn't work well for one reason or another. Feel free to skip everything below.<h3 id=1-more-janky-git-mv-all-files-into-subdir>(1) more janky git mv all files into subdir <a aria-label="anchor link" class=anchor-link href=#1-more-janky-git-mv-all-files-into-subdir> # </a></h3><pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>~/pub$</span><span> git ls-files \
</span><span>	| </span><span style=color:#bf616a;>sed -n -E </span><span>"</span><span style=color:#a3be8c;>s/^([^\/]*)\/?.*$/\1/p</span><span>" \
</span><span>	| </span><span style=color:#bf616a;>uniq </span><span>\
</span><span>	| </span><span style=color:#bf616a;>grep -v </span><span>"</span><span style=color:#a3be8c;>^pub-dir</span><span>" \
</span><span>	| </span><span style=color:#bf616a;>xargs -I</span><span>{} git mv "</span><span style=color:#a3be8c;>{}</span><span>" ./pub-dir/
</span></code></pre><h3 id=1-alt-rewrite-history-into-subdirectory>(1) (alt) rewrite history into subdirectory <a aria-label="anchor link" class=anchor-link href=#1-alt-rewrite-history-into-subdirectory> # </a></h3><p>You can also use <a href=https://github.com/newren/git-filter-repo><code>git filter-repo</code></a> to rewrite the whole commit history, as-if it had been written inside a subdirectory from the beginning:<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># install the `git filter-repo` tool, which replaces the (apparently
</span><span style=color:#65737e;># unsafe?) built-in filter-branch
</span><span>(</span><span style=color:#bf616a;>deb</span><span>)$ sudo apt install git-filter-repo
</span><span>(</span><span style=color:#bf616a;>macOS</span><span>)$ brew install git-filter-repo
</span><span>
</span><span style=color:#65737e;># After this command, all files in the current commit and all past
</span><span style=color:#65737e;># commits will be moved into the public-dir/ subdirectory.
</span><span style=color:#65737e;>#
</span><span style=color:#65737e;># You'll need to do this in fresh repo clone, since this command trashes
</span><span style=color:#65737e;># all repo commits.
</span><span style=color:#bf616a;>~/pub$</span><span> git filter-repo</span><span style=color:#bf616a;> --to-subdirectory-filter</span><span> pub-dir
</span></code></pre><p>This approach will require a force-push, overwriting the original <code>pub</code> repo history as the later <code>git subtree split</code> doesn't appear to be fully lossless in this case, causing the commit hashes change. Note: this will only affect the <em>commit hashes</em> of the <code>pub</code> repo history after push. The changes in each commit will still appear (almost) exactly the same, i.e., they're still in the root directory.<h3 id=2-alt-git-subrepo>(2) (alt) git subrepo <a aria-label="anchor link" class=anchor-link href=#2-alt-git-subrepo> # </a></h3><p>Skip step (1) if you use this approach.<p>The <a href=https://github.com/ingydotnet/git-subrepo><code>git subrepo</code></a> tool is a user-friendly alternative to the <code>git submodule</code> and <code>git subtree</code> commands.<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span>(</span><span style=color:#bf616a;>macOS</span><span>)$ brew install git-subrepo
</span><span>
</span><span style=color:#65737e;># git subrepo clone &LTremote-url> &LTsubdir>
</span><span style=color:#bf616a;>~/mono$</span><span> git subrepo clone ../pub ./pub-dir
</span></code></pre><p>Unfortunately, <code>git subrepo clone</code> squashes all the commit history before the merge. If you're just looking to vendor a dependency or don't care about the original history, this approach might be for you.<h3 id=2-alt-git-subtree-add>(2) (alt) git subtree add <a aria-label="anchor link" class=anchor-link href=#2-alt-git-subtree-add> # </a></h3><p>Skip step (1) if you use this approach.<p><code>git subtree</code> is a built-in tool that lets you keep other repos phyiscally inside your main repo. If you don't care about <code>git blame</code> working, then this is an easier method.<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># git subtree add --prefix=&LTsubdir> &LTremote-url> &LTremote-ref>
</span><span style=color:#bf616a;>~/mono$</span><span> git subtree add</span><span style=color:#bf616a;> --prefix</span><span>=pub-dir/ ../pub master
</span></code></pre><p><code>git subtree add</code> at least preserves the original history, but <code>git blame</code> only works down to the merge commit for subtree files. :'(<h3 id=2-alt-git-read-write-commit-tree>(2) (alt) git read/write/commit-tree <a aria-label="anchor link" class=anchor-link href=#2-alt-git-read-write-commit-tree> # </a></h3><p>Skip step (1) if you use this approach.<p>Using some low-level git porcelain, we can merge the subrepo into a subdirectory without touching the subrepo. This method effectively creates a new <code>tree</code> object in the git db whose contents are a single subdirectory with the <code>pub/master</code> root <code>tree</code>. We then create a merge commit pointing to (1) the existing <code>mono</code> repo master commit and (2) the new manually created commit.<p>Unfortunately, while the end result looks almost the same as [[#(1) move all files in <code>pub</code> into the subdirectory]], it appears to break <code>git blame</code>. :'(<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>~/mono$</span><span> git remote add public ../public
</span><span style=color:#bf616a;>~/mono$</span><span> git fetch</span><span style=color:#bf616a;> --no-tags</span><span> public master
</span><span style=color:#bf616a;>~/mono$</span><span> git read-tree</span><span style=color:#bf616a;> --prefix</span><span>=public/ public/master
</span><span style=color:#bf616a;>~/mono$</span><span> git write-tree
</span><span style=color:#bf616a;>f1b1ee12e1d679ec84c282049102e2654efc4b67
</span><span>
</span><span style=color:#bf616a;>~/mono$</span><span> git commit-tree f1b1ee12e1d679ec84c282049102e2654efc4b67 \
</span><span style=color:#bf616a;>	-p</span><span> master</span><span style=color:#bf616a;> -p</span><span> public/master</span><span style=color:#bf616a;> -m </span><span>"</span><span style=color:#a3be8c;>monorepo merge</span><span>"
</span><span style=color:#bf616a;>046d3298b9976d50fa379fa071f57bc1158aca5b
</span><span>
</span><span style=color:#bf616a;>~/mono$</span><span> git reset 046d3298b9976d50fa379fa071f57bc1158aca5b && </span><span style=color:#bf616a;>git</span><span> restore .
</span><span>
</span><span style=color:#bf616a;>~/mono$</span><span> git lg
</span><span style=color:#bf616a;>*</span><span>   854b553 - monorepo merge (HEAD -> master)
</span><span>|\
</span><span style=color:#bf616a;>* </span><span>| </span><span style=color:#bf616a;>5b02f51</span><span> - mono: add backend (origin/master)
</span><span>| </span><span style=color:#bf616a;>*</span><span> 7709d49 - pub: add client (public/master)
</span></code></pre><h3 id=other-monorepo-tools>other monorepo tools <a aria-label="anchor link" class=anchor-link href=#other-monorepo-tools> # </a></h3><ol><li><a href=https://github.com/google/copybara>(java) google/copybara</a><li><a href=https://github.com/facebook/fbshipit>(hack) facebook/fbshipit - Copy commits b/w repos</a><li><a href=https://github.com/symplify/monorepo-split-github-action>(php) symplify/monorepo-split-gh-action</a><li><a href=https://github.com/ingydotnet/git-subrepo>(sh) ingydotnet/git-subrepo</a><li><a href=https://github.com/newren/git-filter-repo>(py) newren/git-filter-repo</a><li><a href=https://github.com/splitsh/lite>(go) splitsh/lite</a><li><a href=https://github.com/SimonBaeumer/sync-monorepo>(sh) SimonBaeumer/sync-monorepo</a><li>\[ \]</ol></main></div></div></div><form class=d-none id=search-bar><div class=container><div class="row justify-content-center"><div class="col col-lg-11 col-xl-9" id=search-container><input aria-label="Search notes..." class="form-control is-search" placeholder="Search notes..." autocomplete=off id=userinput type=search><div class="shadow rounded" id=suggestions></div></div></div></div></form><script defer src=https://phlip9.com/notes/js/elasticlunr.min.js></script><script defer src=https://phlip9.com/notes/search_index.en.js></script><script defer src=https://phlip9.com/notes/js/search.js></script>