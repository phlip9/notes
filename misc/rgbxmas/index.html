<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link href=https://phlip9.com/notes/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>rgbxmas | philip's notes</title><meta content="a collection of my notes" name=description><link href=https://phlip9.com/notes/misc/rgbxmas/ rel=canonical><meta content=summary name=twitter:card><meta content=rgbxmas name=twitter:title><meta content=@phlip9 name=twitter:site><meta content=@phlip9 name=twitter:creator><meta content=rgbxmas property=og:title><meta content="a collection of my notes" property=og:description><meta content=article property=og:type><meta content=https://phlip9.com/notes/misc/rgbxmas/ property=og:url><meta content=2024-10-21T04:08:44.994615 property=og:updated_time><meta content="philip's notes" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "/misc/rgbxmas/"
    },
    "headline": "rgbxmas",
    "image": ,
    "datePublished": "2022-12-21",
    "dateModified": "2024-10-21",
    "author": {
      "@type": "Person",
      "name": "Philip Hayes"
    },
    "publisher": {
      "@type": "Person",
      "name": "Philip Hayes",
      
    },
    "description": "a collection of my notes"
  }
  </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://phlip9.com/notes/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Misc",
            "item": "https://phlip9.com/notes/misc/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Rgbxmas",
            "item": "https://phlip9.com/notes/misc/rgbxmas/"
          },
        
      
    
  }
</script><meta content=#383866 name=theme-color><link href=https://phlip9.com/notes/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://phlip9.com/notes/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://phlip9.com/notes/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://phlip9.com/notes/site.webmanifest rel=manifest><script>// https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html
        window.MathJax = {
          tex: {
            inlineMath: [
              ['$', '$']
            ],
            displayMath: [
              ['$$', '$$'],
              ['\\[', '\\]']
            ],
            processEscapes: true,
            processEnvironments: true,
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          }
        };</script><script integrity="sha256-z47L98YXVhVIaY0uyDzt675P5Ea+w3RsPh9VD5NuoTY=" async crossorigin=anonymous defer id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js></script><body class="notes single dark"><div class=container role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 notes-sidebar"><nav aria-label="Main navigation" class=notes-links><a class="navbar-brand link-internal" href=https://phlip9.com/notes/> philip's notes </a><a class="notes-link sidebar-social" href=https://twitter.com/phlip9> <svg class="feather feather-twitter" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg> <span class=visually-hidden>Twitter</span> </a><a class="notes-link sidebar-social" href=https://github.com/phlip9> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> <span class=visually-hidden>GitHub</span> </a><a class="notes-link sidebar-social" href=# id=sidebar-open-search> <svg aria-labelledby="title desc" viewbox="0 0 19.9 19.7" fill=none height=20 id=search-icon role=img stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 tabindex=0 width=20 xmlns=http://www.w3.org/2000/svg> <g class=search-path><path d="M18.5 18.3l-5.4-5.4"></path><circle cx=8 cy=8 r=7></circle> </g> </svg> </a><hr><ol id=sidebar-tree-root><li><input id=sidebar-input-ai-ml type=checkbox> <label class=h3 for=sidebar-input-ai-ml>AI ML</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Expectimax Search/"> Expectimax Search </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Markov Decision Process (MDP)/"> Markov Decision Process (MDP) </a></ol><li><input id=sidebar-input-wsl type=checkbox> <label class=h3 for=sidebar-input-wsl>WSL</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/WSL/WSL2 custom kernel/"> WSL2 custom kernel </a></ol><li><li><input id=sidebar-input-android type=checkbox> <label class=h3 for=sidebar-input-android>android</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/ADB over TCP inside WSL2/"> ADB over TCP inside WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/OTA updates for rooted android phone/"> OTA updates for rooted android phone </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/android cli setup/"> android cli setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/building signal-android in WSL2/"> building signal-android in WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/linux ADB udev setup/"> linux ADB udev setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/root phone with magisk/"> root phone with magisk </a></ol><li><input id=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n type=checkbox> <label class=h3 for=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n>b i g m o n e y l a w r e g u l a t i o n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/financial instituion/"> financial instituion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/foreign bank account report (FBAR)/"> foreign bank account report (FBAR) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/monetary instruments/"> monetary instruments </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/money services business (MSB)/"> money services business (MSB) </a></ol><li><input id=sidebar-input-b-l-o-c-k-c-h-a-i-n type=checkbox> <label class=h3 for=sidebar-input-b-l-o-c-k-c-h-a-i-n>b l o c k c h a i n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/aptos/"> aptos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/bip158 - compact block filters/"> bip158 - compact block filters </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/btc utreexo - utxo accumulator/"> btc utreexo - utxo accumulator </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/fastpay/"> fastpay </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/oasis/"> oasis </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/sui/"> sui </a></ol><li><input id=sidebar-input-btc-ln type=checkbox> <label class=h3 for=sidebar-input-btc-ln>btc-ln</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 11 - invoices/"> BOLT 11 - invoices </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 2 - channel management protocol/"> BOLT 2 - channel management protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 4 - onion routing protocol/"> BOLT 4 - onion routing protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 7 - p2p node and channel discovery/"> BOLT 7 - p2p node and channel discovery </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 8 - secure noise transport/"> BOLT 8 - secure noise transport </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/atomic multipath payments (AMP)/"> atomic multipath payments (AMP) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/breez lightning service providers/"> breez lightning service providers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/hosted channels/"> hosted channels </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning libs/"> lightning libs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning network notes/"> lightning network notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning rod/"> lightning rod </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightningdevkit - rust-lightning/"> lightningdevkit - rust-lightning </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/submarine swaps/"> submarine swaps </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/zero-conf channels/"> zero-conf channels </a></ol><li><input id=sidebar-input-combinatorics type=checkbox> <label class=h3 for=sidebar-input-combinatorics>combinatorics</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/combinatorics/k-combinations of a multiset/"> k-combinations of a multiset </a></ol><li><input id=sidebar-input-confidential-computing type=checkbox> <label class=h3 for=sidebar-input-confidential-computing>confidential computing</label> <ol><li><input id=sidebar-input-confidential-computing-intel-sgx type=checkbox> <label class=h3 for=sidebar-input-confidential-computing-intel-sgx>intel SGX</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/"> SGX lingo </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/overview/"> overview </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/remote attestation/"> remote attestation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/sealing/"> sealing </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/secure time/"> secure time </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/"> enarx (WASM TEE) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/fortanix rust tutorial/"> fortanix rust tutorial </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/gramine/"> gramine </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel TDX/"> intel TDX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/marblerun/"> marblerun </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/mystikos/"> mystikos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/remote attestation protocols/"> remote attestation protocols </a></ol><li><input id=sidebar-input-crypto type=checkbox> <label class=h3 for=sidebar-input-crypto>crypto</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/(talk) authenticated data structures for stateless validation/"> (talk) authenticated data structures for stateless validation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/TLS self-signed pubkey-only certs/"> TLS self-signed pubkey-only certs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/acme protocol/"> acme protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/biscuit authz/"> biscuit authz </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/dex - open-source OIDC & OAuth 2.0 provider/"> dex - open-source OIDC & OAuth 2.0 provider </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/hkdf-sha256/> hkdf-sha256 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/smallstep - private online CA & ACME server/"> smallstep - private online CA & ACME server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/tls exported keying material/"> tls exported keying material </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/zkdocs/> zkdocs </a></ol><li><input id=sidebar-input-design type=checkbox> <label class=h3 for=sidebar-input-design>design</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/design/form design/"> form design </a></ol><li><input id=sidebar-input-devops type=checkbox> <label class=h3 for=sidebar-input-devops>devops</label> <ol><li><input id=sidebar-input-devops-o11y type=checkbox> <label class=h3 for=sidebar-input-devops-o11y>o11y</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/o11y/jaeger oss e2e tracing/"> jaeger oss e2e tracing </a></ol><li><input id=sidebar-input-devops-secrets type=checkbox> <label class=h3 for=sidebar-input-devops-secrets>secrets</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/1password - secrets automation/"> 1password - secrets automation </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/doppler/> doppler </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson (Shopify)/"> ejson (Shopify) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson-kms (AWS)/"> ejson-kms (AWS) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/envkey/> envkey </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/fortanix DSM/"> fortanix DSM </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/mozilla SOPS/"> mozilla SOPS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/sops-nix/> sops-nix </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/sy - share secrets safely/"> sy - share secrets safely </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/AKS - azure kubernetes service/"> AKS - azure kubernetes service </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/algo wireguard VPN server/"> algo wireguard VPN server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/azure CLI/"> azure CLI </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/consul/> consul </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/deployment strategies/"> deployment strategies </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/docker compose/"> docker compose </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/k3s/> k3s </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/kind (kubernetes in docker)/"> kind (kubernetes in docker) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/kubernetes/> kubernetes </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/linkerd/> linkerd </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/minikube/> minikube </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/nomad/> nomad </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/service mesh/"> service mesh </a></ol><li><input id=sidebar-input-distributed-systems type=checkbox> <label class=h3 for=sidebar-input-distributed-systems>distributed systems</label> <ol><li><input id=sidebar-input-distributed-systems-papers type=checkbox> <label class=h3 for=sidebar-input-distributed-systems-papers>papers</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast/"> (2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2021) Leaderless Consensus/"> (2021) Leaderless Consensus </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/the siren song of backpressure/"> the siren song of backpressure </a></ol><li><input id=sidebar-input-fuzzing type=checkbox> <label class=h3 for=sidebar-input-fuzzing>fuzzing</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/fuzzing/bolero - fuzzing + property testing/"> bolero - fuzzing + property testing </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzcheck-rs/> fuzzcheck-rs </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzing/> fuzzing </a></ol><li><input id=sidebar-input-ios type=checkbox> <label class=h3 for=sidebar-input-ios>ios</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/ios/ios setup/"> ios setup </a></ol><li><input id=sidebar-input-keyboards type=checkbox> <label class=h3 for=sidebar-input-keyboards>keyboards</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/keyboards/moergo glove80/"> moergo glove80 </a></ol><li><input id=sidebar-input-lang type=checkbox> <label class=h3 for=sidebar-input-lang>lang</label> <ol><li><input id=sidebar-input-lang-ats type=checkbox> <label class=h3 for=sidebar-input-lang-ats>ATS</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/"> ATS2 Notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/Install ATS2/"> Install ATS2 </a></ol><li><input id=sidebar-input-lang-flutter type=checkbox> <label class=h3 for=sidebar-input-lang-flutter>flutter</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/dart lang/"> dart lang </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/flutter setup/"> flutter setup </a></ol><li><input id=sidebar-input-lang-rust type=checkbox> <label class=h3 for=sidebar-input-lang-rust>rust</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/optimizing binary size/"> optimizing binary size </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rr with rust/"> rr with rust </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust verification tools/"> rust verification tools </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust x SGX/"> rust x SGX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/self-referencing structs/"> self-referencing structs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/sycamore x futures/"> sycamore x futures </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/understanding sycamore reactivity/"> understanding sycamore reactivity </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/gdb ref/"> gdb ref </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/koka-lang/> koka-lang </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/lua/> lua </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/operator fixity and precedence/"> operator fixity and precedence </a></ol><li><input id=sidebar-input-management type=checkbox> <label class=h3 for=sidebar-input-management>management</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/management/relieve often - why generals were more successful in WWII/"> relieve often - why generals were more successful in WWII </a></ol><li><input checked id=sidebar-input-misc type=checkbox> <label class=h3 for=sidebar-input-misc>misc</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/arm target triples/"> arm target triples </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/envsubst/> envsubst </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/git multirepo to monorepo/"> git multirepo to monorepo </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/kintsugi/> kintsugi </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/optimization solvers/"> optimization solvers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/pop_OS! tweaks/"> pop_OS! tweaks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/prepping RPI for embedded dev/"> prepping RPI for embedded dev </a><li class=sidebar-note><a class="notes-link link-internal active" href=https://phlip9.com/notes/misc/rgbxmas/> rgbxmas </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/scanning QR codes on desktop/"> scanning QR codes on desktop </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/setting up a headless raspbian boot image/"> setting up a headless raspbian boot image </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/uptime to downtime conversion/"> uptime to downtime conversion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/water distillation setup/"> water distillation setup </a></ol><li><input id=sidebar-input-networking type=checkbox> <label class=h3 for=sidebar-input-networking>networking</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/networking/CIDR/> CIDR </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/ipv6 address space/"> ipv6 address space </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interface card (NIC)/"> network interface card (NIC) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interfaces/"> network interfaces </a></ol><li><input id=sidebar-input-nvim type=checkbox> <label class=h3 for=sidebar-input-nvim>nvim</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/nvim/universal-ctags Notes/"> universal-ctags Notes </a></ol><li><input id=sidebar-input-performance type=checkbox> <label class=h3 for=sidebar-input-performance>performance</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/bit hacks/"> bit hacks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/dtrace on macOS/"> dtrace on macOS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/performance/profiling/> profiling </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/simdjson talk/"> simdjson talk </a></ol><li><input id=sidebar-input-postgres type=checkbox> <label class=h3 for=sidebar-input-postgres>postgres</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/postgres performance tuning/"> postgres performance tuning </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/postgres/snippets/> snippets </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/types of scans/"> types of scans </a></ol><li><input id=sidebar-input-reproducible-builds type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds>reproducible builds</label> <ol><li><input id=sidebar-input-reproducible-builds-nix type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds-nix>nix</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/links/"> links </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix auto-allocate-uids -> nixbld users/"> nix auto-allocate-uids -> nixbld users </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug broken package build/"> nix debug broken package build </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug spurrious rebuilds/"> nix debug spurrious rebuilds </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/earthly/"> earthly </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/rebuilderd/"> rebuilderd </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/reproducible-builds.org/"> reproducible-builds.org </a></ol><li><input id=sidebar-input-router type=checkbox> <label class=h3 for=sidebar-input-router>router</label> <ol><li><input id=sidebar-input-router-lightning-router type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router>lightning router</label> <ol><li><input id=sidebar-input-router-lightning-router-captive-portal type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router-captive-portal>captive portal</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/RFC 6585 (Additional HTTP Status Codes)/"> RFC 6585 (Additional HTTP Status Codes) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/arubanetworks captive portal/"> arubanetworks captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal/"> captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal (wikipedia)/"> captive portal (wikipedia) </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/lightning router overview/"> lightning router overview </a></ol></ol><li><input id=sidebar-input-statistics-probability type=checkbox> <label class=h3 for=sidebar-input-statistics-probability>statistics probability</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/CDF confidence bands - DKW inequality/"> CDF confidence bands - DKW inequality </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/G-test - multinomial goodness-of-fit/"> G-test - multinomial goodness-of-fit </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/MAD - median absolute deviation/"> MAD - median absolute deviation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/cheat sheet/"> cheat sheet </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/herbie - float error fixer/"> herbie - float error fixer </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/kelly criterion + ELO/"> kelly criterion + ELO </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/multinomial distribution/"> multinomial distribution </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/p-value/"> p-value </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/standard error/"> standard error </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/testing whether a coin is fair/"> testing whether a coin is fair </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/winsorize/"> winsorize </a></ol></ol></nav></div><nav aria-label="Secondary navigation" class="notes-toc d-none d-xl-block col-xl-4"><div class=page-links><h3 class=text-muted>on this page</h3><nav id=table-of-contents><ul><li><a class=link-internal href=https://phlip9.com/notes/misc/rgbxmas/#rgbxmas>rgbxmas</a> <ul><li><a class=link-internal href=https://phlip9.com/notes/misc/rgbxmas/#setup>setup</a><li><a class=link-internal href=https://phlip9.com/notes/misc/rgbxmas/#blink-the-board-led>blink the board LED</a><li><a class=link-internal href=https://phlip9.com/notes/misc/rgbxmas/#getting-help-from-the-repl>getting help from the REPL</a><li><a class=link-internal href=https://phlip9.com/notes/misc/rgbxmas/#displaying-text>displaying text</a><li><a class=link-internal href=https://phlip9.com/notes/misc/rgbxmas/#demo-code>demo code</a><li><a class=link-internal href=https://phlip9.com/notes/misc/rgbxmas/#for-reference-one-time-setup-process>(for reference) one-time setup process</a></ul></ul></nav></div></nav><main class="notes-content tags-content col-lg-11 col-xl-8"><h1 id=rgbxmas>rgbxmas</h1><p class=text-muted>2022-12-21 · 21 min read<ul class=tags><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/circuitpython/>#circuitpython</a></ul><h2 id=setup>setup <a aria-label="anchor link" class=anchor-link href=#setup> # </a></h2><p>First, plug the USB cable into your machine (macOS, Windows, Linux, whatever). The board should power up and show the little demo; press the UP button to go to the next screen.<p>On your machine, a USB-drive called <code>CIRCUITPY</code> should also pop up. This is the <a href=https://www.adafruit.com/product/4745>Adafruit Matrix Portal</a> set up with <a href=https://circuitpython.org/>CircuitPython</a> ready for programming.<p>The <a href=https://www.adafruit.com/product/4745>Matrix Portal</a>'s got lots of features and room for other peripherals and sensors. it can even connect to stuff on the internet, so you can make a weather display, read some tweets, show the bitcoin price... : )<p>In the <code>CIRCUITPY</code> directory, there should be a <code>code.py</code> file. This contains the code for the demo, which is also listed below, see: <a href=https://phlip9.com/notes/misc/rgbxmas/#demo-code>demo code</a>.<p>CircuitPython makes it super painless to write code for little microcontroller boards like this. It ain't gonna be the fastest, but it's pretty easy to get stated. To get some basic code going, you literally just edit the <code>code.py</code> file, save it, and the board will auto-restart with the new updates.<p>I'd probably start with the Mu editor here: <a href=https://codewith.mu/en/download>https://codewith.mu/en/download</a>. It's bare-bones, but it'll work in the beginning.<p>I've already setup the board so everything <em>should</em> be good to go. With the board plugged in, just open the Mu editor, press the "Mode" icon, and select "CircuitPython". Then you should be able to edit the code, save, and see the changes appear on the device.<p>Also check out Adafruit's MatrixPortal overview: <a href=https://learn.adafruit.com/adafruit-matrixportal-m4/overview>https://learn.adafruit.com/adafruit-matrixportal-m4/overview</a><p>and the CircuitPython Essentials guide: <a href=https://learn.adafruit.com/circuitpython-essentials/circuitpython-essentials>https://learn.adafruit.com/circuitpython-essentials/circuitpython-essentials</a><p>and the detailed CircuitPython core modules documentation: <a href=https://docs.circuitpython.org/en/latest/shared-bindings/index.html>https://docs.circuitpython.org/en/latest/shared-bindings/index.html</a><h2 id=blink-the-board-led>blink the board LED <a aria-label="anchor link" class=anchor-link href=#blink-the-board-led> # </a></h2><p>Here's a basic example to get started: it blinks an LED on the board itself (not the display) on/off every 0.5 seconds.<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span style=color:#65737e;># file: code.py
</span><span>
</span><span style=color:#b48ead;>import </span><span>board
</span><span style=color:#b48ead;>import </span><span>digitalio
</span><span style=color:#b48ead;>import </span><span>time
</span><span>
</span><span style=color:#65737e;># This a the little red LED on the MatrixPortal m4 board,
</span><span style=color:#65737e;># not the big LED matrix panel. It's located right above
</span><span style=color:#65737e;># the "adafruit" logo.
</span><span>led = digitalio.</span><span style=color:#bf616a;>DigitalInOut</span><span>(board.</span><span style=color:#bf616a;>LED</span><span>)
</span><span>led.direction = digitalio.Direction.</span><span style=color:#bf616a;>OUTPUT
</span><span>
</span><span style=color:#65737e;># This block loops endlessly
</span><span style=color:#b48ead;>while </span><span style=color:#d08770;>True</span><span>:
</span><span>    </span><span style=color:#65737e;># Turn on the LED, then wait for 0.5 seconds
</span><span>    led.value = </span><span style=color:#d08770;>True
</span><span>    time.</span><span style=color:#bf616a;>sleep</span><span>(</span><span style=color:#d08770;>0.5</span><span>)
</span><span>
</span><span>    </span><span style=color:#65737e;># Turn off the LED, then wait for 0.5 seconds
</span><span>    led.value = </span><span style=color:#d08770;>False
</span><span>    time.</span><span style=color:#bf616a;>sleep</span><span>(</span><span style=color:#d08770;>0.5</span><span>)
</span></code></pre><h2 id=getting-help-from-the-repl>getting help from the REPL <a aria-label="anchor link" class=anchor-link href=#getting-help-from-the-repl> # </a></h2><p>The panel opened by the "Serial" button doesn't just show the <code>print</code> output of the device, but also let's you interact with it. This is called a REPL (Read-Evaluate-Print-Loop) and lets you quickly play with bits of code or explore different modules.<p>To enter the REPL:<p>If your program has finished, you should see this message:<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>Auto-reload is on. Simply save files over USB to run them or enter REPL to disable.
</span><span>code.py output:
</span><span>
</span><span>Code done running.
</span><span>
</span><span>Press any key to enter the REPL. Use CTRL-D to reload.
</span></code></pre><p>In this case just press the "Enter" key in the Serial box and you should see the REPL pop up:<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span>Adafruit CircuitPython </span><span style=color:#d08770;>7.3.3 </span><span>on </span><span style=color:#d08770;>2022</span><span>-08-</span><span style=color:#d08770;>29</span><span>; Adafruit Matrix Portal M4 </span><span style=color:#b48ead;>with </span><span>samd51j19
</span><span>>>>
</span></code></pre><p>If some code is running (like the infinite blink example above), you may need to hit CTRL-C to stop the program first (though it seems a bit flaky, I had to hold the keys down for a second or two to get it to work).<p>With the REPL open, we can see all the available built-in modules by typing "import " (with the space) then hitting the TAB key to auto-complete:<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span>>>> </span><span style=color:#b48ead;>import </span><span>^</span><span style=color:#bf616a;>TAB
</span><span>builtins        micropython     __future__      _asyncio
</span><span>_bleio          adafruit_bus_device
</span><span>adafruit_bus_device.i2c_device  adafruit_bus_device.spi_device
</span><span>adafruit_pixelbuf               alarm           analogio
</span><span>array           atexit          audiobusio      audiocore
</span><span>audioio         audiomixer      audiomp3        binascii
</span><span>bitbangio       bitmaptools     board           busio
</span><span>collections     countio         digitalio       displayio
</span><span>errno           fontio          framebufferio   frequencyio
</span><span>gc              getpass         gifio           i2cperipheral
</span><span>io              json            keypad          math
</span><span>microcontroller                 msgpack         neopixel_write
</span><span>onewireio       os              ps2io           pulseio
</span><span>pwmio           rainbowio       random          re
</span><span>rgbmatrix       rotaryio        rtc             samd
</span><span>sdcardio        select          storage         struct
</span><span>supervisor      synthio         sys             terminalio
</span><span>time            touchio         traceback       usb_cdc
</span><span>usb_hid         usb_midi        uselect         vectorio
</span><span>watchdog        zlib
</span></code></pre><p>Don't worry about what most of these do for now.<p>If you want to get very very detailed documentation about these modules, you can check the <a href=https://docs.circuitpython.org/en/latest/shared-bindings/index.html#modules>CircuitPython Modules reference</a>.<p>Let's check out the <code>time</code> module we used in the previous example:<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span>>>> </span><span style=color:#b48ead;>import </span><span>time
</span><span>>>> </span><span style=color:#96b5b4;>help</span><span>(time)
</span><span>object &LTmodule '</span><span style=color:#a3be8c;>time</span><span>'> is of </span><span style=color:#96b5b4;>type </span><span>module
</span><span>  __name__ -- time
</span><span>  monotonic -- &LTfunction>
</span><span>  sleep -- &LTfunction>
</span><span>  struct_time -- <</span><span style=background-color:#bf616a;color:#2b303b;>class</span><span> '</span><span style=color:#a3be8c;>struct_time</span><span>'>
</span><span>  localtime -- &LTfunction>
</span><span>  mktime -- &LTfunction>
</span><span>  time -- &LTfunction>
</span><span>  monotonic_ns -- &LTfunction>
</span></code></pre><p>We can get the number of seconds since the board powered on by calling <code>time.monotonic()</code>:<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span>>>> time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span style=color:#d08770;>1003.53
</span></code></pre><p>We use this one a lot in the demo.<p>From the REPL we can define functions and variables just like we expect:<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span>>>> </span><span style=background-color:#bf616a;color:#2b303b;>def</span><span> </span><span style=color:#bf616a;>f</span><span>(x):
</span><span>	</span><span style=color:#65737e;># f(x) = 4x^2 - 4x - 24
</span><span>	x_squared = x**</span><span style=color:#d08770;>2
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#d08770;>4</span><span>*x_squared - </span><span style=color:#d08770;>4</span><span>*x - </span><span style=color:#d08770;>24
</span><span>>>> </span><span style=color:#bf616a;>f</span><span>(</span><span style=color:#d08770;>0</span><span>)
</span><span>-</span><span style=color:#d08770;>24
</span><span>>>> </span><span style=color:#96b5b4;>print</span><span>("</span><span style=color:#a3be8c;>wow look f(3) is zero:</span><span>", </span><span style=color:#bf616a;>f</span><span>(</span><span style=color:#d08770;>3</span><span>))
</span></code></pre><p>We can exit the REPL again by hitting CTRL-D.<h2 id=displaying-text>displaying text <a aria-label="anchor link" class=anchor-link href=#displaying-text> # </a></h2><p>This example requires the <code>adafruit_display_text</code> and <code>adafruit_matrixportal</code> libraries, which are not built-in modules. Most interesting libraries are not built-in, as they are updated more frequently than the base modules and would otherwise take up too much space on the device.<p>To install these community libraries, go to <a href=https://circuitpython.org/libraries>https://circuitpython.org/libraries</a> and download the zip file under "Bundle for Version 7.X" (I've installed CircuitPython version 7.3.3).<p>Opening the <code>adafruit-circuitpython-bundle-7.x.zip</code> file there should be a <code>lib</code> folder, with the <code>adafruit_display_text</code> and <code>adafruit_matrixportal</code> folders inside (among many others).<p>Copy the those two folders from the <code>.zip</code> file to the mounted <code>CIRCUITPY/lib/</code> folder to install the library.<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span style=color:#b48ead;>import </span><span>terminalio
</span><span>
</span><span style=color:#b48ead;>from </span><span>adafruit_display_text </span><span style=color:#b48ead;>import </span><span>label
</span><span style=color:#b48ead;>from </span><span>adafruit_matrixportal.matrix </span><span style=color:#b48ead;>import </span><span>Matrix
</span><span>
</span><span style=color:#65737e;># This call creates the Matrix display object.
</span><span style=color:#65737e;>#
</span><span style=color:#65737e;># `bit_depth` can range from 1 to 6; higher numbers allow
</span><span style=color:#65737e;># for more color shades to be displayed, but increase memory
</span><span style=color:#65737e;># usage and slow down your Python code.
</span><span style=color:#65737e;>#
</span><span style=color:#65737e;># If you just want to show primary colors
</span><span style=color:#65737e;># plus black and white, use 1. Otherwise, try 3, 4 and 5
</span><span style=color:#65737e;># to see which effect you like best.
</span><span>matrix = </span><span style=color:#bf616a;>Matrix</span><span>(
</span><span>    </span><span style=color:#bf616a;>bit_depth</span><span>=</span><span style=color:#d08770;>4</span><span>,
</span><span>)
</span><span>display = matrix.display
</span><span>
</span><span style=color:#65737e;># this is a text area with two lines like
</span><span style=color:#65737e;># |       Hello       |
</span><span style=color:#65737e;># |       World       |
</span><span>text_area = label.</span><span style=color:#bf616a;>Label</span><span>(
</span><span>    terminalio.</span><span style=color:#bf616a;>FONT</span><span>,
</span><span>    </span><span style=color:#bf616a;>text</span><span>="</span><span style=color:#a3be8c;>Hello</span><span style=color:#96b5b4;>\n</span><span style=color:#a3be8c;>World</span><span>", </span><span style=color:#65737e;># '\n' stands for newline
</span><span>    </span><span style=color:#bf616a;>color</span><span>=</span><span style=color:#d08770;>0x113311</span><span>, </span><span style=color:#65737e;># this is the RGB (Red Green Blue) color
</span><span>)
</span><span style=color:#65737e;># this is the starting position of the text on the board,
</span><span style=color:#65737e;># counting pixels from the top-left.
</span><span>text_area.x = </span><span style=color:#d08770;>16
</span><span>text_area.y = </span><span style=color:#d08770;>8
</span><span>display.</span><span style=color:#bf616a;>show</span><span>(text_area)
</span><span>
</span><span style=color:#65737e;># You can add more effects in this loop. For instance, maybe
</span><span style=color:#65737e;># you want to set the color of each label to a different
</span><span style=color:#65737e;># value
</span><span style=color:#b48ead;>while </span><span style=color:#d08770;>True</span><span>:
</span><span>    display.</span><span style=color:#bf616a;>refresh</span><span>()
</span></code></pre><h2 id=demo-code>demo code <a aria-label="anchor link" class=anchor-link href=#demo-code> # </a></h2><p>This demo shows a few screens with some cool graphics.<p>Note that it requires the <code>adafruit_display_text</code> library is copied into the <code>CIRCUITPY/lib/</code> directory. See <a href=https://phlip9.com/notes/misc/rgbxmas/#displaying-text>displaying text</a> for more details on libraries.<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span style=color:#65737e;># code.py
</span><span>
</span><span style=color:#b48ead;>import </span><span>random
</span><span style=color:#b48ead;>import </span><span>time
</span><span style=color:#b48ead;>import </span><span>math
</span><span style=color:#b48ead;>from </span><span>math </span><span style=color:#b48ead;>import </span><span>trunc, sin, cos, sqrt
</span><span>
</span><span style=color:#b48ead;>import </span><span>board
</span><span style=color:#b48ead;>import </span><span>countio
</span><span style=color:#b48ead;>import </span><span>digitalio
</span><span style=color:#b48ead;>import </span><span>displayio
</span><span style=color:#b48ead;>import </span><span>framebufferio
</span><span style=color:#b48ead;>import </span><span>rgbmatrix
</span><span style=color:#b48ead;>import </span><span>terminalio
</span><span style=color:#b48ead;>import </span><span>vectorio
</span><span>
</span><span style=color:#b48ead;>from </span><span>adafruit_display_text </span><span style=color:#b48ead;>import </span><span>label
</span><span>
</span><span style=color:#65737e;># create a new `Display` object for the big RGB matrix display
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>make_display</span><span>(</span><span style=color:#bf616a;>bit_depth</span><span>=</span><span style=color:#d08770;>6</span><span>, </span><span style=color:#bf616a;>brightness</span><span>=</span><span style=color:#d08770;>0.5</span><span>):
</span><span>    displayio.</span><span style=color:#bf616a;>release_displays</span><span>()
</span><span>    matrix = rgbmatrix.</span><span style=color:#bf616a;>RGBMatrix</span><span>(
</span><span>        </span><span style=color:#bf616a;>width</span><span>=</span><span style=color:#d08770;>64</span><span>,
</span><span>        </span><span style=color:#bf616a;>height</span><span>=</span><span style=color:#d08770;>32</span><span>,
</span><span>        </span><span style=color:#bf616a;>bit_depth</span><span>=bit_depth,
</span><span>        </span><span style=color:#65737e;># NOTE: for some reason the board has reversed the green and blue pins,
</span><span>        </span><span style=color:#65737e;># so we just swap them here to get standard RGB ordering
</span><span>        </span><span style=color:#bf616a;>rgb_pins</span><span>=[
</span><span>            board.</span><span style=color:#bf616a;>MTX_R1</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_B1</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_G1</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_R2</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_B2</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_G2</span><span>,
</span><span>        ],
</span><span>        </span><span style=color:#bf616a;>addr_pins</span><span>=[
</span><span>            board.</span><span style=color:#bf616a;>MTX_ADDRA</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_ADDRB</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_ADDRC</span><span>,
</span><span>            board.</span><span style=color:#bf616a;>MTX_ADDRD</span><span>,
</span><span>        ],
</span><span>        </span><span style=color:#bf616a;>clock_pin</span><span>=board.</span><span style=color:#bf616a;>MTX_CLK</span><span>,
</span><span>        </span><span style=color:#bf616a;>latch_pin</span><span>=board.</span><span style=color:#bf616a;>MTX_LAT</span><span>,
</span><span>        </span><span style=color:#bf616a;>output_enable_pin</span><span>=board.</span><span style=color:#bf616a;>MTX_OE
</span><span>    )
</span><span>    display = framebufferio.</span><span style=color:#bf616a;>FramebufferDisplay</span><span>(matrix)
</span><span>    display.brightness = brightness
</span><span>    </span><span style=color:#b48ead;>return </span><span>display
</span><span>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>rgb_to_int</span><span>(</span><span style=color:#bf616a;>r</span><span>, </span><span style=color:#bf616a;>g</span><span>, </span><span style=color:#bf616a;>b</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>(r << </span><span style=color:#d08770;>16</span><span>) | (g << </span><span style=color:#d08770;>8</span><span>) | b
</span><span>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>percent_to_byte</span><span>(</span><span style=color:#bf616a;>t</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#96b5b4;>round</span><span>(t * </span><span style=color:#d08770;>255.0</span><span>) & </span><span style=color:#d08770;>255
</span><span>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>hue_to_rgb_ratio</span><span>(</span><span style=color:#bf616a;>p</span><span>, </span><span style=color:#bf616a;>q</span><span>, </span><span style=color:#bf616a;>t</span><span>):
</span><span>    </span><span style=color:#b48ead;>if </span><span>t < </span><span style=color:#d08770;>0.0</span><span>:
</span><span>        t += </span><span style=color:#d08770;>1.0
</span><span>    </span><span style=color:#b48ead;>elif </span><span>t > </span><span style=color:#d08770;>1.0</span><span>:
</span><span>        t -= </span><span style=color:#d08770;>1.0
</span><span>
</span><span>    </span><span style=color:#b48ead;>if </span><span>t < </span><span style=color:#d08770;>0.166667</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span>p + (q - p) * </span><span style=color:#d08770;>6.0 </span><span>* t
</span><span>    </span><span style=color:#b48ead;>elif </span><span>t < </span><span style=color:#d08770;>0.5</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span>q
</span><span>    </span><span style=color:#b48ead;>elif </span><span>t < </span><span style=color:#d08770;>0.666667</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span>p + (q - p) * (</span><span style=color:#d08770;>0.666667 </span><span>- t) * </span><span style=color:#d08770;>6.0
</span><span>    </span><span style=color:#b48ead;>else</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span>p
</span><span>
</span><span style=color:#65737e;># convert Hue-Saturation-Lightness to RGB color
</span><span style=color:#65737e;># `h` is the Hue, in degrees (0 -> 360)
</span><span style=color:#65737e;># `s` is the Saturation, between 0.0 and 1.0
</span><span style=color:#65737e;># `l` is the Lightness, between 0.0 and 1.0
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>hsl</span><span>(</span><span style=color:#bf616a;>h</span><span>, </span><span style=color:#bf616a;>s</span><span>, </span><span style=color:#bf616a;>l</span><span>):
</span><span>    </span><span style=color:#65737e;># all greys if saturation is 0
</span><span>    </span><span style=color:#b48ead;>if </span><span>s == </span><span style=color:#d08770;>0.0</span><span>:
</span><span>        l = </span><span style=color:#bf616a;>percent_to_byte</span><span>(l)
</span><span>        </span><span style=color:#b48ead;>return </span><span style=color:#bf616a;>rgb_to_int</span><span>(l, l, l)
</span><span>
</span><span>    h = h / </span><span style=color:#d08770;>360.0
</span><span>
</span><span>    q = </span><span style=color:#d08770;>0.0
</span><span>    </span><span style=color:#b48ead;>if </span><span>l < </span><span style=color:#d08770;>0.5</span><span>:
</span><span>        q = l * (</span><span style=color:#d08770;>1.0 </span><span>+ s)
</span><span>    </span><span style=color:#b48ead;>else</span><span>:
</span><span>        q = l + s - (l * s)
</span><span>    p = </span><span style=color:#d08770;>2.0 </span><span>* l - q
</span><span>
</span><span>    r = </span><span style=color:#bf616a;>percent_to_byte</span><span>(</span><span style=color:#bf616a;>hue_to_rgb_ratio</span><span>(p, q, h + </span><span style=color:#d08770;>0.333333</span><span>))
</span><span>    g = </span><span style=color:#bf616a;>percent_to_byte</span><span>(</span><span style=color:#bf616a;>hue_to_rgb_ratio</span><span>(p, q, h))
</span><span>    b = </span><span style=color:#bf616a;>percent_to_byte</span><span>(</span><span style=color:#bf616a;>hue_to_rgb_ratio</span><span>(p, q, h - </span><span style=color:#d08770;>0.333333</span><span>))
</span><span>
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#bf616a;>rgb_to_int</span><span>(r, g, b)
</span><span>
</span><span style=color:#65737e;># the fractional part of a float. ex: `frac(1.75) == 0.75`.
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>frac</span><span>(</span><span style=color:#bf616a;>x</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>x - </span><span style=color:#bf616a;>trunc</span><span>(x)
</span><span>
</span><span style=color:#65737e;># clamp `x` so the output is always between `x_min` and `x_max`.
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>clamp</span><span>(</span><span style=color:#bf616a;>x_min</span><span>, </span><span style=color:#bf616a;>x_max</span><span>, </span><span style=color:#bf616a;>x</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#96b5b4;>min</span><span>(x_max, </span><span style=color:#96b5b4;>max</span><span>(x_min, x))
</span><span>
</span><span style=color:#65737e;># linearly interpolate between `start` and `end`, using `t` between 0.0 and 1.0
</span><span style=color:#65737e;># as the "interpolation distance"
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>lerp</span><span>(</span><span style=color:#bf616a;>start</span><span>, </span><span style=color:#bf616a;>end</span><span>, </span><span style=color:#bf616a;>t</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>t * start + (</span><span style=color:#d08770;>1.0 </span><span>- t) * end
</span><span>
</span><span style=color:#65737e;># saw-tooth signal, between y = 0.0 and 1.0, with period = 1.0
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>saw</span><span>(</span><span style=color:#bf616a;>t</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>math.</span><span style=color:#bf616a;>fabs</span><span>(</span><span style=color:#d08770;>2.0 </span><span>* </span><span style=color:#bf616a;>frac</span><span>(t) - </span><span style=color:#d08770;>1.0</span><span>)
</span><span>
</span><span style=color:#65737e;># exponential ease in-out function
</span><span style=color:#65737e;># see: &LThttps://easings.net/#easeInOutExpo>
</span><span style=color:#65737e;># this is defined for x between 0.0 and 1.0
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>ease_in_out_exp</span><span>(</span><span style=color:#bf616a;>x</span><span>):
</span><span>    </span><span style=color:#b48ead;>if </span><span>x < </span><span style=color:#d08770;>0.5</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span style=color:#d08770;>0.5 </span><span>* math.</span><span style=color:#bf616a;>pow</span><span>(</span><span style=color:#d08770;>2.0</span><span>, </span><span style=color:#d08770;>20.0 </span><span>* x - </span><span style=color:#d08770;>10.0</span><span>)
</span><span>    </span><span style=color:#b48ead;>else</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span style=color:#d08770;>1.0 </span><span>- </span><span style=color:#d08770;>0.5 </span><span>* math.</span><span style=color:#bf616a;>pow</span><span>(</span><span style=color:#d08770;>2.0</span><span>, -</span><span style=color:#d08770;>20.0 </span><span>* x + </span><span style=color:#d08770;>10.0</span><span>)
</span><span>
</span><span style=color:#65737e;># see: &LThttps://mathworld.wolfram.com/SincFunction.html>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>sinc</span><span>(</span><span style=color:#bf616a;>x</span><span>):
</span><span>    a = math.pi * x
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#bf616a;>sin</span><span>(a) / (a+</span><span style=color:#d08770;>0.001</span><span>)
</span><span>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>parabola</span><span>(</span><span style=color:#bf616a;>x</span><span>, </span><span style=color:#bf616a;>k</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>math.</span><span style=color:#bf616a;>pow</span><span>(</span><span style=color:#d08770;>4.0 </span><span>* x * (</span><span style=color:#d08770;>1.0 </span><span>- x), k)
</span><span>
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>Screen</span><span style=color:#eff1f5;>:
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        </span><span style=color:#b48ead;>pass
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        </span><span style=color:#b48ead;>pass
</span><span>
</span><span style=color:#65737e;># shows "PRESS UP >>", with the ">>" bouncing every few seconds.
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>StartScreen</span><span style=color:#eff1f5;>(</span><span style=color:#a3be8c;>Screen</span><span style=color:#eff1f5;>):
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        group = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>
</span><span>        </span><span style=color:#65737e;># the "PRESS UP" text
</span><span>        press_up = label.</span><span style=color:#bf616a;>Label</span><span>(terminalio.</span><span style=color:#bf616a;>FONT</span><span>, </span><span style=color:#bf616a;>text</span><span>="</span><span style=color:#a3be8c;>PRESS UP</span><span>")
</span><span>        press_up.x = </span><span style=color:#d08770;>4
</span><span>        press_up.y = </span><span style=color:#d08770;>14
</span><span>        group.</span><span style=color:#bf616a;>append</span><span>(press_up)
</span><span>
</span><span>        </span><span style=color:#65737e;># the two '>' arrows on the right
</span><span>        arrow_group = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>
</span><span>        arrow_right_1 = label.</span><span style=color:#bf616a;>Label</span><span>(terminalio.</span><span style=color:#bf616a;>FONT</span><span>, </span><span style=color:#bf616a;>text</span><span>="</span><span style=color:#a3be8c;>></span><span>")
</span><span>        arrow_right_1.x = </span><span style=color:#d08770;>52
</span><span>        arrow_right_1.y = </span><span style=color:#d08770;>14
</span><span>        arrow_group.</span><span style=color:#bf616a;>append</span><span>(arrow_right_1)
</span><span>
</span><span>        arrow_right_2 = label.</span><span style=color:#bf616a;>Label</span><span>(terminalio.</span><span style=color:#bf616a;>FONT</span><span>, </span><span style=color:#bf616a;>text</span><span>="</span><span style=color:#a3be8c;>></span><span>")
</span><span>        arrow_right_2.x = </span><span style=color:#d08770;>54
</span><span>        arrow_right_2.y = </span><span style=color:#d08770;>14
</span><span>        arrow_group.</span><span style=color:#bf616a;>append</span><span>(arrow_right_2)
</span><span>        group.</span><span style=color:#bf616a;>append</span><span>(arrow_group)
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(group)
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.arrow_group = arrow_group
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>
</span><span>        </span><span style=color:#65737e;>#  self.arrow_group.x = round(2.0 * ease_in_out_exp(0.5 * sin(3.0 * t) + 0.5) - 4.0)
</span><span>
</span><span>        </span><span style=color:#65737e;>#  t = math.fmod(t, 5.0)
</span><span>        </span><span style=color:#65737e;>#  self.arrow_group.x = round(8.0 * sinc(0.54 * (t - 2.5)))
</span><span>
</span><span>        </span><span style=color:#65737e;># repeat "bounce" every 3 sec
</span><span>        t = math.</span><span style=color:#bf616a;>fmod</span><span>(t, </span><span style=color:#d08770;>3.0</span><span>)
</span><span>        </span><span style=color:#bf616a;>self</span><span>.arrow_group.x = </span><span style=color:#96b5b4;>round</span><span>(</span><span style=color:#d08770;>4.0 </span><span>- </span><span style=color:#d08770;>4.0 </span><span>* </span><span style=color:#bf616a;>parabola</span><span>(</span><span style=color:#d08770;>0.333333 </span><span>* t, </span><span style=color:#d08770;>7</span><span>))
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>refresh</span><span>()
</span><span>
</span><span style=color:#65737e;># makes a big circle wave across the screen in a loop
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>CircleScreen</span><span style=color:#eff1f5;>(</span><span style=color:#a3be8c;>Screen</span><span style=color:#eff1f5;>):
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        group = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>
</span><span>        palette = displayio.</span><span style=color:#bf616a;>Palette</span><span>(</span><span style=color:#d08770;>2</span><span>)
</span><span>        palette[</span><span style=color:#d08770;>0</span><span>] = </span><span style=color:#bf616a;>hsl</span><span>(</span><span style=color:#d08770;>215</span><span>, </span><span style=color:#d08770;>0.42</span><span>, </span><span style=color:#d08770;>0.34</span><span>)
</span><span>        palette[</span><span style=color:#d08770;>1</span><span>] = </span><span style=color:#bf616a;>hsl</span><span>(</span><span style=color:#d08770;>0</span><span>, </span><span style=color:#d08770;>0</span><span>, </span><span style=color:#d08770;>0.0</span><span>)
</span><span>
</span><span>        circle_outer = vectorio.</span><span style=color:#bf616a;>Circle</span><span>(
</span><span>            </span><span style=color:#bf616a;>pixel_shader</span><span>=palette,
</span><span>            </span><span style=color:#bf616a;>radius</span><span>=</span><span style=color:#d08770;>16</span><span>,
</span><span>            </span><span style=color:#bf616a;>x</span><span>=</span><span style=color:#d08770;>0</span><span>,
</span><span>            </span><span style=color:#bf616a;>y</span><span>=</span><span style=color:#d08770;>0</span><span>,
</span><span>            </span><span style=color:#bf616a;>color_index</span><span>=</span><span style=color:#d08770;>0</span><span>,
</span><span>        )
</span><span>        group.</span><span style=color:#bf616a;>append</span><span>(circle_outer)
</span><span>
</span><span>        circle_inner = vectorio.</span><span style=color:#bf616a;>Circle</span><span>(
</span><span>            </span><span style=color:#bf616a;>pixel_shader</span><span>=palette,
</span><span>            </span><span style=color:#bf616a;>radius</span><span>=</span><span style=color:#d08770;>15</span><span>,
</span><span>            </span><span style=color:#bf616a;>x</span><span>=</span><span style=color:#d08770;>0</span><span>,
</span><span>            </span><span style=color:#bf616a;>y</span><span>=</span><span style=color:#d08770;>0</span><span>,
</span><span>            </span><span style=color:#bf616a;>color_index</span><span>=</span><span style=color:#d08770;>1</span><span>,
</span><span>        )
</span><span>        group.</span><span style=color:#bf616a;>append</span><span>(circle_inner)
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(group)
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.palette = palette
</span><span>        </span><span style=color:#bf616a;>self</span><span>.group = group
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>
</span><span>        </span><span style=color:#65737e;># make the circle wave across the screen
</span><span>        </span><span style=color:#bf616a;>self</span><span>.group.x = </span><span style=color:#96b5b4;>round</span><span>(math.</span><span style=color:#bf616a;>fmod</span><span>(</span><span style=color:#d08770;>64.0 </span><span>* t, </span><span style=color:#d08770;>110.0</span><span>) - </span><span style=color:#d08770;>25.0</span><span>)
</span><span>        </span><span style=color:#bf616a;>self</span><span>.group.y = </span><span style=color:#bf616a;>int</span><span>(</span><span style=color:#d08770;>8.0 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>3.0 </span><span>* t)) + </span><span style=color:#d08770;>16
</span><span>
</span><span>        </span><span style=color:#65737e;># slowly rotate the hue of the circle over time
</span><span>        t_color = </span><span style=color:#d08770;>0.5 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>1.0 </span><span>* t) + </span><span style=color:#d08770;>0.5
</span><span>        hue = </span><span style=color:#bf616a;>lerp</span><span>(</span><span style=color:#d08770;>0.0</span><span>, </span><span style=color:#d08770;>180.0</span><span>, t_color)
</span><span>        </span><span style=color:#bf616a;>self</span><span>.palette[</span><span style=color:#d08770;>0</span><span>] = </span><span style=color:#bf616a;>hsl</span><span>(hue, </span><span style=color:#d08770;>0.75</span><span>, </span><span style=color:#d08770;>0.50</span><span>)
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>refresh</span><span>()
</span><span>
</span><span style=color:#65737e;># test the display's color
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>ColorTestScreen</span><span style=color:#eff1f5;>(</span><span style=color:#a3be8c;>Screen</span><span style=color:#eff1f5;>):
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        width = </span><span style=color:#d08770;>64
</span><span>        height = </span><span style=color:#d08770;>32
</span><span>        num_colors = </span><span style=color:#d08770;>256
</span><span>
</span><span>        </span><span style=color:#65737e;># start with all greyscale
</span><span>        palette = displayio.</span><span style=color:#bf616a;>Palette</span><span>(num_colors)
</span><span>        </span><span style=color:#b48ead;>for </span><span>idx </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(num_colors):
</span><span>            palette[idx] = </span><span style=color:#bf616a;>rgb_to_int</span><span>(idx, idx, idx)
</span><span>
</span><span>        </span><span style=color:#65737e;># fill the bitmap with 0..=255
</span><span>        bm = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>        </span><span style=color:#b48ead;>for </span><span>y </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(height):
</span><span>            </span><span style=color:#b48ead;>for </span><span>x </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(width):
</span><span>                </span><span style=color:#65737e;># use the same color every 8 pixels in the y-direction
</span><span>                color_idx = (y // </span><span style=color:#d08770;>8</span><span>) * width + x
</span><span>                bm[x, y] = color_idx
</span><span>        bm.</span><span style=color:#bf616a;>dirty</span><span>()
</span><span>
</span><span>        tg = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>
</span><span>        group = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        group.</span><span style=color:#bf616a;>append</span><span>(tg)
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(group)
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.num_colors = num_colors
</span><span>        </span><span style=color:#bf616a;>self</span><span>.palette = palette
</span><span>        </span><span style=color:#bf616a;>self</span><span>.prev_update_t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>        dt = t - </span><span style=color:#bf616a;>self</span><span>.prev_update_t
</span><span>
</span><span>        </span><span style=color:#65737e;># every 5 sec change the color spectrum to a random hue and saturation
</span><span>        </span><span style=color:#65737e;># with lightness evenly between 0.0 and 1.0
</span><span>        </span><span style=color:#b48ead;>if </span><span>dt > </span><span style=color:#d08770;>5.0</span><span>:
</span><span>            num_colors = </span><span style=color:#bf616a;>self</span><span>.num_colors
</span><span>            hue = random.</span><span style=color:#bf616a;>randint</span><span>(</span><span style=color:#d08770;>0</span><span>, </span><span style=color:#d08770;>360</span><span>)
</span><span>            saturation = random.</span><span style=color:#bf616a;>random</span><span>()
</span><span>            </span><span style=color:#96b5b4;>print</span><span>(</span><span style=color:#b48ead;>f</span><span>"</span><span style=color:#a3be8c;>hue: </span><span>{hue}</span><span style=color:#a3be8c;>, saturation: </span><span>{saturation}")
</span><span>
</span><span>            </span><span style=color:#b48ead;>for </span><span>idx </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(num_colors):
</span><span>                </span><span style=color:#bf616a;>self</span><span>.palette[idx] = </span><span style=color:#bf616a;>hsl</span><span>(hue, saturation, </span><span style=color:#d08770;>0.5 </span><span>* (idx / num_colors))
</span><span>
</span><span>            </span><span style=color:#bf616a;>self</span><span>.prev_update_t = t
</span><span>            display.</span><span style=color:#bf616a;>refresh</span><span>()
</span><span>
</span><span style=color:#65737e;># run a random [Conway's Game of Life](https://www.wikiwand.com/en/Conway%27s_Game_of_Life)
</span><span style=color:#65737e;># simulation every ~30 sec
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>GameOfLifeScreen</span><span style=color:#eff1f5;>(</span><span style=color:#a3be8c;>Screen</span><span style=color:#eff1f5;>):
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        width = </span><span style=color:#d08770;>64
</span><span>        height = </span><span style=color:#d08770;>32
</span><span>        num_colors = </span><span style=color:#d08770;>2
</span><span>
</span><span>        palette = displayio.</span><span style=color:#bf616a;>Palette</span><span>(num_colors)
</span><span>
</span><span>        bm1 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>        bm2 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>
</span><span>        tg1 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm1, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>        tg2 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm2, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>
</span><span>        g1 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g1.</span><span style=color:#bf616a;>append</span><span>(tg1)
</span><span>
</span><span>        g2 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g2.</span><span style=color:#bf616a;>append</span><span>(tg2)
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(g1)
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.width = width
</span><span>        </span><span style=color:#bf616a;>self</span><span>.height = height
</span><span>        </span><span style=color:#bf616a;>self</span><span>.iter = </span><span style=color:#d08770;>0
</span><span>        </span><span style=color:#bf616a;>self</span><span>.reset_after = </span><span style=color:#d08770;>200
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = bm1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = bm2
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = g1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = g2
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.palette = palette
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>randomize</span><span>(</span><span style=color:#bf616a;>self</span><span>):
</span><span>        curr = </span><span style=color:#bf616a;>self</span><span>.curr
</span><span>        </span><span style=color:#b48ead;>for </span><span>idx </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(</span><span style=color:#bf616a;>self</span><span>.width * </span><span style=color:#bf616a;>self</span><span>.height):
</span><span>            curr[idx] = random.</span><span style=color:#bf616a;>random</span><span>() < </span><span style=color:#d08770;>0.333333
</span><span>
</span><span>        </span><span style=color:#65737e;>#  hue = random.randint(0, 360)
</span><span>        </span><span style=color:#65737e;>#  saturation = (random.random() / 4.0) + 0.5
</span><span>        </span><span style=color:#65737e;>#  lightness = (random.random() / 3.0) + 0.1
</span><span>        </span><span style=color:#65737e;>#  self.palette[1] = hsl(hue, saturation, lightness)
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>apply_life_rule</span><span>(</span><span style=color:#bf616a;>self</span><span>):
</span><span>        curr = </span><span style=color:#bf616a;>self</span><span>.curr
</span><span>
</span><span>        w = </span><span style=color:#bf616a;>self</span><span>.width
</span><span>        h = </span><span style=color:#bf616a;>self</span><span>.height
</span><span>
</span><span>        </span><span style=color:#b48ead;>for </span><span>y </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(h):
</span><span>            yyy = y * w
</span><span>            ym1 = ((y + h - </span><span style=color:#d08770;>1</span><span>) & </span><span style=color:#d08770;>31</span><span>) * w
</span><span>            yp1 = ((y + </span><span style=color:#d08770;>1</span><span>) & </span><span style=color:#d08770;>31</span><span>) * w
</span><span>
</span><span>            xm1 = w - </span><span style=color:#d08770;>1
</span><span>            </span><span style=color:#b48ead;>for </span><span>x </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(w):
</span><span>                xp1 = (x + </span><span style=color:#d08770;>1</span><span>) & </span><span style=color:#d08770;>63
</span><span>                neighbors = (
</span><span>                    curr[xm1 + ym1] + curr[xm1 + yyy] + curr[xm1 + yp1] +
</span><span>                    curr[  x + ym1] +                   curr[  x + yp1] +
</span><span>                    curr[xp1 + ym1] + curr[xp1 + yyy] + curr[xp1 + yp1]
</span><span>                )
</span><span>                </span><span style=color:#bf616a;>self</span><span>.next[x + yyy] = (neighbors == </span><span style=color:#d08770;>3</span><span>) or ((neighbors == </span><span style=color:#d08770;>2</span><span>) and curr[x + yyy])
</span><span>                xm1 = x
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = </span><span style=color:#bf616a;>self</span><span>.next
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = curr
</span><span>
</span><span>        curr_group = </span><span style=color:#bf616a;>self</span><span>.curr_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = </span><span style=color:#bf616a;>self</span><span>.next_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = curr_group
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>
</span><span>        </span><span style=color:#65737e;># slowly change the color
</span><span>        t_color = </span><span style=color:#d08770;>0.5 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>1.0 </span><span>* t) + </span><span style=color:#d08770;>0.5
</span><span>        hue = </span><span style=color:#bf616a;>lerp</span><span>(</span><span style=color:#d08770;>0.0</span><span>, </span><span style=color:#d08770;>180.0</span><span>, t_color)
</span><span>        </span><span style=color:#bf616a;>self</span><span>.palette[</span><span style=color:#d08770;>1</span><span>] = </span><span style=color:#bf616a;>hsl</span><span>(hue, </span><span style=color:#d08770;>0.75</span><span>, </span><span style=color:#d08770;>0.50</span><span>)
</span><span>
</span><span>        </span><span style=color:#65737e;># reset and randomize the state every `self.reset_after` iterations
</span><span>        </span><span style=color:#b48ead;>if </span><span style=color:#bf616a;>self</span><span>.iter == </span><span style=color:#d08770;>0</span><span>:
</span><span>            </span><span style=color:#bf616a;>self</span><span>.</span><span style=color:#bf616a;>randomize</span><span>()
</span><span>        </span><span style=color:#b48ead;>else</span><span>:
</span><span>            </span><span style=color:#bf616a;>self</span><span>.</span><span style=color:#bf616a;>apply_life_rule</span><span>()
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.iter = (</span><span style=color:#bf616a;>self</span><span>.iter + </span><span style=color:#d08770;>1</span><span>) % </span><span style=color:#bf616a;>self</span><span>.reset_after
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(</span><span style=color:#bf616a;>self</span><span>.curr_group)
</span><span>
</span><span style=color:#65737e;># a cool wavy pattern
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>WarpScreen</span><span style=color:#eff1f5;>(</span><span style=color:#a3be8c;>Screen</span><span style=color:#eff1f5;>):
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        width = </span><span style=color:#d08770;>64
</span><span>        height = </span><span style=color:#d08770;>32
</span><span>        num_colors = </span><span style=color:#d08770;>64
</span><span>
</span><span>        palette = displayio.</span><span style=color:#bf616a;>Palette</span><span>(num_colors)
</span><span>        </span><span style=color:#b48ead;>for </span><span>idx </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(num_colors):
</span><span>            </span><span style=color:#65737e;>#  palette[idx] = hsl(240, 0.8, 0.25 * (idx / num_colors))
</span><span>            palette[idx] = </span><span style=color:#bf616a;>hsl</span><span>(</span><span style=color:#d08770;>265</span><span>, </span><span style=color:#d08770;>0.85</span><span>, </span><span style=color:#d08770;>0.95 </span><span>* (idx / num_colors) + </span><span style=color:#d08770;>0.05</span><span>)
</span><span>
</span><span>        bm1 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>        bm2 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>
</span><span>        tg1 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm1, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>        tg2 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm2, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>
</span><span>        g1 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g1.</span><span style=color:#bf616a;>append</span><span>(tg1)
</span><span>
</span><span>        g2 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g2.</span><span style=color:#bf616a;>append</span><span>(tg2)
</span><span>
</span><span>        </span><span style=color:#65737e;>#  display.show(g1)
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.width = width
</span><span>        </span><span style=color:#bf616a;>self</span><span>.height = height
</span><span>        </span><span style=color:#bf616a;>self</span><span>.num_colors = num_colors
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = bm1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = bm2
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = g1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = g2
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        width = </span><span style=color:#bf616a;>self</span><span>.width
</span><span>        height = </span><span style=color:#bf616a;>self</span><span>.height
</span><span>        num_colors = </span><span style=color:#bf616a;>self</span><span>.num_colors
</span><span>        curr = </span><span style=color:#bf616a;>self</span><span>.curr
</span><span>        </span><span style=color:#96b5b4;>next </span><span>= </span><span style=color:#bf616a;>self</span><span>.next
</span><span>
</span><span>        </span><span style=color:#65737e;># render to next framebuffer while current one is shown
</span><span>
</span><span>        t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>
</span><span>        </span><span style=color:#b48ead;>for </span><span>y </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(height):
</span><span>            </span><span style=color:#b48ead;>for </span><span>x </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(width):
</span><span>                tx = </span><span style=color:#d08770;>20.0 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>0.01 </span><span>* x) + </span><span style=color:#d08770;>0.2 </span><span>* t
</span><span>                ty = </span><span style=color:#d08770;>10.0 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>0.01 </span><span>* y) + </span><span style=color:#d08770;>0.2 </span><span>* t
</span><span>                l = (</span><span style=color:#d08770;>0.5 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(tx) * </span><span style=color:#bf616a;>sin</span><span>(ty)) + </span><span style=color:#d08770;>0.5
</span><span>                </span><span style=color:#96b5b4;>next</span><span>[x, y] = </span><span style=color:#96b5b4;>round</span><span>((num_colors - </span><span style=color:#d08770;>1</span><span>) * l)
</span><span>
</span><span>        </span><span style=color:#65737e;># swap frame buffers
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = </span><span style=color:#96b5b4;>next
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = curr
</span><span>
</span><span>        curr_group = </span><span style=color:#bf616a;>self</span><span>.curr_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = </span><span style=color:#bf616a;>self</span><span>.next_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = curr_group
</span><span>
</span><span>        </span><span style=color:#65737e;># show new framebuffer
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(</span><span style=color:#bf616a;>self</span><span>.curr_group)
</span><span>
</span><span>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>noise</span><span>(</span><span style=color:#bf616a;>u</span><span>, </span><span style=color:#bf616a;>v</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#bf616a;>sin</span><span>(u) * </span><span style=color:#bf616a;>sin</span><span>(v)
</span><span>
</span><span style=color:#65737e;># [ [ 0.8 -0.5 ]
</span><span style=color:#65737e;>#   [ 0.5  0.8 ] ] dot [p_x, p_y] * 2
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>mdp</span><span>(</span><span style=color:#bf616a;>x</span><span>, </span><span style=color:#bf616a;>y</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>((</span><span style=color:#d08770;>1.6 </span><span>* x) - (</span><span style=color:#d08770;>1.0 </span><span>* y), (</span><span style=color:#d08770;>1.0 </span><span>* x) + (</span><span style=color:#d08770;>1.6 </span><span>* y))
</span><span>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>fbm4</span><span>(</span><span style=color:#bf616a;>x</span><span>, </span><span style=color:#bf616a;>y</span><span>):
</span><span>    f = </span><span style=color:#d08770;>0.0
</span><span>    f += </span><span style=color:#d08770;>0.5000 </span><span>* </span><span style=color:#bf616a;>noise</span><span>(x, y); (x, y) = </span><span style=color:#bf616a;>mdp</span><span>(x, y)
</span><span>    f += </span><span style=color:#d08770;>0.2500 </span><span>* </span><span style=color:#bf616a;>noise</span><span>(x, y); (x, y) = </span><span style=color:#bf616a;>mdp</span><span>(x, y)
</span><span>    f += </span><span style=color:#d08770;>0.1250 </span><span>* </span><span style=color:#bf616a;>noise</span><span>(x, y); (x, y) = </span><span style=color:#bf616a;>mdp</span><span>(x, y)
</span><span>    f += </span><span style=color:#d08770;>0.0625 </span><span>* </span><span style=color:#bf616a;>noise</span><span>(x, y)
</span><span>    </span><span style=color:#b48ead;>return </span><span>f / </span><span style=color:#d08770;>0.9375
</span><span>
</span><span style=color:#65737e;># another cool pattern that rotates a bit
</span><span style=color:#65737e;># uses the same `sin(x)*sin(y)` but run through a few octaves of modified
</span><span style=color:#65737e;># [Fractional Brownian Motion](https://www.wikiwand.com/en/Fractional_Brownian_motion)
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>Warp2Screen</span><span style=color:#eff1f5;>(</span><span style=color:#a3be8c;>Screen</span><span style=color:#eff1f5;>):
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        width = </span><span style=color:#d08770;>64
</span><span>        height = </span><span style=color:#d08770;>32
</span><span>        num_colors = </span><span style=color:#d08770;>64
</span><span>
</span><span>        palette = displayio.</span><span style=color:#bf616a;>Palette</span><span>(num_colors)
</span><span>        </span><span style=color:#b48ead;>for </span><span>idx </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(num_colors):
</span><span>            </span><span style=color:#65737e;>#  palette[idx] = hsl(240, 0.8, 0.25 * (idx / num_colors))
</span><span>            palette[idx] = </span><span style=color:#bf616a;>hsl</span><span>(</span><span style=color:#d08770;>15</span><span>, </span><span style=color:#d08770;>0.8</span><span>, </span><span style=color:#d08770;>0.6 </span><span>* (idx / num_colors))
</span><span>
</span><span>        bm1 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>        bm2 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>
</span><span>        tg1 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm1, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>        tg2 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm2, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>
</span><span>        g1 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g1.</span><span style=color:#bf616a;>append</span><span>(tg1)
</span><span>
</span><span>        g2 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g2.</span><span style=color:#bf616a;>append</span><span>(tg2)
</span><span>
</span><span>        </span><span style=color:#65737e;>#  display.show(g1)
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.width = width
</span><span>        </span><span style=color:#bf616a;>self</span><span>.height = height
</span><span>        </span><span style=color:#bf616a;>self</span><span>.num_colors = num_colors
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = bm1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = bm2
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = g1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = g2
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        width = </span><span style=color:#bf616a;>self</span><span>.width
</span><span>        height = </span><span style=color:#bf616a;>self</span><span>.height
</span><span>        num_colors = </span><span style=color:#bf616a;>self</span><span>.num_colors
</span><span>        curr = </span><span style=color:#bf616a;>self</span><span>.curr
</span><span>        </span><span style=color:#96b5b4;>next </span><span>= </span><span style=color:#bf616a;>self</span><span>.next
</span><span>
</span><span>        </span><span style=color:#65737e;># render to next framebuffer while current one is shown
</span><span>
</span><span>        t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>
</span><span>        </span><span style=color:#b48ead;>for </span><span>y </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(height):
</span><span>            </span><span style=color:#b48ead;>for </span><span>x </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(width):
</span><span>                u = (x - width) / height
</span><span>                v = (y - height) / height
</span><span>
</span><span>                </span><span style=color:#65737e;># add some back-and-forth rotation
</span><span>                coa = </span><span style=color:#bf616a;>cos</span><span>(</span><span style=color:#d08770;>0.10 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>0.15 </span><span>* t))
</span><span>                sia = </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>0.31 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>0.10 </span><span>* t))
</span><span>                u = (u * coa) - (v * sia)
</span><span>                v = (u * sia) + (v * coa)
</span><span>
</span><span>                u += </span><span style=color:#d08770;>0.03 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>0.54 </span><span>* t)
</span><span>                v += </span><span style=color:#d08770;>0.03 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(</span><span style=color:#d08770;>0.46 </span><span>* t)
</span><span>
</span><span>                </span><span style=color:#65737e;># kinda fractional brownian motion over sin(x)*sin(y)
</span><span>                l = </span><span style=color:#d08770;>0.5 </span><span>* </span><span style=color:#bf616a;>fbm4</span><span>(</span><span style=color:#d08770;>8.0 </span><span>* u, </span><span style=color:#d08770;>8.0 </span><span>* v) + </span><span style=color:#d08770;>0.5
</span><span>
</span><span>                </span><span style=color:#65737e;># make the lightness periodically show the dark spots
</span><span>                c = </span><span style=color:#d08770;>0.1 </span><span>* </span><span style=color:#bf616a;>cos</span><span>(</span><span style=color:#d08770;>0.2 </span><span>* t) + </span><span style=color:#d08770;>0.2
</span><span>                l = </span><span style=color:#bf616a;>clamp</span><span>(</span><span style=color:#d08770;>0.0</span><span>, </span><span style=color:#d08770;>1.0</span><span>, l - c)
</span><span>
</span><span>                </span><span style=color:#96b5b4;>next</span><span>[x, y] = </span><span style=color:#96b5b4;>round</span><span>((num_colors - </span><span style=color:#d08770;>1</span><span>) * l)
</span><span>
</span><span>        </span><span style=color:#65737e;># swap frame buffers
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = </span><span style=color:#96b5b4;>next
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = curr
</span><span>
</span><span>        curr_group = </span><span style=color:#bf616a;>self</span><span>.curr_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = </span><span style=color:#bf616a;>self</span><span>.next_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = curr_group
</span><span>
</span><span>        </span><span style=color:#65737e;># show new framebuffer
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(</span><span style=color:#bf616a;>self</span><span>.curr_group)
</span><span>
</span><span style=color:#65737e;># ||v||^2
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>norm_sq</span><span>(</span><span style=color:#bf616a;>x</span><span>, </span><span style=color:#bf616a;>y</span><span>, </span><span style=color:#bf616a;>z</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>x*x + y*y + z*z
</span><span>
</span><span style=color:#65737e;># ||v||
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>norm</span><span>(</span><span style=color:#bf616a;>x</span><span>, </span><span style=color:#bf616a;>y</span><span>, </span><span style=color:#bf616a;>z</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#bf616a;>sqrt</span><span>(</span><span style=color:#bf616a;>norm_sq</span><span>(x, y, z))
</span><span>
</span><span style=color:#65737e;># v / ||v||
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>normalize</span><span>(</span><span style=color:#bf616a;>x</span><span>, </span><span style=color:#bf616a;>y</span><span>, </span><span style=color:#bf616a;>z</span><span>):
</span><span>    inv_l = </span><span style=color:#d08770;>1.0 </span><span>/ </span><span style=color:#bf616a;>norm</span><span>(x, y, z)
</span><span>    </span><span style=color:#b48ead;>return </span><span>(inv_l * x, inv_l * y, inv_l * z)
</span><span>
</span><span style=color:#65737e;># a * b
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>dot</span><span>(</span><span style=color:#bf616a;>a_x</span><span>, </span><span style=color:#bf616a;>a_y</span><span>, </span><span style=color:#bf616a;>a_z</span><span>, </span><span style=color:#bf616a;>b_x</span><span>, </span><span style=color:#bf616a;>b_y</span><span>, </span><span style=color:#bf616a;>b_z</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>a_x*b_x + a_y*b_y + a_z*b_z
</span><span>
</span><span style=color:#65737e;># a x b
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>cross</span><span>(</span><span style=color:#bf616a;>bx</span><span>, </span><span style=color:#bf616a;>by</span><span>, </span><span style=color:#bf616a;>bz</span><span>, </span><span style=color:#bf616a;>cx</span><span>, </span><span style=color:#bf616a;>cy</span><span>, </span><span style=color:#bf616a;>cz</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span>(by*cz - bz*cy, bz*cx - bx*cz, bx*cy - by*cx)
</span><span>
</span><span style=color:#65737e;># sphere hit
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>i_sphere</span><span>(</span><span style=color:#bf616a;>ro_x</span><span>, </span><span style=color:#bf616a;>ro_y</span><span>, </span><span style=color:#bf616a;>ro_z</span><span>, </span><span style=color:#bf616a;>rd_x</span><span>, </span><span style=color:#bf616a;>rd_y</span><span>, </span><span style=color:#bf616a;>rd_z</span><span>, </span><span style=color:#bf616a;>sph_x</span><span>, </span><span style=color:#bf616a;>sph_y</span><span>, </span><span style=color:#bf616a;>sph_z</span><span>):
</span><span>    oc_x = ro_x - sph_x
</span><span>    oc_y = ro_y - sph_y
</span><span>    oc_z = ro_z - sph_z
</span><span>
</span><span>    b = </span><span style=color:#bf616a;>dot</span><span>(oc_x, oc_y, oc_z, rd_x, rd_y, rd_z)
</span><span>    c = </span><span style=color:#bf616a;>norm_sq</span><span>(oc_x, oc_y, oc_z) - </span><span style=color:#d08770;>1.0
</span><span>    h = b*b - c
</span><span>
</span><span>    </span><span style=color:#b48ead;>if </span><span>h < </span><span style=color:#d08770;>0.0</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span>-</span><span style=color:#d08770;>1.0
</span><span>    </span><span style=color:#b48ead;>else</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span>-b - </span><span style=color:#bf616a;>sqrt</span><span>(h)
</span><span>
</span><span style=color:#65737e;># sphere soft shadow
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>ss_sphere</span><span>(</span><span style=color:#bf616a;>ro_x</span><span>, </span><span style=color:#bf616a;>ro_y</span><span>, </span><span style=color:#bf616a;>ro_z</span><span>, </span><span style=color:#bf616a;>rd_x</span><span>, </span><span style=color:#bf616a;>rd_y</span><span>, </span><span style=color:#bf616a;>rd_z</span><span>, </span><span style=color:#bf616a;>sph_x</span><span>, </span><span style=color:#bf616a;>sph_y</span><span>, </span><span style=color:#bf616a;>sph_z</span><span>):
</span><span>    oc_x = sph_x - ro_x
</span><span>    oc_y = sph_y - ro_y
</span><span>    oc_z = sph_z - ro_z
</span><span>
</span><span>    b = </span><span style=color:#bf616a;>dot</span><span>(oc_x, oc_y, oc_z, rd_x, rd_y, rd_z)
</span><span>
</span><span>    </span><span style=color:#b48ead;>if </span><span>b > </span><span style=color:#d08770;>0.0</span><span>:
</span><span>        h = </span><span style=color:#bf616a;>norm_sq</span><span>(oc_x, oc_y, oc_z) - b*b - </span><span style=color:#d08770;>1.0
</span><span>        </span><span style=color:#b48ead;>return </span><span style=color:#bf616a;>clamp</span><span>(</span><span style=color:#d08770;>0.0</span><span>, </span><span style=color:#d08770;>1.0</span><span>, </span><span style=color:#d08770;>16.0 </span><span>* h / b)
</span><span>    </span><span style=color:#b48ead;>else</span><span>:
</span><span>        </span><span style=color:#b48ead;>return </span><span style=color:#d08770;>1.0
</span><span>
</span><span style=color:#65737e;># sphere lambert shading
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>lambert</span><span>(</span><span style=color:#bf616a;>lig_x</span><span>, </span><span style=color:#bf616a;>lig_y</span><span>, </span><span style=color:#bf616a;>lig_z</span><span>, </span><span style=color:#bf616a;>nor_x</span><span>, </span><span style=color:#bf616a;>nor_y</span><span>, </span><span style=color:#bf616a;>nor_z</span><span>):
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#96b5b4;>max</span><span>(</span><span style=color:#d08770;>0.0</span><span>, </span><span style=color:#bf616a;>dot</span><span>(lig_x, lig_y, lig_z, nor_x, nor_y, nor_z))
</span><span>
</span><span style=color:#65737e;># sphere occlusion
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>occ_sphere</span><span>(</span><span style=color:#bf616a;>pos_x</span><span>, </span><span style=color:#bf616a;>pos_y</span><span>, </span><span style=color:#bf616a;>pos_z</span><span>, </span><span style=color:#bf616a;>nor_x</span><span>, </span><span style=color:#bf616a;>nor_y</span><span>, </span><span style=color:#bf616a;>nor_z</span><span>, </span><span style=color:#bf616a;>sph_x</span><span>, </span><span style=color:#bf616a;>sph_y</span><span>, </span><span style=color:#bf616a;>sph_z</span><span>):
</span><span>    di_x = sph_x - pos_x
</span><span>    di_y = sph_y - pos_y
</span><span>    di_z = sph_z - pos_z
</span><span>
</span><span>    l_sq = </span><span style=color:#bf616a;>norm_sq</span><span>(di_x, di_y, di_z)
</span><span>    inv_l = </span><span style=color:#d08770;>1.0 </span><span>/ math.</span><span style=color:#bf616a;>sqrt</span><span>(l_sq)
</span><span>    di_x = di_x * inv_l
</span><span>    di_y = di_y * inv_l
</span><span>    di_z = di_z * inv_l
</span><span>
</span><span>    nd = </span><span style=color:#bf616a;>dot</span><span>(nor_x, nor_y, nor_z, di_x, di_y, di_z)
</span><span>
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#d08770;>1.0 </span><span>- (</span><span style=color:#96b5b4;>max</span><span>(</span><span style=color:#d08770;>0.0</span><span>, nd) / l_sq)
</span><span>
</span><span style=color:#65737e;># this screen is a small [raytracer](https://www.wikiwand.com/en/Ray_tracing_(graphics))
</span><span style=color:#65737e;># that renders two spheres with soft shadows and ambient occlusion, while
</span><span style=color:#65737e;># rotating the camera around them.
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>SpheresScreen</span><span style=color:#eff1f5;>(</span><span style=color:#a3be8c;>Screen</span><span style=color:#eff1f5;>):
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>        width = </span><span style=color:#d08770;>64
</span><span>        height = </span><span style=color:#d08770;>32
</span><span>        num_colors = </span><span style=color:#d08770;>64
</span><span>
</span><span>        palette = displayio.</span><span style=color:#bf616a;>Palette</span><span>(num_colors)
</span><span>        </span><span style=color:#b48ead;>for </span><span>idx </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(num_colors):
</span><span>            </span><span style=color:#65737e;>#  palette[idx] = hsl(240, 0.8, 0.25 * (idx / num_colors))
</span><span>            </span><span style=color:#65737e;>#  palette[idx] = hsl(lerp(240, 260, idx / num_colors), 1.0, 1.0 * (idx / num_colors))
</span><span>            palette[idx] = </span><span style=color:#bf616a;>hsl</span><span>(</span><span style=color:#d08770;>220</span><span>, </span><span style=color:#d08770;>0.9</span><span>, </span><span style=color:#d08770;>1.0 </span><span>* (idx / num_colors))
</span><span>
</span><span>        bm1 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>        bm2 = displayio.</span><span style=color:#bf616a;>Bitmap</span><span>(width, height, num_colors)
</span><span>
</span><span>        tg1 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm1, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>        tg2 = displayio.</span><span style=color:#bf616a;>TileGrid</span><span>(bm2, </span><span style=color:#bf616a;>pixel_shader</span><span>=palette)
</span><span>
</span><span>        g1 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g1.</span><span style=color:#bf616a;>append</span><span>(tg1)
</span><span>
</span><span>        g2 = displayio.</span><span style=color:#bf616a;>Group</span><span>()
</span><span>        g2.</span><span style=color:#bf616a;>append</span><span>(tg2)
</span><span>
</span><span>        </span><span style=color:#65737e;>#  display.show(g1)
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.width = width
</span><span>        </span><span style=color:#bf616a;>self</span><span>.height = height
</span><span>        </span><span style=color:#bf616a;>self</span><span>.num_colors = num_colors
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = bm1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = bm2
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = g1
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = g2
</span><span>
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>update</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>display</span><span>):
</span><span>	    width = </span><span style=color:#bf616a;>self</span><span>.width
</span><span>        height = </span><span style=color:#bf616a;>self</span><span>.height
</span><span>        num_colors = </span><span style=color:#bf616a;>self</span><span>.num_colors
</span><span>        curr = </span><span style=color:#bf616a;>self</span><span>.curr
</span><span>        </span><span style=color:#96b5b4;>next </span><span>= </span><span style=color:#bf616a;>self</span><span>.next
</span><span>
</span><span>        </span><span style=color:#65737e;># render to next framebuffer while current one is shown
</span><span>
</span><span>        t = time.</span><span style=color:#bf616a;>monotonic</span><span>()
</span><span>
</span><span>        </span><span style=color:#65737e;># all i want for christmas is numpy...
</span><span>        </span><span style=color:#65737e;># linear algebra heavy stuff is pretty obnoxious in plain python
</span><span>
</span><span>        </span><span style=color:#65737e;># light direction
</span><span>        (lig_x, lig_y, lig_z) = </span><span style=color:#bf616a;>normalize</span><span>(</span><span style=color:#d08770;>0.6</span><span>, </span><span style=color:#d08770;>0.5</span><span>, </span><span style=color:#d08770;>0.4</span><span>)
</span><span>
</span><span>        </span><span style=color:#65737e;># rotate camera around the center over time
</span><span>        angle = -</span><span style=color:#d08770;>0.1</span><span>*t
</span><span>        </span><span style=color:#65737e;>#  angle = -.25*t
</span><span>        ro_x = </span><span style=color:#d08770;>2.5 </span><span>* </span><span style=color:#bf616a;>cos</span><span>(angle)
</span><span>        ro_y = </span><span style=color:#d08770;>1.0
</span><span>        ro_z = </span><span style=color:#d08770;>2.5 </span><span>* </span><span style=color:#bf616a;>sin</span><span>(angle)
</span><span>
</span><span>        </span><span style=color:#65737e;># camera matrix
</span><span>        </span><span style=color:#65737e;>#
</span><span>        </span><span style=color:#65737e;># M = [ [ ww_x, uu_x, vv_x ]
</span><span>        </span><span style=color:#65737e;>#       [ ww_y, uu_y, vv_y ]
</span><span>        </span><span style=color:#65737e;>#       [ ww_z, uu_z, vv_z ] ]
</span><span>        ww_x = </span><span style=color:#d08770;>0.0 </span><span>- ro_x
</span><span>        ww_y = </span><span style=color:#d08770;>1.0 </span><span>- ro_y
</span><span>        ww_z = </span><span style=color:#d08770;>0.0 </span><span>- ro_z
</span><span>        (ww_x, ww_y, ww_z) = </span><span style=color:#bf616a;>normalize</span><span>(ww_x, ww_y, ww_z)
</span><span>
</span><span>        (uu_x, uu_y, uu_z) = </span><span style=color:#bf616a;>cross</span><span>(ww_x, ww_y, ww_z, </span><span style=color:#d08770;>0.0</span><span>, </span><span style=color:#d08770;>1.0</span><span>, </span><span style=color:#d08770;>0.0</span><span>)
</span><span>        (uu_x, uu_y, uu_z) = </span><span style=color:#bf616a;>normalize</span><span>(uu_x, uu_y, uu_z)
</span><span>
</span><span>        (vv_x, vv_y, vv_z) = </span><span style=color:#bf616a;>cross</span><span>(uu_x, uu_y, uu_z, ww_x, ww_y, ww_z)
</span><span>        (vv_x, vv_y, vv_z) = </span><span style=color:#bf616a;>normalize</span><span>(vv_x, vv_y, vv_z)
</span><span>
</span><span>        </span><span style=color:#65737e;># sphere locations
</span><span>        (sph1_x, sph1_y, sph1_z) = (-</span><span style=color:#d08770;>1.2</span><span>, </span><span style=color:#d08770;>1.0</span><span>, </span><span style=color:#d08770;>0.0</span><span>)
</span><span>        (sph2_x, sph2_y, sph2_z) = ( </span><span style=color:#d08770;>1.0</span><span>, </span><span style=color:#d08770;>1.5</span><span>, </span><span style=color:#d08770;>0.0</span><span>)
</span><span>
</span><span>        </span><span style=color:#b48ead;>for </span><span>y </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(height):
</span><span>            </span><span style=color:#b48ead;>for </span><span>x </span><span style=color:#b48ead;>in </span><span style=color:#96b5b4;>range</span><span>(width):
</span><span>                </span><span style=color:#65737e;># normalized screen space
</span><span>                </span><span style=color:#65737e;># p_y in -1 .. 1
</span><span>                </span><span style=color:#65737e;># p_x in -2 .. 2
</span><span>                p_x = (</span><span style=color:#d08770;>2.0 </span><span>* x - width) / height
</span><span>                p_y = -(</span><span style=color:#d08770;>2.0 </span><span>* y - height) / height
</span><span>
</span><span>                </span><span style=color:#65737e;># create view ray
</span><span>                </span><span style=color:#65737e;># rd = normalize(M * [ p_x, p_y, 1.5 ])
</span><span>                </span><span style=color:#65737e;># rd = normalize(p_x*uu + p_y*vv + 1.5*ww)
</span><span>                rd_x = (p_x*uu_x) + (p_y*vv_x) + (</span><span style=color:#d08770;>1.5</span><span>*ww_x)
</span><span>                rd_y = (p_x*uu_y) + (p_y*vv_y) + (</span><span style=color:#d08770;>1.5</span><span>*ww_y)
</span><span>                rd_z = (p_x*uu_z) + (p_y*vv_z) + (</span><span style=color:#d08770;>1.5</span><span>*ww_z)
</span><span>                (rd_x, rd_y, rd_z) = </span><span style=color:#bf616a;>normalize</span><span>(rd_x, rd_y, rd_z)
</span><span>
</span><span>                </span><span style=color:#65737e;>#  l = clamp(0.0, 1.0, rd_z)
</span><span>                </span><span style=color:#65737e;>#  next[x, y] = round((num_colors - 1) * l)
</span><span>                </span><span style=color:#65737e;>#  continue
</span><span>
</span><span>                </span><span style=color:#65737e;># raytrace
</span><span>                tmin = </span><span style=color:#d08770;>4.0
</span><span>
</span><span>                </span><span style=color:#65737e;># rendered lightness. initial value is also bg color (no hit).
</span><span>                l = </span><span style=color:#d08770;>0.0
</span><span>
</span><span>                </span><span style=color:#65737e;># ray position
</span><span>                pos_x = </span><span style=color:#d08770;>0.0
</span><span>                pos_y = </span><span style=color:#d08770;>0.0
</span><span>                pos_z = </span><span style=color:#d08770;>0.0
</span><span>
</span><span>                </span><span style=color:#65737e;># normal vector
</span><span>                nor_x = </span><span style=color:#d08770;>0.0
</span><span>                nor_y = </span><span style=color:#d08770;>0.0
</span><span>                nor_z = </span><span style=color:#d08770;>0.0
</span><span>
</span><span>                occ = </span><span style=color:#d08770;>1.0
</span><span>
</span><span>                </span><span style=color:#65737e;># raytrace sphere 1
</span><span>                h = </span><span style=color:#bf616a;>i_sphere</span><span>(ro_x, ro_y, ro_z, rd_x, rd_y, rd_z, sph1_x, sph1_y, sph1_z)
</span><span>                </span><span style=color:#b48ead;>if </span><span>h > </span><span style=color:#d08770;>0.0 </span><span>and h < tmin:
</span><span>                    tmin = h
</span><span>
</span><span>                    </span><span style=color:#65737e;># pos = ro + h*rd
</span><span>                    pos_x = ro_x + h * rd_x
</span><span>                    pos_y = ro_y + h * rd_y
</span><span>                    pos_z = ro_z + h * rd_z
</span><span>
</span><span>                    </span><span style=color:#65737e;># nor = normalize(pos - sph1)
</span><span>                    nor_x = pos_x - sph1_x
</span><span>                    nor_y = pos_y - sph1_y
</span><span>                    nor_z = pos_z - sph1_z
</span><span>
</span><span>                    (nor_x, nor_y, nor_z) = </span><span style=color:#bf616a;>normalize</span><span>(nor_x, nor_y, nor_z)
</span><span>
</span><span>                    occ = </span><span style=color:#d08770;>0.5 </span><span>+ </span><span style=color:#d08770;>0.5</span><span>*nor_y
</span><span>                    occ *= </span><span style=color:#bf616a;>occ_sphere</span><span>(pos_x, pos_y, pos_z, nor_x, nor_y, nor_z, sph1_x, sph1_y, sph1_z)
</span><span>
</span><span>                </span><span style=color:#65737e;># raytrace sphere 2
</span><span>                h = </span><span style=color:#bf616a;>i_sphere</span><span>(ro_x, ro_y, ro_z, rd_x, rd_y, rd_z, sph2_x, sph2_y, sph2_z)
</span><span>                </span><span style=color:#b48ead;>if </span><span>h > </span><span style=color:#d08770;>0.0 </span><span>and h < tmin:
</span><span>                    tmin = h
</span><span>
</span><span>                    </span><span style=color:#65737e;># pos = ro + h*rd
</span><span>                    pos_x = ro_x + h * rd_x
</span><span>                    pos_y = ro_y + h * rd_y
</span><span>                    pos_z = ro_z + h * rd_z
</span><span>
</span><span>                    </span><span style=color:#65737e;># nor = normalize(pos - sph2)
</span><span>                    nor_x = pos_x - sph2_x
</span><span>                    nor_y = pos_y - sph2_y
</span><span>                    nor_z = pos_z - sph2_z
</span><span>                    (nor_x, nor_y, nor_z) = </span><span style=color:#bf616a;>normalize</span><span>(nor_x, nor_y, nor_z)
</span><span>
</span><span>                    occ = </span><span style=color:#d08770;>0.5 </span><span>+ </span><span style=color:#d08770;>0.5</span><span>*nor_y
</span><span>                    occ *= </span><span style=color:#bf616a;>occ_sphere</span><span>(pos_x, pos_y, pos_z, nor_x, nor_y, nor_z, sph2_x, sph2_y, sph2_z)
</span><span>
</span><span>                </span><span style=color:#65737e;># shading + lighting
</span><span>                </span><span style=color:#b48ead;>if </span><span>tmin < </span><span style=color:#d08770;>4.0</span><span>:
</span><span>                    </span><span style=color:#65737e;># pos = ro + tmin*rd
</span><span>                    pos_x = ro_x + tmin * rd_x
</span><span>                    pos_y = ro_y + tmin * rd_y
</span><span>                    pos_z = ro_z + tmin * rd_z
</span><span>
</span><span>                    </span><span style=color:#65737e;># shadows
</span><span>                    sha = </span><span style=color:#d08770;>1.0
</span><span>                    </span><span style=color:#65737e;># # skip first sphere since its shadow doesn't hit anything
</span><span>                    </span><span style=color:#65737e;># sha *= ss_sphere(pos_x, pos_y, pos_z, lig_x, lig_y, lig_z, sph1_x, sph1_y, sph1_z)
</span><span>                    sha *= </span><span style=color:#bf616a;>ss_sphere</span><span>(pos_x, pos_y, pos_z, lig_x, lig_y, lig_z, sph2_x, sph2_y, sph2_z)
</span><span>
</span><span>                    l = </span><span style=color:#d08770;>0.0
</span><span>
</span><span>                    </span><span style=color:#65737e;># ambient occlusion
</span><span>                    l += </span><span style=color:#d08770;>0.5 </span><span>* occ
</span><span>
</span><span>                    </span><span style=color:#65737e;># lambert shading
</span><span>                    l += </span><span style=color:#d08770;>5.0 </span><span>* </span><span style=color:#bf616a;>lambert</span><span>(lig_x, lig_y, lig_z, nor_x, nor_y, nor_z) * sha
</span><span>
</span><span>                    l *= </span><span style=color:#d08770;>0.22
</span><span>
</span><span>                </span><span style=color:#65737e;># gamma adjustment
</span><span>                l = </span><span style=color:#bf616a;>clamp</span><span>(</span><span style=color:#d08770;>0.0</span><span>, </span><span style=color:#d08770;>1.0</span><span>, math.</span><span style=color:#bf616a;>pow</span><span>(l, </span><span style=color:#d08770;>0.85</span><span>))
</span><span>                </span><span style=color:#96b5b4;>next</span><span>[x, y] = </span><span style=color:#96b5b4;>round</span><span>((num_colors - </span><span style=color:#d08770;>1</span><span>) * l)
</span><span>
</span><span>        </span><span style=color:#65737e;># swap frame buffers
</span><span>
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr = </span><span style=color:#96b5b4;>next
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next = curr
</span><span>
</span><span>        curr_group = </span><span style=color:#bf616a;>self</span><span>.curr_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.curr_group = </span><span style=color:#bf616a;>self</span><span>.next_group
</span><span>        </span><span style=color:#bf616a;>self</span><span>.next_group = curr_group
</span><span>
</span><span>        </span><span style=color:#65737e;># show new framebuffer
</span><span>
</span><span>        display.</span><span style=color:#bf616a;>show</span><span>(</span><span style=color:#bf616a;>self</span><span>.curr_group)
</span><span>
</span><span>
</span><span style=color:#b48ead;>class </span><span style=color:#ebcb8b;>Button</span><span style=color:#eff1f5;>:
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#96b5b4;>__init__</span><span>(</span><span style=color:#bf616a;>self</span><span>, </span><span style=color:#bf616a;>button_pin</span><span>):
</span><span>        </span><span style=color:#bf616a;>self</span><span>.press_counter = countio.</span><span style=color:#bf616a;>Counter</span><span>(
</span><span>            </span><span style=color:#bf616a;>pin</span><span>=button_pin,
</span><span>            </span><span style=color:#bf616a;>edge</span><span>=countio.Edge.</span><span style=color:#bf616a;>RISE</span><span>,
</span><span>            </span><span style=color:#bf616a;>pull</span><span>=digitalio.Pull.</span><span style=color:#bf616a;>UP</span><span>,
</span><span>        )
</span><span>        </span><span style=color:#bf616a;>self</span><span>.prev_total = </span><span style=color:#d08770;>0
</span><span>
</span><span>    </span><span style=color:#65737e;># Returns the number of button presses since we last checked
</span><span>    </span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>new_presses</span><span>(</span><span style=color:#bf616a;>self</span><span>):
</span><span>        new_total = </span><span style=color:#bf616a;>self</span><span>.press_counter.count
</span><span>        new_presses = new_total - </span><span style=color:#bf616a;>self</span><span>.prev_total
</span><span>        </span><span style=color:#bf616a;>self</span><span>.prev_total = new_total
</span><span>        </span><span style=color:#b48ead;>return </span><span>new_presses
</span><span>
</span><span style=color:#b48ead;>def </span><span style=color:#8fa1b3;>main</span><span>():
</span><span>    display = </span><span style=color:#bf616a;>make_display</span><span>()
</span><span>
</span><span>    screens = [
</span><span>        StartScreen,
</span><span>        CircleScreen,
</span><span>        WarpScreen,
</span><span>        Warp2Screen,
</span><span>        SpheresScreen,
</span><span>        GameOfLifeScreen,
</span><span>        </span><span style=color:#65737e;>#  ColorTestScreen,
</span><span>    ]
</span><span>    prev_screen_idx = -</span><span style=color:#d08770;>1
</span><span>    screen_idx = </span><span style=color:#d08770;>0
</span><span>
</span><span>    up_button = </span><span style=color:#bf616a;>Button</span><span>(board.</span><span style=color:#bf616a;>BUTTON_UP</span><span>)
</span><span>    </span><span style=color:#65737e;># down_button = Button(board.BUTTON_DOWN)
</span><span>
</span><span>    </span><span style=color:#b48ead;>while </span><span style=color:#d08770;>True</span><span>:
</span><span>        up_button_presses = up_button.</span><span style=color:#bf616a;>new_presses</span><span>()
</span><span>        </span><span style=color:#b48ead;>if </span><span>up_button_presses > </span><span style=color:#d08770;>0</span><span>:
</span><span>            screen_idx = (screen_idx + </span><span style=color:#d08770;>1</span><span>) % </span><span style=color:#96b5b4;>len</span><span>(screens)
</span><span>
</span><span>        </span><span style=color:#b48ead;>if </span><span>screen_idx != prev_screen_idx:
</span><span>            prev_screen_idx = screen_idx
</span><span>            screen = screens[screen_idx](display)
</span><span>
</span><span>        screen.</span><span style=color:#bf616a;>update</span><span>(display)
</span><span>
</span><span style=color:#b48ead;>try</span><span>:
</span><span>    </span><span style=color:#bf616a;>main</span><span>()
</span><span style=color:#b48ead;>except </span><span>Exception </span><span style=color:#b48ead;>as </span><span>err:
</span><span>    </span><span style=color:#96b5b4;>print</span><span>(</span><span style=color:#b48ead;>f</span><span>"</span><span style=color:#a3be8c;>Error: </span><span>{err}")
</span></code></pre><h2 id=for-reference-one-time-setup-process>(for reference) one-time setup process <a aria-label="anchor link" class=anchor-link href=#for-reference-one-time-setup-process> # </a></h2><p>Board product page: <a href=https://www.adafruit.com/product/4745>https://www.adafruit.com/product/4745</a><p>Board info:<pre style=background-color:#2b303b;color:#c0c5ce;><code><span>UF2 Bootloader v1.23.1-adafruit.1-328-gf06693a SFHWRO
</span><span>Model: Matrix Portal M4
</span><span>Board-ID: SAMD51J19A-MatrixPortal-v0
</span></code></pre><p>When first connected to power, we see the cool little falling sand demo that comes pre-installed.<p>After connecting it to a machine through the USB-C port, double-press the RST button on the board; the debug light flashes and a USB-drive called <code>MATRIXBOOT</code> mounts on the connected machine.<p>If nothing happens, <em>make sure the USB-C cable you're using supports data transfer and not just power.</em><p>The pre-installed contents of the drive:<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> ls /media/phlip9/MATRIXBOOT
</span><span style=color:#bf616a;>CURRENT.UF2
</span><span style=color:#bf616a;>INDEX.HTM
</span><span style=color:#bf616a;>INFO_UF2.TXT
</span></code></pre><p>We then install the CircuitPython "OS" onto the board:<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> cd /tmp
</span><span style=color:#bf616a;>$</span><span> wget https://downloads.circuitpython.org/bin/matrixportal_m4/en_US/adafruit-circuitpython-matrixportal_m4-en_US-7.3.3.uf2
</span><span style=color:#bf616a;>$</span><span> cp adafruit-circuitpython-matrixportal_m4-en_US-7.3.3.uf2 /media/phlip9/MATRIXBOOT
</span></code></pre><p>The lights should flash a bit and the disk will unmount from your machine. A second later another USB disk mounts called <code>CIRCUITPY</code>.<p><a href=https://codewith.mu/en/download>Download and install the Mu editor</a>.<p>On linux I had to add my user, <code>phlip9</code>, to the <code>dialout</code> group and then restart for Mu+CircuitPython to work. macOS and Windows users can skip this step.<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#bf616a;>$</span><span> sudo adduser phlip9 dialout
</span></code></pre><p>Open the Mu editor and select "Mode", then choose "CircuitPython". If everything was setup properly, it should auto-detect the board.<p>Close any random "untitled" file it tries to create. Next hit the "Load" icon and navigate to the <code>CIRCUITPY</code> drive. Choose the <code>code.py</code> file. You should see something like:<pre class=language-python data-lang=python style=background-color:#2b303b;color:#c0c5ce;><code class=language-python data-lang=python><span style=color:#96b5b4;>print</span><span>("</span><span style=color:#a3be8c;>Hello, World!</span><span>")
</span></code></pre><p>Click the "Serial" button to show the device <code>print</code> output. Save the currently open <code>code.py</code> file and the board will automatically restart and run the file!</main></div></div></div><form class=d-none id=search-bar><div class=container><div class="row justify-content-center"><div class="col col-lg-11 col-xl-9" id=search-container><input aria-label="Search notes..." class="form-control is-search" placeholder="Search notes..." autocomplete=off id=userinput type=search><div class="shadow rounded" id=suggestions></div></div></div></div></form><script defer src=https://phlip9.com/notes/js/elasticlunr.min.js></script><script defer src=https://phlip9.com/notes/search_index.en.js></script><script defer src=https://phlip9.com/notes/js/search.js></script>