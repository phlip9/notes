<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link href=https://phlip9.com/notes/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>SGX lingo | philip's notes</title><meta content="a collection of my notes" name=description><link href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/" rel=canonical><meta content=summary name=twitter:card><meta content="SGX lingo" name=twitter:title><meta content=@phlip9 name=twitter:site><meta content=@phlip9 name=twitter:creator><meta content="SGX lingo" property=og:title><meta content="a collection of my notes" property=og:description><meta content=article property=og:type><meta content="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/" property=og:url><meta content=2024-10-21T04:08:44.982615 property=og:updated_time><meta content="philip's notes" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "/confidential computing/intel SGX/SGX lingo/"
    },
    "headline": "SGX lingo",
    "image": ,
    "datePublished": "2022-04-12",
    "dateModified": "2024-10-21",
    "author": {
      "@type": "Person",
      "name": "Philip Hayes"
    },
    "publisher": {
      "@type": "Person",
      "name": "Philip Hayes",
      
    },
    "description": "a collection of my notes"
  }
  </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://phlip9.com/notes/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Confidential Computing",
            "item": "https://phlip9.com/notes/confidential computing/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Intel Sgx",
            "item": "https://phlip9.com/notes/confidential computing/intel SGX/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Sgx Lingo",
            "item": "https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/"
          },
        
      
    
  }
</script><meta content=#383866 name=theme-color><link href=https://phlip9.com/notes/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://phlip9.com/notes/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://phlip9.com/notes/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://phlip9.com/notes/site.webmanifest rel=manifest><script>// https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html
        window.MathJax = {
          tex: {
            inlineMath: [
              ['$', '$']
            ],
            displayMath: [
              ['$$', '$$'],
              ['\\[', '\\]']
            ],
            processEscapes: true,
            processEnvironments: true,
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          }
        };</script><script integrity="sha256-z47L98YXVhVIaY0uyDzt675P5Ea+w3RsPh9VD5NuoTY=" async crossorigin=anonymous defer id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js></script><body class="notes single dark"><div class=container role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 notes-sidebar"><nav aria-label="Main navigation" class=notes-links><a class="navbar-brand link-internal" href=https://phlip9.com/notes/> philip's notes </a><a class="notes-link sidebar-social" href=https://twitter.com/phlip9> <svg class="feather feather-twitter" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg> <span class=visually-hidden>Twitter</span> </a><a class="notes-link sidebar-social" href=https://github.com/phlip9> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> <span class=visually-hidden>GitHub</span> </a><a class="notes-link sidebar-social" href=# id=sidebar-open-search> <svg aria-labelledby="title desc" viewbox="0 0 19.9 19.7" fill=none height=20 id=search-icon role=img stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 tabindex=0 width=20 xmlns=http://www.w3.org/2000/svg> <g class=search-path><path d="M18.5 18.3l-5.4-5.4"></path><circle cx=8 cy=8 r=7></circle> </g> </svg> </a><hr><ol id=sidebar-tree-root><li><input id=sidebar-input-ai-ml type=checkbox> <label class=h3 for=sidebar-input-ai-ml>AI ML</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Expectimax Search/"> Expectimax Search </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Markov Decision Process (MDP)/"> Markov Decision Process (MDP) </a></ol><li><input id=sidebar-input-wsl type=checkbox> <label class=h3 for=sidebar-input-wsl>WSL</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/WSL/WSL2 custom kernel/"> WSL2 custom kernel </a></ol><li><li><input id=sidebar-input-android type=checkbox> <label class=h3 for=sidebar-input-android>android</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/ADB over TCP inside WSL2/"> ADB over TCP inside WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/OTA updates for rooted android phone/"> OTA updates for rooted android phone </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/android cli setup/"> android cli setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/building signal-android in WSL2/"> building signal-android in WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/linux ADB udev setup/"> linux ADB udev setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/root phone with magisk/"> root phone with magisk </a></ol><li><input id=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n type=checkbox> <label class=h3 for=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n>b i g m o n e y l a w r e g u l a t i o n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/financial instituion/"> financial instituion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/foreign bank account report (FBAR)/"> foreign bank account report (FBAR) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/monetary instruments/"> monetary instruments </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/money services business (MSB)/"> money services business (MSB) </a></ol><li><input id=sidebar-input-b-l-o-c-k-c-h-a-i-n type=checkbox> <label class=h3 for=sidebar-input-b-l-o-c-k-c-h-a-i-n>b l o c k c h a i n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/aptos/"> aptos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/bip158 - compact block filters/"> bip158 - compact block filters </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/btc utreexo - utxo accumulator/"> btc utreexo - utxo accumulator </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/fastpay/"> fastpay </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/oasis/"> oasis </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/sui/"> sui </a></ol><li><input id=sidebar-input-btc-ln type=checkbox> <label class=h3 for=sidebar-input-btc-ln>btc-ln</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 11 - invoices/"> BOLT 11 - invoices </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 2 - channel management protocol/"> BOLT 2 - channel management protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 4 - onion routing protocol/"> BOLT 4 - onion routing protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 7 - p2p node and channel discovery/"> BOLT 7 - p2p node and channel discovery </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 8 - secure noise transport/"> BOLT 8 - secure noise transport </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/atomic multipath payments (AMP)/"> atomic multipath payments (AMP) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/breez lightning service providers/"> breez lightning service providers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/hosted channels/"> hosted channels </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning libs/"> lightning libs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning network notes/"> lightning network notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning rod/"> lightning rod </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightningdevkit - rust-lightning/"> lightningdevkit - rust-lightning </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/submarine swaps/"> submarine swaps </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/zero-conf channels/"> zero-conf channels </a></ol><li><input id=sidebar-input-combinatorics type=checkbox> <label class=h3 for=sidebar-input-combinatorics>combinatorics</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/combinatorics/k-combinations of a multiset/"> k-combinations of a multiset </a></ol><li><input checked id=sidebar-input-confidential-computing type=checkbox> <label class=h3 for=sidebar-input-confidential-computing>confidential computing</label> <ol><li><input checked id=sidebar-input-confidential-computing-intel-sgx type=checkbox> <label class=h3 for=sidebar-input-confidential-computing-intel-sgx>intel SGX</label> <ol><li class=sidebar-note><a class="notes-link link-internal active" href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/"> SGX lingo </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/overview/"> overview </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/remote attestation/"> remote attestation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/sealing/"> sealing </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/secure time/"> secure time </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/"> enarx (WASM TEE) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/fortanix rust tutorial/"> fortanix rust tutorial </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/gramine/"> gramine </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel TDX/"> intel TDX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/marblerun/"> marblerun </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/mystikos/"> mystikos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/remote attestation protocols/"> remote attestation protocols </a></ol><li><input id=sidebar-input-crypto type=checkbox> <label class=h3 for=sidebar-input-crypto>crypto</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/(talk) authenticated data structures for stateless validation/"> (talk) authenticated data structures for stateless validation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/TLS self-signed pubkey-only certs/"> TLS self-signed pubkey-only certs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/acme protocol/"> acme protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/biscuit authz/"> biscuit authz </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/dex - open-source OIDC & OAuth 2.0 provider/"> dex - open-source OIDC & OAuth 2.0 provider </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/hkdf-sha256/> hkdf-sha256 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/smallstep - private online CA & ACME server/"> smallstep - private online CA & ACME server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/tls exported keying material/"> tls exported keying material </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/zkdocs/> zkdocs </a></ol><li><input id=sidebar-input-design type=checkbox> <label class=h3 for=sidebar-input-design>design</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/design/form design/"> form design </a></ol><li><input id=sidebar-input-devops type=checkbox> <label class=h3 for=sidebar-input-devops>devops</label> <ol><li><input id=sidebar-input-devops-o11y type=checkbox> <label class=h3 for=sidebar-input-devops-o11y>o11y</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/o11y/jaeger oss e2e tracing/"> jaeger oss e2e tracing </a></ol><li><input id=sidebar-input-devops-secrets type=checkbox> <label class=h3 for=sidebar-input-devops-secrets>secrets</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/1password - secrets automation/"> 1password - secrets automation </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/doppler/> doppler </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson (Shopify)/"> ejson (Shopify) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson-kms (AWS)/"> ejson-kms (AWS) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/envkey/> envkey </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/fortanix DSM/"> fortanix DSM </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/mozilla SOPS/"> mozilla SOPS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/sops-nix/> sops-nix </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/sy - share secrets safely/"> sy - share secrets safely </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/AKS - azure kubernetes service/"> AKS - azure kubernetes service </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/algo wireguard VPN server/"> algo wireguard VPN server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/azure CLI/"> azure CLI </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/consul/> consul </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/deployment strategies/"> deployment strategies </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/docker compose/"> docker compose </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/k3s/> k3s </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/kind (kubernetes in docker)/"> kind (kubernetes in docker) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/kubernetes/> kubernetes </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/linkerd/> linkerd </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/minikube/> minikube </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/nomad/> nomad </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/service mesh/"> service mesh </a></ol><li><input id=sidebar-input-distributed-systems type=checkbox> <label class=h3 for=sidebar-input-distributed-systems>distributed systems</label> <ol><li><input id=sidebar-input-distributed-systems-papers type=checkbox> <label class=h3 for=sidebar-input-distributed-systems-papers>papers</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast/"> (2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2021) Leaderless Consensus/"> (2021) Leaderless Consensus </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/the siren song of backpressure/"> the siren song of backpressure </a></ol><li><input id=sidebar-input-fuzzing type=checkbox> <label class=h3 for=sidebar-input-fuzzing>fuzzing</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/fuzzing/bolero - fuzzing + property testing/"> bolero - fuzzing + property testing </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzcheck-rs/> fuzzcheck-rs </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzing/> fuzzing </a></ol><li><input id=sidebar-input-ios type=checkbox> <label class=h3 for=sidebar-input-ios>ios</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/ios/ios setup/"> ios setup </a></ol><li><input id=sidebar-input-keyboards type=checkbox> <label class=h3 for=sidebar-input-keyboards>keyboards</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/keyboards/moergo glove80/"> moergo glove80 </a></ol><li><input id=sidebar-input-lang type=checkbox> <label class=h3 for=sidebar-input-lang>lang</label> <ol><li><input id=sidebar-input-lang-ats type=checkbox> <label class=h3 for=sidebar-input-lang-ats>ATS</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/"> ATS2 Notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/Install ATS2/"> Install ATS2 </a></ol><li><input id=sidebar-input-lang-flutter type=checkbox> <label class=h3 for=sidebar-input-lang-flutter>flutter</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/dart lang/"> dart lang </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/flutter setup/"> flutter setup </a></ol><li><input id=sidebar-input-lang-rust type=checkbox> <label class=h3 for=sidebar-input-lang-rust>rust</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/optimizing binary size/"> optimizing binary size </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rr with rust/"> rr with rust </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust verification tools/"> rust verification tools </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust x SGX/"> rust x SGX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/self-referencing structs/"> self-referencing structs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/sycamore x futures/"> sycamore x futures </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/understanding sycamore reactivity/"> understanding sycamore reactivity </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/gdb ref/"> gdb ref </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/koka-lang/> koka-lang </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/lua/> lua </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/operator fixity and precedence/"> operator fixity and precedence </a></ol><li><input id=sidebar-input-management type=checkbox> <label class=h3 for=sidebar-input-management>management</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/management/relieve often - why generals were more successful in WWII/"> relieve often - why generals were more successful in WWII </a></ol><li><input id=sidebar-input-misc type=checkbox> <label class=h3 for=sidebar-input-misc>misc</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/arm target triples/"> arm target triples </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/envsubst/> envsubst </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/git multirepo to monorepo/"> git multirepo to monorepo </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/kintsugi/> kintsugi </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/optimization solvers/"> optimization solvers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/pop_OS! tweaks/"> pop_OS! tweaks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/prepping RPI for embedded dev/"> prepping RPI for embedded dev </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/rgbxmas/> rgbxmas </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/scanning QR codes on desktop/"> scanning QR codes on desktop </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/setting up a headless raspbian boot image/"> setting up a headless raspbian boot image </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/uptime to downtime conversion/"> uptime to downtime conversion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/water distillation setup/"> water distillation setup </a></ol><li><input id=sidebar-input-networking type=checkbox> <label class=h3 for=sidebar-input-networking>networking</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/networking/CIDR/> CIDR </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/ipv6 address space/"> ipv6 address space </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interface card (NIC)/"> network interface card (NIC) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interfaces/"> network interfaces </a></ol><li><input id=sidebar-input-nvim type=checkbox> <label class=h3 for=sidebar-input-nvim>nvim</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/nvim/universal-ctags Notes/"> universal-ctags Notes </a></ol><li><input id=sidebar-input-performance type=checkbox> <label class=h3 for=sidebar-input-performance>performance</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/bit hacks/"> bit hacks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/dtrace on macOS/"> dtrace on macOS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/performance/profiling/> profiling </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/simdjson talk/"> simdjson talk </a></ol><li><input id=sidebar-input-postgres type=checkbox> <label class=h3 for=sidebar-input-postgres>postgres</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/postgres performance tuning/"> postgres performance tuning </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/postgres/snippets/> snippets </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/types of scans/"> types of scans </a></ol><li><input id=sidebar-input-reproducible-builds type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds>reproducible builds</label> <ol><li><input id=sidebar-input-reproducible-builds-nix type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds-nix>nix</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/links/"> links </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix auto-allocate-uids -> nixbld users/"> nix auto-allocate-uids -> nixbld users </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug broken package build/"> nix debug broken package build </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug spurrious rebuilds/"> nix debug spurrious rebuilds </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/earthly/"> earthly </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/rebuilderd/"> rebuilderd </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/reproducible-builds.org/"> reproducible-builds.org </a></ol><li><input id=sidebar-input-router type=checkbox> <label class=h3 for=sidebar-input-router>router</label> <ol><li><input id=sidebar-input-router-lightning-router type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router>lightning router</label> <ol><li><input id=sidebar-input-router-lightning-router-captive-portal type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router-captive-portal>captive portal</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/RFC 6585 (Additional HTTP Status Codes)/"> RFC 6585 (Additional HTTP Status Codes) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/arubanetworks captive portal/"> arubanetworks captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal/"> captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal (wikipedia)/"> captive portal (wikipedia) </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/lightning router overview/"> lightning router overview </a></ol></ol><li><input id=sidebar-input-statistics-probability type=checkbox> <label class=h3 for=sidebar-input-statistics-probability>statistics probability</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/CDF confidence bands - DKW inequality/"> CDF confidence bands - DKW inequality </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/G-test - multinomial goodness-of-fit/"> G-test - multinomial goodness-of-fit </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/MAD - median absolute deviation/"> MAD - median absolute deviation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/cheat sheet/"> cheat sheet </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/herbie - float error fixer/"> herbie - float error fixer </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/kelly criterion + ELO/"> kelly criterion + ELO </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/multinomial distribution/"> multinomial distribution </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/p-value/"> p-value </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/standard error/"> standard error </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/testing whether a coin is fair/"> testing whether a coin is fair </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/winsorize/"> winsorize </a></ol></ol></nav></div><nav aria-label="Secondary navigation" class="notes-toc d-none d-xl-block col-xl-4"><div class=page-links><h3 class=text-muted>on this page</h3><nav id=table-of-contents><ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#sgx-lingo" class=link-internal>SGX lingo</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#quote" class=link-internal>Quote</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#report-ereport" class=link-internal>Report (EREPORT)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#attestation-key-ak" class=link-internal>Attestation Key (AK)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#architectural-enclaves" class=link-internal>Architectural Enclaves</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#launch-enclave-le" class=link-internal>Launch Enclave (LE)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#quoting-enclave-qe" class=link-internal>Quoting Enclave (QE)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#provisioning-certification-enclave-pce" class=link-internal>Provisioning Certification Enclave (PCE)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#provisioning-enclave-pe-or-pve" class=link-internal>Provisioning Enclave (PE or PvE)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#platform-services-enclave-pse" class=link-internal>Platform Services Enclave (PSE)</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#trusted-time-service" class=link-internal>Trusted Time Service</a></ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#tdx-quoting-enclave-tdqe" class=link-internal>TDX Quoting Enclave (TDQE)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#architectural-enclave-service-manager-aesm" class=link-internal>Architectural Enclave Service Manager (AESM)</a></ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#provisioning-certification-key-pck" class=link-internal>Provisioning Certification Key (PCK)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#pck-cert" class=link-internal>PCK Cert</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#platform-provisioning-id-ppid" class=link-internal>Platform Provisioning ID (PPID)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#security-version-number-svn" class=link-internal>Security Version Number (SVN)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#platform-security-version-number-psvn-cpusvn" class=link-internal>Platform Security Version Number (PSVN, CPUSVN)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#independent-software-vendor-isv" class=link-internal>Independent Software Vendor (ISV)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#intel-attestation-services-ias" class=link-internal>Intel Attestation Services (IAS)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#service-provider-id-spid" class=link-internal>Service Provider ID (SPID)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-page-cache-epc" class=link-internal>Enclave Page Cache (EPC)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#provisioning-tcb" class=link-internal>Provisioning TCB</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#pce-id" class=link-internal>PCE-ID</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#data-center-attestation-primitives-dcap" class=link-internal>Data Center Attestation Primitives (DCAP)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#launch-token" class=link-internal>Launch Token</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#flexible-launch-control-flc" class=link-internal>Flexible Launch Control (FLC)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-load-policy" class=link-internal>Enclave Load Policy</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#owner-epoch" class=link-internal>Owner Epoch</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#quoting-enclave-id-qe-id" class=link-internal>Quoting Enclave ID (QE-ID)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#quoting-enclave-quoteinfo" class=link-internal>Quoting Enclave QuoteInfo</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#targetinfo" class=link-internal>TargetInfo</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-measurement-mrenclave" class=link-internal>Enclave Measurement (MRENCLAVE)</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#why-do-we-need-to-verify-the-software-inside-the-enclave" class=link-internal>Why do we need to verify the software inside the enclave?</a></ul><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#fortanix-sgx-stream-format-sgxs" class=link-internal>Fortanix SGX Stream format (SGXS)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#signer-measurement-mrsigner" class=link-internal>Signer Measurement (MRSIGNER)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-signature-struct-sigstruct" class=link-internal>Enclave Signature Struct (SIGSTRUCT)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-info" class=link-internal>Enclave Info</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#report-targetinfo-targetinfo" class=link-internal>Report TargetInfo (TARGETINFO)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-init-token-einittoken" class=link-internal>Enclave Init Token (EINITTOKEN)</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-attributes" class=link-internal>Enclave Attributes</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#enclave-miscselect" class=link-internal>Enclave Miscselect</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#keyrequest" class=link-internal>KEYREQUEST</a><li><a href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/#key-sharing-and-separation-kss" class=link-internal>Key sharing and separation (KSS)</a></ul></ul></nav></div></nav><main class="notes-content tags-content col-lg-11 col-xl-8"><h1 id=sgx-lingo>SGX lingo</h1><p class=text-muted>2022-04-12 Â· 21 min read<ul class=tags><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/confidential-computing/>#confidential-computing</a><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/sgx/>#sgx</a></ul><ul><li>Understanding Intel SGX is challenging due to the sheer number of new concepts and names that you need to internalize. In my experience, it's a bit like wading through "acronym soup", desperately searching for familiar ground to find your footing before you can truly begin learning.<li>To make this process easier for newcomers, I've written an extended glossary of SGX terminology, with extensive links and explanations.<li>Most of the code links and samples are written in Rust.<li>The entries are not listed in any particular order.</ul><h2 id=quote>Quote <a aria-label="anchor link" class=anchor-link href=#quote> # </a></h2><p>A datastructure provided as proof to an external party that an application enclave is running on genuine Intel hardware <em>at a given TCB version</em>.<p>An application's identity <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#report-ereport>Report</a>, signed by an <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#attestation-key-ak>Attestation Key (AK)</a> (usually the one provisioned in the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>Quoting Enclave (QE)</a>).<h2 id=report-ereport>Report (EREPORT) <a aria-label="anchor link" class=anchor-link href=#report-ereport> # </a></h2><p>A hardware report generated by an enclave containing (1) the enclave's identity, (2) <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-measurement-mrenclave>measurement</a> info, and (3) a small amount of application data (64-bytes), called the <code>ReportData</code>.<p><strong>Reports are efficiently verifiable inside other enclaves on the same machine.</strong> When generated via the <code>EREPORT</code> instruction, the <code>Report</code> struct will contain a MAC created from a special <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/sealing/#deriving-some-key-material>Seal Key</a> used for tagging reports. This allows us to cheaply verify reports without an expensive signature verification, since other enclaves can just rederive the report key and check the MAC tag, which is fast.<p>Otherwise for <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/remote%20attestation/>remote attestation</a>:<h2 id=attestation-key-ak>Attestation Key (AK) <a aria-label="anchor link" class=anchor-link href=#attestation-key-ak> # </a></h2><p>The key used by the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE</a> to sign application enclave <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#report-ereport>REPORTs</a>, producing <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quote>Quotes</a>.<p>This Quote certifies that an application enclave is running on genuine Intel SGX HW <em>at a given TCB version</em>.<p>The AK is created and owned by the owner of the remote attestation infrastructure (e.g., Azure or Intel) but is also certified by the Intel SGX rooted key (this key is rooted to the platform HW fuses), which proves the enclave is valid.<h2 id=architectural-enclaves>Architectural Enclaves <a aria-label="anchor link" class=anchor-link href=#architectural-enclaves> # </a></h2><p>Intel provides several Intel-signed enclaves necessary for running user application enclaves, verifying launch policies, producing remote attestation <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quote>Quotes</a>, and more.<p>A non-exhaustive list of Architectural Enclaves:<ol><li><a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-enclave-le>Launch Enclave (LE)</a><li><a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>Quoting Enclave (QE)</a><li><a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>Provisioning Certification Enclave (PCE)</a><li><a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-enclave-pe-or-pve>Provisioning Enclave (PE)</a><li><a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#platform-services-enclave-pse>Platform Services Enclave (PSE)</a></ol><p>To see the complete list of <em>signed</em> enclaves:<pre class=language-bash data-lang=bash style=background-color:#2b303b;color:#c0c5ce;><code class=language-bash data-lang=bash><span style=color:#65737e;># Valid for Intel SGX v2.21 and Intel DCAP v1.18
</span><span>
</span><span style=color:#bf616a;>$</span><span> cd $(</span><span style=color:#bf616a;>mktemp -d</span><span>)
</span><span style=color:#bf616a;>$</span><span> curl https://download.01.org/intel-sgx/sgx-linux/2.21/prebuilt_ae_2.21.tar.gz | </span><span style=color:#bf616a;>tar -xzv
</span><span style=color:#bf616a;>$</span><span> curl https://download.01.org/intel-sgx/sgx-dcap/1.18/linux/prebuilt_dcap_1.18.tar.gz | </span><span style=color:#bf616a;>tar -xzv
</span><span>
</span><span style=color:#bf616a;>$</span><span> cd psw/ae/data/prebuilt/
</span><span style=color:#bf616a;>$</span><span> exa</span><span style=color:#bf616a;> -1
</span><span style=color:#bf616a;>le_prod_css.bin
</span><span style=color:#bf616a;>libsgx_id_enclave.signed.so
</span><span style=color:#bf616a;>libsgx_le.signed.so
</span><span style=color:#bf616a;>libsgx_pce.signed.so
</span><span style=color:#bf616a;>libsgx_pve.signed.so
</span><span style=color:#bf616a;>libsgx_qe.signed.so
</span><span style=color:#bf616a;>libsgx_qe3.signed.so
</span><span style=color:#bf616a;>libsgx_qve.signed.so
</span><span style=color:#bf616a;>libsgx_tdqe.signed.so
</span></code></pre><h3 id=launch-enclave-le>Launch Enclave (LE) <a aria-label="anchor link" class=anchor-link href=#launch-enclave-le> # </a></h3><p>The Launch Enclave generates a <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-token>Launch Token</a>, which is needed to run another enclave. The LE itself is special in that it doesn't need a launch token, but its signing key id, [[#Signer Measurement MRSIGNER|<code>MRSIGNER</code>]], must match the CPU's configuration.<p>The API for generating a new <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-token>Launch Token</a> takes (1) a <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-signature-struct-sigstruct>SIGSTRUCT</a> and (2) an <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-attributes>Enclave Attributes</a> bitflag and returns a new launch token.<p>See: <a href=https://github.com/fortanix/rust-sgx/blob/64100155aa8e0e9379fd66c6128e6f1605442e75/intel-sgx/sgxs/src/einittoken.rs#L15>Fortanix EDP <code>EinittokenProvider</code> trait</a><p>See: <a href=https://github.com/fortanix/rust-sgx/blob/64100155aa8e0e9379fd66c6128e6f1605442e75/intel-sgx/aesm-client/src/lib.rs#L265>Fortanix EDP <code>AesmService</code> impl</a><p>Enclave file: <code>libsgx_le.signed.so</code>.<p><a href=https://github.com/intel/linux-sgx/blob/master/psw/ae/le/launch_enclave.edl>Enclave API</a>:<pre class=language-c++ data-lang=c++ style=background-color:#2b303b;color:#c0c5ce;><code class=language-c++ data-lang=c++><span>enclave {
</span><span>include "</span><span style=color:#a3be8c;>arch.h</span><span>"
</span><span>include "</span><span style=color:#a3be8c;>sgx_report.h</span><span>"
</span><span>from "</span><span style=color:#a3be8c;>sgx_tstdc.edl</span><span>" import *;
</span><span>
</span><span style=color:#bf616a;>trusted </span><span>{
</span><span>	public </span><span style=color:#b48ead;>int </span><span style=color:#bf616a;>le_get_launch_token_wrapper</span><span>(
</span><span>		[in]  </span><span style=color:#b48ead;>const</span><span> sgx_measurement_t *mrenclave,
</span><span>		[in]  </span><span style=color:#b48ead;>const</span><span> sgx_measurement_t *mrsigner,
</span><span>		[in]  </span><span style=color:#b48ead;>const</span><span> sgx_attributes_t  *se_attributes,
</span><span>		[out] token_t               * lictoken
</span><span>	);
</span><span>
</span><span>	public uint32_t </span><span style=color:#bf616a;>le_init_white_list_wrapper</span><span>(
</span><span>		[size = wl_cert_chain_size, in]  </span><span style=color:#b48ead;>const </span><span>uint8_t *wl_cert_chain,
</span><span>		uint32_t wl_cert_chain_size
</span><span>	);
</span><span>};
</span><span>};
</span></code></pre><h3 id=quoting-enclave-qe>Quoting Enclave (QE) <a aria-label="anchor link" class=anchor-link href=#quoting-enclave-qe> # </a></h3><p>An Intel-provided, signed enclave trusted by the attestation infrastructure to <strong>sign</strong> and <strong>issue</strong> <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quote>Quotes</a> or attestations about other enclaves on the same platform.<p>The QE will include a hash of the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#attestation-key-ak>AK</a> in its <code>QE.REPORT.ReportData</code>.<p>The QE will also include the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>PCE's</a> certification of itself (the QE) in its <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#report-ereport>REPORT</a>.<p>Enclave file: <code>libsgx_qe.signed.so</code>.<p><a href=https://github.com/intel/linux-sgx/blob/master/psw/ae/qe/quoting_enclave.edl>Enclave API</a>:<pre class=language-c++ data-lang=c++ style=background-color:#2b303b;color:#c0c5ce;><code class=language-c++ data-lang=c++><span>enclave {
</span><span>include "</span><span style=color:#a3be8c;>sgx_report.h</span><span>"
</span><span>include "</span><span style=color:#a3be8c;>sgx_quote.h</span><span>"
</span><span>from "</span><span style=color:#a3be8c;>sgx_tstdc.edl</span><span>" import *;
</span><span>
</span><span style=color:#bf616a;>trusted </span><span>{
</span><span>	public uint32_t </span><span style=color:#bf616a;>verify_blob</span><span>(
</span><span>		[size = blob_size, in, out] uint8_t *p_blob,
</span><span>		uint32_t blob_size,
</span><span>		[out] uint8_t *p_is_resealed,
</span><span>		[out] sgx_cpu_svn_t *p_cpusvn
</span><span>	);
</span><span>
</span><span>	public uint32_t </span><span style=color:#bf616a;>get_quote</span><span>(
</span><span>		[size = blob_size, in, out] uint8_t *p_blob,
</span><span>		uint32_t blob_size,
</span><span>		[in] </span><span style=color:#b48ead;>const</span><span> sgx_report_t *p_report,
</span><span>		sgx_quote_sign_type_t quote_type,
</span><span>		[in] </span><span style=color:#b48ead;>const</span><span> sgx_spid_t *p_spid,
</span><span>		[in] </span><span style=color:#b48ead;>const</span><span> sgx_quote_nonce_t *p_nonce,
</span><span>		</span><span style=color:#65737e;>// SigRL is relatively big, so we cannot copy it into EPC
</span><span>		[user_check] </span><span style=color:#b48ead;>const </span><span>uint8_t *p_sig_rl,
</span><span>		uint32_t sig_rl_size,
</span><span>		[out] sgx_report_t *qe_report,
</span><span>		</span><span style=color:#65737e;>// Quote is also big, we should output it in piece meal.
</span><span>		[user_check] uint8_t *p_quote,
</span><span>		uint32_t quote_size, sgx_isv_svn_t pce_isvnsvn
</span><span>	);
</span><span>};
</span><span>};
</span><span>
</span></code></pre><h3 id=provisioning-certification-enclave-pce>Provisioning Certification Enclave (PCE) <a aria-label="anchor link" class=anchor-link href=#provisioning-certification-enclave-pce> # </a></h3><p>An Intel-provided enclave that acts as a Certificate Authority (CA) for local Quoting Enclaves running on the same platform. It endorses the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#attestation-key-ak>Attestation Keys</a> provisioned to each Quoting Enclave with its <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-key-pck>Provisioning Certification Key (PCK)</a>.<p>The PCE's PCK is itself endorsed by the Intel Root CA.<p>The <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QEs</a> can request the PCE to sign their <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#report-ereport>REPORTs</a> with the PCE's <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-key-pck>PCK</a>. These signed REPORTs contain ReportData proving that attestation keys or provisioning protocol messages are generated on genuine HW.<p>Only the PCE can produce the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-key-pck>PCK</a> private keys.<p>The PCE provides an API for getting the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#pck-cert>PCK Cert</a>-ID (EncPPID+TCB+PCE-ID) used by a verifier to lookup the matching <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#pck-cert>PCK Cert</a> via the remote <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#intel-attestation-services-ias>IAS API</a>.<p>The PCE also provides an API for signing another enclave (e.g., the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE</a>) <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#report-ereport>REPORT</a> using the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-key-pck>PCK</a>.<p>See: <a href=https://www.intel.com/content/dam/develop/external/us/en/documents/intel-sgx-support-for-third-party-attestation-801017.pdf>Intel - Supporting Third Party Attestation for Intel SGX with Intel Data Center Attestation Primitives</a><p>Enclave file: <code>libsgx_pce.signed.so</code>.<p><a href=https://github.com/intel/linux-sgx/blob/master/psw/ae/pce/pce.edl>Enclave API</a>:<pre class=language-c++ data-lang=c++ style=background-color:#2b303b;color:#c0c5ce;><code class=language-c++ data-lang=c++><span>enclave{
</span><span>include "</span><span style=color:#a3be8c;>pce_cert.h</span><span>"
</span><span>include "</span><span style=color:#a3be8c;>sgx_report.h</span><span>"
</span><span>from "</span><span style=color:#a3be8c;>sgx_tstdc.edl</span><span>" import *;
</span><span>
</span><span style=color:#bf616a;>trusted </span><span>{
</span><span>	public uint32_t </span><span style=color:#bf616a;>get_pc_info</span><span>(
</span><span>		[in]</span><span style=color:#b48ead;>const</span><span> sgx_report_t *report,
</span><span>		[in, size=key_size]</span><span style=color:#b48ead;>const </span><span>uint8_t *public_key, uint32_t key_size,
</span><span>		uint8_t crypto_suite,
</span><span>		[out, size=encrypted_ppid_buf_size]uint8_t *encrypted_ppid, uint32_t encrypted_ppid_buf_size,
</span><span>		[out]uint32_t *encrypted_ppid_out_size,
</span><span>		[out]pce_info_t *pce_info,
</span><span>		[out] uint8_t *signature_scheme
</span><span>	);
</span><span>
</span><span>	public uint32_t </span><span style=color:#bf616a;>certify_enclave</span><span>(
</span><span>		[in]</span><span style=color:#b48ead;>const</span><span> psvn_t *cert_psvn,
</span><span>		[in]</span><span style=color:#b48ead;>const</span><span> sgx_report_t *report,
</span><span>		[out, size=signature_buf_size]uint8_t *signature, uint32_t signature_buf_size,
</span><span>		[out]uint32_t *signature_out_size
</span><span>	);
</span><span>
</span><span>	public uint32_t </span><span style=color:#bf616a;>get_pc_info_without_ppid</span><span>(
</span><span>		[out]pce_info_t *pce_info
</span><span>	);
</span><span>};
</span><span>};
</span></code></pre><h3 id=provisioning-enclave-pe-or-pve>Provisioning Enclave (PE or PvE) <a aria-label="anchor link" class=anchor-link href=#provisioning-enclave-pe-or-pve> # </a></h3><p>If using the <em>anonymous</em> EPID <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#attestation-key-ak>Attestation Key (AK)</a> Algorithm, then a special Provisioning Enclave is used to interface with the Intel EPID provisioning servers to provision the enclave's AK.<p>Enclave file: <code>libsgx_pve.signed.so</code>.<p>See: <a href=https://github.com/intel/linux-sgx/blob/master/psw/ae/pve/provision_enclave.edl>Enclave API</a><h3 id=platform-services-enclave-pse>Platform Services Enclave (PSE) <a aria-label="anchor link" class=anchor-link href=#platform-services-enclave-pse> # </a></h3><p>Intel also provides a set of additional platform enclaves which offer useful services like monotonic counters and trusted time to other enclaves on the machine.<p>The PSE talks to the local Intel Management Engine (IME) over a secure channel. Inside the IME is a small 32-bit Intel core running completely isolated from the general purpose CPU cores.<h4 id=trusted-time-service>Trusted Time Service <a aria-label="anchor link" class=anchor-link href=#trusted-time-service> # </a></h4><p>The PSE exposes a Protected Real-time Clock (PRTC), which measures relative elapsed seconds since the initial clock measurement. <strong>This value is not a calendar or wall-clock time.</strong> To establish a trusted clock base time, you'll need to query some remote semi-trusted servers over a secure channel.<p>See: <a href="https://cdrdv2.intel.com/v1/dl/getContent/671564?explicitVersion=true">Intel - Trusted Time and Monotonic Counters with SGX Platform Services Enclave</a><p>See: <a href=https://www.usenix.org/system/files/cset19-paper_anwar.pdf>2019 - Applications and Challenges in Securing Time</a><h3 id=tdx-quoting-enclave-tdqe>TDX Quoting Enclave (TDQE) <a aria-label="anchor link" class=anchor-link href=#tdx-quoting-enclave-tdqe> # </a></h3><p>Enclave File: <code>libsqx_tdqe.signed.so</code>.<p><a href=https://github.com/intel/SGXDataCenterAttestationPrimitives/blob/master/QuoteGeneration/quote_wrapper/tdx_quote/enclave/tdqe.edl>Enclave API</a>:<pre class=language-cpp data-lang=cpp style=background-color:#2b303b;color:#c0c5ce;><code class=language-cpp data-lang=cpp><span>
</span><span>enclave {
</span><span>include "</span><span style=color:#a3be8c;>sgx_report.h</span><span>"
</span><span>include "</span><span style=color:#a3be8c;>sgx_quote.h</span><span>"
</span><span>include "</span><span style=color:#a3be8c;>sgx_report2.h</span><span>"
</span><span>include "</span><span style=color:#a3be8c;>user_types.h</span><span>"
</span><span>include "</span><span style=color:#a3be8c;>ecdsa_quote.h</span><span>"
</span><span>
</span><span style=color:#bf616a;>trusted </span><span>{
</span><span>    public uint32_t </span><span style=color:#bf616a;>get_pce_encrypt_key</span><span>(
</span><span>	    [in]</span><span style=color:#b48ead;>const</span><span> sgx_target_info_t *pce_target_info,
</span><span>		[out] sgx_report_t *p_qe_report,
</span><span>		uint8_t crypto_suite,
</span><span>		uint16_t cert_key_type,
</span><span>		uint32_t key_size,
</span><span>		[out, size=key_size] uint8_t *p_public_key
</span><span>	);
</span><span>
</span><span>    public uint32_t </span><span style=color:#bf616a;>gen_att_key</span><span>(
</span><span>	    [size = blob_size, in, out] uint8_t *p_blob,
</span><span>		uint32_t blob_size,
</span><span>		[in]</span><span style=color:#b48ead;>const</span><span> sgx_target_info_t *p_pce_target_info,
</span><span>		[out] sgx_report_t *qe_report,
</span><span>		[in, size = authentication_data_size] uint8_t* p_authentication_data,
</span><span>		uint32_t authentication_data_size
</span><span>	);
</span><span>
</span><span>    public uint32_t </span><span style=color:#bf616a;>verify_blob</span><span>(
</span><span>	    [size = blob_size, in, out] uint8_t *p_blob,
</span><span>		uint32_t blob_size,
</span><span>		[out] uint8_t *p_is_resealed,
</span><span>		[out] sgx_report_body_t *p_report,
</span><span>		uint32_t pub_key_id_size,
</span><span>		[out, size=pub_key_id_size] uint8_t *p_pub_key_id
</span><span>	);
</span><span>
</span><span>    public uint32_t </span><span style=color:#bf616a;>store_cert_data</span><span>(
</span><span>	    [in]ref_plaintext_ecdsa_data_sdk_t *p_plaintext_data,
</span><span>		sgx_ql_cert_key_type_t certification_key_type,
</span><span>		[in, size = encrypted_ppid_size] uint8_t* p_encrypted_ppid,
</span><span>		uint32_t encrypted_ppid_size,
</span><span>		[in, out, size = blob_size] uint8_t *p_blob,
</span><span>		uint32_t blob_size
</span><span>	);
</span><span>
</span><span>    public uint32_t </span><span style=color:#bf616a;>gen_quote</span><span>(
</span><span>		[size = blob_size, in, out] uint8_t *p_blob,
</span><span>		uint32_t blob_size,
</span><span>		[in] </span><span style=color:#b48ead;>const</span><span> sgx_report2_t *p_app_report,
</span><span>		[in] </span><span style=color:#b48ead;>const</span><span> sgx_quote_nonce_t *p_nonce,
</span><span>		[in] </span><span style=color:#b48ead;>const</span><span> sgx_target_info_t *p_app_enclave_target_info,
</span><span>		[out] sgx_report_t *p_qe_report,
</span><span>		[size = quote_size, in, out] uint8_t *p_quote,
</span><span>		uint32_t quote_size,
</span><span>		[in, size = cert_data_size] </span><span style=color:#b48ead;>const </span><span>uint8_t * p_cert_data,
</span><span>		uint32_t cert_data_size
</span><span>	);
</span><span>};
</span><span>};
</span></code></pre><h3 id=architectural-enclave-service-manager-aesm>Architectural Enclave Service Manager (AESM) <a aria-label="anchor link" class=anchor-link href=#architectural-enclave-service-manager-aesm> # </a></h3><p>Instead of interacting with the local <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#architectural-enclaves>Architectural Enclaves</a> directly, local user applications and libraries typically interface with a local Intel-provided service called the Architectural Enclave Service Manager. The AESM service typically runs as a local daemon and provides a socket for applications to interface with.<p>An AESM client allows user applications to easily obtain <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-token>Launch Tokens</a> from the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-enclave-le>LE</a>, needed for running enclaves, and turn <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#report-ereport>Attestation Reports</a> into <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quote>Quotes</a> via the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE</a>.<p>Check out the <a href=https://github.com/fortanix/rust-sgx/blob/master/intel-sgx/aesm-client/src/aesm_proto.proto>Protobuf definitions</a> and <a href=https://github.com/fortanix/rust-sgx/blob/master/intel-sgx/aesm-client/src/lib.rs#L178>AesmClient API</a>.<h2 id=provisioning-certification-key-pck>Provisioning Certification Key (PCK) <a aria-label="anchor link" class=anchor-link href=#provisioning-certification-key-pck> # </a></h2><p>A signing key available to the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>PCE</a> for signing <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE</a> <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#report-ereport>REPORTs</a>.<p>This key is unique to the specific processor instance, HW TCB, and <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>PCE</a> version.<p>See: <a href=https://github.com/fortanix/rust-sgx/blob/master/intel-sgx/dcap-retrieve-pckid/src/main.rs#L38>Fortanix EDP - dcap-retrieve-pckid via AESM</a><h2 id=pck-cert>PCK Cert <a aria-label="anchor link" class=anchor-link href=#pck-cert> # </a></h2><p>A long-lived x.509 CA cert signed and distributed by Intel for every SGX platform.<p>The Intel-provided <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>Provisioning Certification Enclave (PCE)</a> uses this cert to endorse <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#attestation-key-ak>Attestation Keys</a> provisioned to any <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>Quoting Enclaves</a>.<p>This cert is used by <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quote>Quote</a> verifiers to check that the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE</a> is valid and running and running on a specific PSVN.<p>The PCK Cert is endorsed by the Intel SGX Root CA via an intermediate Intel SGX PCK Platform CA.<p>The PCK Cert has some extra cert extension fields, described in more detail in the <a href=https://download.01.org/intel-sgx/dcap-1.0.1/docs/SGX_PCK_Certificate_CRL_Spec-1.0.pdf>Intel PCK Cert Spec</a>. These mostly appear to be metadata, like the PPID, TCB levels, CPUSVN, CPU SKU, and a list of supported extensions.<h2 id=platform-provisioning-id-ppid>Platform Provisioning ID (PPID) <a aria-label="anchor link" class=anchor-link href=#platform-provisioning-id-ppid> # </a></h2><p>The provisioning ID for a processor package or platform instance. PPID is not TCB dependent.<h2 id=security-version-number-svn>Security Version Number (SVN) <a aria-label="anchor link" class=anchor-link href=#security-version-number-svn> # </a></h2><p>A monotonically increasing version number that corresponds with major security releases of TCB software.<p>Note that new, non-security-critical software versions can be released without touching the SVN.<p>Part of the verification process is just checking that the remote enclave is running a recent TCB software version without any unpatched vulnerabilities.<h2 id=platform-security-version-number-psvn-cpusvn>Platform Security Version Number (PSVN, CPUSVN) <a aria-label="anchor link" class=anchor-link href=#platform-security-version-number-psvn-cpusvn> # </a></h2><p>A list of <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#security-version-number-svn>SVNs</a> for each component in the SGX TCB, including the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>PCE</a> SVN.<p>Think of a PSVN as pinning each component in the TCB to a specific (security-critical) version.<h2 id=independent-software-vendor-isv>Independent Software Vendor (ISV) <a aria-label="anchor link" class=anchor-link href=#independent-software-vendor-isv> # </a></h2><p>ISVs develop enclave applications.<h2 id=intel-attestation-services-ias>Intel Attestation Services (IAS) <a aria-label="anchor link" class=anchor-link href=#intel-attestation-services-ias> # </a></h2><p>See: <a href=https://api.trustedservices.intel.com/documents/sgx-attestation-api-spec.pdf>Intel Attestation Services - API Specification v6.1</a><p>See: <a href=https://www.intel.com/content/www/us/en/forms/developer/standard-registration.html>Intel Developer Zone Registration</a><p>See: <a href=https://github.com/oasisprotocol/oasis-core/blob/07bc8cdf39b274ff9171eebc365ceb0842750717/go/ias/http/http.go>Oasis IAS proxy backend to the Intel API</a><p>See: []<h2 id=service-provider-id-spid>Service Provider ID (SPID) <a aria-label="anchor link" class=anchor-link href=#service-provider-id-spid> # </a></h2><p>The id of the credentials needed for a Service Provider to talk with with the Intel Attestation Services (IAS).<p>Service Providers must register with Intel in order to acquire these credentials.<h2 id=enclave-page-cache-epc>Enclave Page Cache (EPC) <a aria-label="anchor link" class=anchor-link href=#enclave-page-cache-epc> # </a></h2><p>A region of memory on the platform allocated to enclave code and data.<h2 id=provisioning-tcb>Provisioning TCB <a aria-label="anchor link" class=anchor-link href=#provisioning-tcb> # </a></h2><p>The Intel SGX Trusted Computing Base (TCB). This TCB includes the platform HW TCB and <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>PCE</a> <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#security-version-number-svn>SVN</a>.<h2 id=pce-id>PCE-ID <a aria-label="anchor link" class=anchor-link href=#pce-id> # </a></h2><p>The <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>PCE</a> <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#security-version-number-svn>SVN</a> (?) used to generate the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#platform-provisioning-id-ppid>PPID</a> and <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-key-pck>PCK</a> signing key.<h2 id=data-center-attestation-primitives-dcap>Data Center Attestation Primitives (DCAP) <a aria-label="anchor link" class=anchor-link href=#data-center-attestation-primitives-dcap> # </a></h2><p>A library for generating and verifying attestation evidence.<p>The Intel-provided library is called Intel SGX DCAP. There's also a version by Microsoft called Azure DCAP, which (AFAICT) uses an Azure-run cache over the Intel API services.<h2 id=launch-token>Launch Token <a aria-label="anchor link" class=anchor-link href=#launch-token> # </a></h2><p>TODO<h2 id=flexible-launch-control-flc>Flexible Launch Control (FLC) <a aria-label="anchor link" class=anchor-link href=#flexible-launch-control-flc> # </a></h2><p>An SGX feature only available on more recent platforms that allows an arbitrary <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-enclave-le>LE</a> to generate <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-token>launch tokens</a>.<p>The default launch policy still uses an SGX client whitelist; however, FLC allows a platform owner to change the default <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-enclave-le>LE</a> <code>MRSIGNER</code> to different value.<h2 id=enclave-load-policy>Enclave Load Policy <a aria-label="anchor link" class=anchor-link href=#enclave-load-policy> # </a></h2><p>The remote service providing enclave services, linked with the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#data-center-attestation-primitives-dcap>DCAP</a> library, can choose whether system enclaves like the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE</a> and <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#provisioning-certification-enclave-pce>PCE</a> are loaded on-demand (as application enclaves request their services) or loaded persistently (load once and then keep them loaded until the application shuts down).<p>The two options trade off between greater <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-page-cache-epc>EPC</a> usage (Persistent) and greater remote attestation latency + overhead (Ephemeral).<h2 id=owner-epoch>Owner Epoch <a aria-label="anchor link" class=anchor-link href=#owner-epoch> # </a></h2><p>The Owner Epoch is a 128-bit value used in the Seal Key KDF.<p>Since the Owner Epoch is used in the Seal Key KDF, any change to this value would DoS our HW from unsealing any protected data from a previous Owner Epoch value. A malicious cloud operator (Azure) could DoS attack us by changing the Owner Epoch, forcing us to re-provision all enclave secrets.<p>More likely, a vulnerability, TCB violation, or operator error could lead to an unintended Owner Epoch rotation.<p>To help with recovery, applications should record the current Owner Epoch in case something goes wrong. If nobody remembers the Owner Epoch, we can never restore our Seal Keys.<p>Apparently it's also possible virtualize the Owner Epoch if running inside a hypervisor? (TODO: confirm).<p>Ref: <a href=https://davejingtian.org/2018/06/24/some-notes-on-sgx-ownerepoch-and-sealing/>2018 - Some notes on SGX OwnerEpoch and Sealing</a><h2 id=quoting-enclave-id-qe-id>Quoting Enclave ID (QE-ID) <a aria-label="anchor link" class=anchor-link href=#quoting-enclave-id-qe-id> # </a></h2><p>A pseudo-platform ID that isn't associated with a particular SVN. Instead, the ID is dependent on (1) the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE's</a> <code>MRSIGNER</code>, (2) its Seal Key, which depends<h2 id=quoting-enclave-quoteinfo>Quoting Enclave QuoteInfo <a aria-label="anchor link" class=anchor-link href=#quoting-enclave-quoteinfo> # </a></h2><p><code>QuoteInfo</code> is the quoting enclave's information needed for clients to perform remote attestation. The <code>target_info</code> is a serialized <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#targetinfo>TargetInfo</a>.<pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>pub struct </span><span>QuoteInfo {
</span><span>    </span><span style=color:#bf616a;>target_info</span><span>: Vec<</span><span style=color:#b48ead;>u8</span><span>>, </span><span style=color:#65737e;>// serialized Targetinfo
</span><span>    </span><span style=color:#bf616a;>pub_key_id</span><span>: Vec<</span><span style=color:#b48ead;>u8</span><span>>,
</span><span>}
</span></code></pre><h2 id=targetinfo>TargetInfo <a aria-label="anchor link" class=anchor-link href=#targetinfo> # </a></h2><p><code>Targetinfo</code> is a measurement of the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#quoting-enclave-qe>QE</a>.<pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span>#[</span><span style=color:#bf616a;>repr</span><span>(C, </span><span style=color:#bf616a;>align</span><span>(512))]
</span><span style=color:#b48ead;>pub struct </span><span>Targetinfo {
</span><span>    </span><span style=color:#b48ead;>pub </span><span style=color:#bf616a;>measurement</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#b48ead;>pub </span><span style=color:#bf616a;>attributes</span><span>: Attributes,
</span><span>    </span><span style=color:#b48ead;>pub </span><span style=color:#bf616a;>_reserved1</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 4],
</span><span>    </span><span style=color:#b48ead;>pub </span><span style=color:#bf616a;>miscselect</span><span>: Miscselect,
</span><span>    </span><span style=color:#b48ead;>pub </span><span style=color:#bf616a;>_reserved2</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 456],
</span><span>}
</span></code></pre><h2 id=enclave-measurement-mrenclave>Enclave Measurement (MRENCLAVE) <a aria-label="anchor link" class=anchor-link href=#enclave-measurement-mrenclave> # </a></h2><p>In order to for a client to feel secure provisioning their secrets into an enclave, they need to verify that the enclave is running <em>trusted software</em>. An <strong>enclave measurement</strong> effectively summarizes the initial state of the <em>trusted software</em> running in the enclave.<p>Intel SGX constructs this measurement when the enclave is built and initialized. During enclave init, it records a log of all important build activities, including:<ul><li>Content: code, data, stack, heap<li>Location of each page within the enclave<li>Security flags used</ul><p>The measurement is actually not the full log, but a 256-bit hash digest of the log. This measurement is stored as <code>MRENCLAVE</code> inside the enclave's software TCB and is accessible inside the enclave via a syscall.<p>Clients can then compare the observed <code>MRENCLAVE</code> with a trusted, expected <code>MRENCLAVE</code> value to guarantee that the enclave is running the expected software.<p>For systems using the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#fortanix-sgx-stream-format-sgxs>Fortanix SGX Stream format (SGXS)</a> to describe an enclave, the SHA256 hash of the <code>.sgxs</code> bytes is exactly the enclave's <code>MRENCLAVE</code>*. Very convenient!<p>*Unless you use the Extended SGXS format, which allows unmeasured sections. In that case, you need to be a little more careful about how you hash the format and ignore the unmeasured sections.<h3 id=why-do-we-need-to-verify-the-software-inside-the-enclave>Why do we need to verify the software inside the enclave? <a aria-label="anchor link" class=anchor-link href=#why-do-we-need-to-verify-the-software-inside-the-enclave> # </a></h3><p>If the client forgets to verify the actual software running inside the enclave, there's a simple attack to exfiltrate the client's secrets! All we need to do is run some malicious code in the enclave, which just prints the client's secrets after provisioning. Boom, client secrets leaked.<p>Keep in mind the enclave could be 100% genuine Intel hardware, but unless the client verifies the actual software inside the enclave, they should <em>absolutely not provision their secrets</em>.<h2 id=fortanix-sgx-stream-format-sgxs>Fortanix SGX Stream format (SGXS) <a aria-label="anchor link" class=anchor-link href=#fortanix-sgx-stream-format-sgxs> # </a></h2><p>The SGX stream (SGXS) format is the most basic description of an enclave, and when combined with a signature and initialization token file contains all the information needed by an Operating System to load the enclave.<p>The format consists entirely of all data that would be hashed to produce the enclave measurement [[#Enclave Measurement MRENCLAVE|<code>MRENCLAVE</code>]].<p>See: <a href=https://github.com/fortanix/rust-sgx/blob/master/doc/SGXS.md><code>Fortanix EDP - SGX Stream format (SGXS)</code></a>.<p>See: <a href=https://edp.fortanix.com/docs/tasks/deployment/#sgxs-conversion><code>Fortanix EDP - ftxsgx-elf2sgxs</code></a> for converting a standard ELF binary to SGXS.<p>See: <a href=https://edp.fortanix.com/docs/tasks/deployment/#signing><code>Fortanix EDP - sgxs-sign</code></a> for signing SGXS with your RSA private key.<h2 id=signer-measurement-mrsigner>Signer Measurement (MRSIGNER) <a aria-label="anchor link" class=anchor-link href=#signer-measurement-mrsigner> # </a></h2><p>Each enclave is also signed by the client or the enclave author, depending on the exact trust model. The <code>MRSIGNER</code> is just the enclave signer's pubkey hash.<p>The signer signs part of the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-signature-struct-sigstruct>SIGSTRUCT</a>, which then includes the signature and signer pubkey inside.<p>Sealing keys can be derived from the signer measurement + ISV product id/svn, instead of the enclave measurement to allow easy upgrading across different versions of the same enclave.<p>Rust code for generating a signer and computing its measurement:<pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#65737e;>// Generating a 3072-bit RSA key + measurement for signing
</span><span style=color:#65737e;>// sigstructs. NOTE: the RSA exponent MUST be 3.
</span><span style=color:#b48ead;>let</span><span> e = openssl::bn::BigNum::from_u32(</span><span style=color:#d08770;>3</span><span>)?;
</span><span style=color:#b48ead;>let</span><span> key = openssl::rsa::Rsa::generate_with_e(</span><span style=color:#d08770;>3072</span><span>, &e)?;
</span><span>
</span><span style=color:#65737e;>// The signer measurement is the SHA-256 hash of the little-endian
</span><span style=color:#65737e;>// public key modulus.
</span><span>
</span><span style=color:#65737e;>// Openssl returns the modulus in big-endian, so we need to reverse
</span><span style=color:#65737e;>// the bytes to little-endian before hashing.
</span><span style=color:#b48ead;>let mut</span><span> modulus = key.</span><span style=color:#96b5b4;>n</span><span>().</span><span style=color:#96b5b4;>to_vec</span><span>();
</span><span>modulus.</span><span style=color:#96b5b4;>reverse</span><span>();
</span><span style=color:#b48ead;>let mut</span><span> modulus_buf = [</span><span style=color:#d08770;>0</span><span style=color:#b48ead;>u8</span><span>; </span><span style=color:#d08770;>384</span><span>];
</span><span>modulus_buf[..modulus.</span><span style=color:#96b5b4;>len</span><span>()].</span><span style=color:#96b5b4;>copy_from_slice</span><span>(&modulus);
</span><span>
</span><span style=color:#b48ead;>let</span><span> signer_measurement = sha256::digest(&modulus_buf).</span><span style=color:#96b5b4;>as_slice</span><span>();
</span></code></pre><h2 id=enclave-signature-struct-sigstruct>Enclave Signature Struct (SIGSTRUCT) <a aria-label="anchor link" class=anchor-link href=#enclave-signature-struct-sigstruct> # </a></h2><p>Each enclave has an associated <code>SIGSTRUCT</code>, which contains (among other things):<ol><li>The <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-measurement-mrenclave>MRENCLAVE</a>, pinning the enclave initial state.<li>The CPU <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#security-version-number-svn>SVN</a>.<li>The ISV<li>The ISVPRODID<li>The <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-attributes>Enclave Attributes</a> and <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-miscselect>Enclave Miscselect</a> bit flags.</ol><p>The enclave signer then signs a specific portion of the <code>SIGSTRUCT</code>. This signature, along with the signer's full RSA-3072 pubkey, is then placed into the <code>SIGSTRUCT</code> itself.<p>See the <a href=https://github.com/fortanix/rust-sgx/blob/master/intel-sgx/sgx-isa/src/lib.rs#L559>Fortanix EDP SIGSTRUCT definition</a>.<pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>struct </span><span>Sigstruct {
</span><span>    </span><span style=color:#bf616a;>header</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 16],
</span><span>    </span><span style=color:#bf616a;>vendor</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>    </span><span style=color:#bf616a;>date</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>    </span><span style=color:#bf616a;>header2</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 16],
</span><span>    </span><span style=color:#bf616a;>swdefined</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>    </span><span style=color:#bf616a;>_reserved1</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 84],
</span><span>    </span><span style=color:#bf616a;>modulus</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 384],
</span><span>    </span><span style=color:#bf616a;>exponent</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>    </span><span style=color:#bf616a;>signature</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 384],
</span><span>    </span><span style=color:#bf616a;>miscselect</span><span>: Miscselect,
</span><span>    </span><span style=color:#bf616a;>miscmask</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>    </span><span style=color:#bf616a;>_reserved2</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 20],
</span><span>    </span><span style=color:#bf616a;>attributes</span><span>: Attributes,
</span><span>    </span><span style=color:#bf616a;>attributemask</span><span>: [</span><span style=color:#b48ead;>u64</span><span>; 2],
</span><span>    </span><span style=color:#bf616a;>enclavehash</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>_reserved3</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>isvprodid</span><span>: </span><span style=color:#b48ead;>u16</span><span>,
</span><span>    </span><span style=color:#bf616a;>isvsvn</span><span>: </span><span style=color:#b48ead;>u16</span><span>,
</span><span>    </span><span style=color:#bf616a;>_reserved4</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 12],
</span><span>    </span><span style=color:#bf616a;>q1</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 384],
</span><span>    </span><span style=color:#bf616a;>q2</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 384],
</span><span>}
</span></code></pre><p>See: <a href=https://github.com/oasisprotocol/oasis-core/blob/de45fe06920b79095a2c2c7fde5b3e84949e8ed1/go/common/sgx/sigstruct/sigstruct.go#L204>oasis-core/go/common/sgx/sigstruct.Verify</a><ul><li>(Binding) ensure that the <code>sigstruct.mrenclave</code> matches the actual <code>mrenclave</code> that we're about to load.</ul><h2 id=enclave-info>Enclave Info <a aria-label="anchor link" class=anchor-link href=#enclave-info> # </a></h2><pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>struct </span><span>EnclaveInfo {
</span><span>	</span><span style=color:#65737e;>// The enclave measurement
</span><span>	</span><span style=color:#bf616a;>mrenclave</span><span>: Vec<</span><span style=color:#b48ead;>u8</span><span>>,
</span><span>	</span><span style=color:#65737e;>// The signer measurement
</span><span>	</span><span style=color:#bf616a;>mrsigner</span><span>: Vec<</span><span style=color:#b48ead;>u8</span><span>>,
</span><span>	</span><span style=color:#65737e;>// The ISV Product ID
</span><span>	</span><span style=color:#bf616a;>isvprodid</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>	</span><span style=color:#65737e;>// The ISV SVN
</span><span>	</span><span style=color:#bf616a;>isvsvn</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>}
</span></code></pre><h2 id=report-targetinfo-targetinfo>Report TargetInfo (TARGETINFO) <a aria-label="anchor link" class=anchor-link href=#report-targetinfo-targetinfo> # </a></h2><p><code>TargetInfo</code> is just the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-measurement-mrenclave>MRENCLAVE</a> plus Attributes and Miscselect masks.<pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>struct </span><span>Targetinfo {
</span><span>	</span><span style=color:#bf616a;>mrenclave</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>	</span><span style=color:#bf616a;>attributes</span><span>: Attributes,
</span><span>	</span><span style=color:#65737e;>// padding
</span><span>	</span><span style=color:#bf616a;>miscselect</span><span>: Miscselect,
</span><span>	</span><span style=color:#65737e;>// padding
</span><span>}
</span></code></pre><h2 id=enclave-init-token-einittoken>Enclave Init Token (EINITTOKEN) <a aria-label="anchor link" class=anchor-link href=#enclave-init-token-einittoken> # </a></h2><p>When launching an enclave, you need to pass a special token to the <code>EINIT</code> instruction. This token is called the <code>EINITTOKEN</code> and is generated by the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-enclave-le>Launch Enclave</a> after it verifies the full <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-signature-struct-sigstruct>Enclave Signature Struct SIGSTRUCT</a> signature.<p>The SGX platform then verifies the contents of the token before it allows the enclave to initialize.<p>Why does Intel use this <code>EINITTOKEN</code> thing rather than just passing the full <code>SIGSTRUCT</code> each time we init? My guess is that it allows us to amortize the <code>SIGSTRUCT</code> signature verification cost. The <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#launch-enclave-le>LE</a> do the expensive signature verification once, produce a cheaply verifiable launch token, then use the launch token each time rather than the expensive <code>SIGSTRUCT</code>.<p>Note that the token is only verifiable by other enclaves on the same machine; it just contains a MAC created with a privileged Intel-only Seal Key.<pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>struct </span><span>Einittoken {
</span><span>    </span><span style=color:#bf616a;>valid</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>    </span><span style=color:#bf616a;>_reserved1</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 44],
</span><span>    </span><span style=color:#bf616a;>attributes</span><span>: Attributes,
</span><span>    </span><span style=color:#bf616a;>mrenclave</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>_reserved2</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>mrsigner</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>_reserved3</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>cpusvnle</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 16],
</span><span>    </span><span style=color:#bf616a;>isvprodidle</span><span>: </span><span style=color:#b48ead;>u16</span><span>,
</span><span>    </span><span style=color:#bf616a;>isvsvnle</span><span>: </span><span style=color:#b48ead;>u16</span><span>,
</span><span>    </span><span style=color:#bf616a;>_reserved4</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 24],
</span><span>    </span><span style=color:#bf616a;>maskedmiscselectle</span><span>: Miscselect,
</span><span>    </span><span style=color:#bf616a;>maskedattributesle</span><span>: Attributes,
</span><span>    </span><span style=color:#bf616a;>keyid</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>mac</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 16],
</span><span>}
</span></code></pre><h2 id=enclave-attributes>Enclave Attributes <a aria-label="anchor link" class=anchor-link href=#enclave-attributes> # </a></h2><pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>struct </span><span>Attributes {
</span><span>    </span><span style=color:#bf616a;>flags</span><span>: AttributesFlags,
</span><span>    </span><span style=color:#bf616a;>xfrm</span><span>: </span><span style=color:#b48ead;>u64</span><span>,
</span><span>}
</span><span>
</span><span>bitflags! {
</span><span>	</span><span style=color:#b48ead;>struct </span><span>AttributesFlags: u64 {
</span><span>		const INIT          = 0b0000_0001;
</span><span>		const DEBUG         = 0b0000_0010;
</span><span>		const MODE64BIT     = 0b0000_0100;
</span><span>		const PROVISIONKEY  = 0b0001_0000;
</span><span>		const EINITTOKENKEY = 0b0010_0000;
</span><span>		const CET           = 0b0100_0000;
</span><span>		const KSS           = 0b1000_0000;
</span><span>	}
</span><span>}
</span></code></pre><pre class=language-c data-lang=c style=background-color:#2b303b;color:#c0c5ce;><code class=language-c data-lang=c><span style=color:#65737e;>// file: common/inc/sgx_attributes.h
</span><span>
</span><span style=color:#65737e;>/* Enclave Flags Bit Masks */
</span><span style=color:#b48ead;>#define </span><span>SGX_FLAGS_INITTED        </span><span style=color:#d08770;>0x0000000000000001</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* If set, then the enclave is initialized */
</span><span style=color:#b48ead;>#define </span><span>SGX_FLAGS_DEBUG          </span><span style=color:#d08770;>0x0000000000000002</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* If set, then the enclave is debug */
</span><span style=color:#b48ead;>#define </span><span>SGX_FLAGS_MODE64BIT      </span><span style=color:#d08770;>0x0000000000000004</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* If set, then the enclave is 64 bit */
</span><span style=color:#b48ead;>#define </span><span>SGX_FLAGS_PROVISION_KEY  </span><span style=color:#d08770;>0x0000000000000010</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* If set, then the enclave has access to provision key */
</span><span style=color:#b48ead;>#define </span><span>SGX_FLAGS_EINITTOKEN_KEY </span><span style=color:#d08770;>0x0000000000000020</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* If set, then the enclave has access to EINITTOKEN key */
</span><span style=color:#b48ead;>#define </span><span>SGX_FLAGS_KSS            </span><span style=color:#d08770;>0x0000000000000080</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* If set, then the enclave uses KSS */
</span><span style=color:#b48ead;>#define </span><span>SGX_FLAGS_AEX_NOTIFY     </span><span style=color:#d08770;>0x0000000000000400</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* If set, then the enclave enables AEX Notify */
</span><span>
</span><span style=color:#65737e;>/* XSAVE Feature Request Mask */
</span><span style=color:#b48ead;>#define </span><span>SGX_XFRM_LEGACY          </span><span style=color:#d08770;>0x0000000000000003</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* Legacy XFRM which includes the basic feature bits required by SGX, x87 state(0x01) and SSE state(0x02) */
</span><span style=color:#b48ead;>#define </span><span>SGX_XFRM_AVX             </span><span style=color:#d08770;>0x0000000000000006</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* AVX XFRM which includes AVX state(0x04) and SSE state(0x02) required by AVX */
</span><span style=color:#b48ead;>#define </span><span>SGX_XFRM_AVX512          </span><span style=color:#d08770;>0x00000000000000E6</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* AVX-512 XFRM */
</span><span style=color:#b48ead;>#define </span><span>SGX_XFRM_MPX             </span><span style=color:#d08770;>0x0000000000000018</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* MPX XFRM - not supported */
</span><span style=color:#b48ead;>#define </span><span>SGX_XFRM_PKRU            </span><span style=color:#d08770;>0x0000000000000200</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* PKRU state */
</span><span style=color:#b48ead;>#define </span><span>SGX_XFRM_AMX             </span><span style=color:#d08770;>0x0000000000060000</span><span style=color:#b48ead;>ULL     </span><span style=color:#65737e;>/* AMX XFRM, including XTILEDATA(0x40000) and XTILECFG(0x20000) */
</span></code></pre><p>Most user enclaves only need to enable the <code>MODE64BIT</code> attribute in production.<p>The <code>KSS</code> attribute enables the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#key-sharing-and-separation-kss>Key sharing and separation (KSS)</a> feature.<p>The Extended Features Request Mask (<code>xfrm</code>) allows an enclave to ensure certain CPU features (e.g., SSE, AESNI) are available, or the enclave will fail to load.<h2 id=enclave-miscselect>Enclave Miscselect <a aria-label="anchor link" class=anchor-link href=#enclave-miscselect> # </a></h2><pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>pub struct </span><span>Miscselect: u32 {
</span><span>	const EXINFO = 0b0000_0001;
</span><span>}
</span></code></pre><h2 id=keyrequest>KEYREQUEST <a aria-label="anchor link" class=anchor-link href=#keyrequest> # </a></h2><p>A struct which gets fed into the Seal Key KDF in order to generate keys for <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/sealing/>sealing</a> or <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/remote%20attestation/>remote attestation</a>.<p>The <code>keyname</code> is a user-defined label<pre class=language-rust data-lang=rust style=background-color:#2b303b;color:#c0c5ce;><code class=language-rust data-lang=rust><span style=color:#b48ead;>struct </span><span>Keyrequest {
</span><span>    </span><span style=color:#bf616a;>keyname</span><span>: </span><span style=color:#b48ead;>u16</span><span>,
</span><span>    </span><span style=color:#bf616a;>keypolicy</span><span>: Keypolicy,
</span><span>    </span><span style=color:#bf616a;>isvsvn</span><span>: </span><span style=color:#b48ead;>u16</span><span>,
</span><span>    </span><span style=color:#bf616a;>_reserved1</span><span>: </span><span style=color:#b48ead;>u16</span><span>,
</span><span>    </span><span style=color:#bf616a;>cpusvn</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 16],
</span><span>    </span><span style=color:#bf616a;>attributemask</span><span>: [</span><span style=color:#b48ead;>u64</span><span>; 2],
</span><span>    </span><span style=color:#bf616a;>keyid</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 32],
</span><span>    </span><span style=color:#bf616a;>miscmask</span><span>: </span><span style=color:#b48ead;>u32</span><span>,
</span><span>    </span><span style=color:#bf616a;>_reserved2</span><span>: [</span><span style=color:#b48ead;>u8</span><span>; 436],
</span><span>}
</span><span>
</span><span style=color:#b48ead;>struct </span><span>Keypolicy: u16 {
</span><span>	const MRENCLAVE = 0b0000_0001;
</span><span>	const MRSIGNER  = 0b0000_0010;
</span><span>}
</span><span>
</span><span>#[</span><span style=color:#bf616a;>repr</span><span>(u16)]
</span><span style=color:#b48ead;>enum </span><span>Keyname {
</span><span>    Einittoken    = </span><span style=color:#d08770;>0</span><span>,
</span><span>    Provision     = </span><span style=color:#d08770;>1</span><span>,
</span><span>    ProvisionSeal = </span><span style=color:#d08770;>2</span><span>,
</span><span>    Report        = </span><span style=color:#d08770;>3</span><span>,
</span><span>    Seal          = </span><span style=color:#d08770;>4</span><span>,
</span><span>}
</span></code></pre><h2 id=key-sharing-and-separation-kss>Key sharing and separation (KSS) <a aria-label="anchor link" class=anchor-link href=#key-sharing-and-separation-kss> # </a></h2><p>See: <a href=https://www.fortanix.com/blog/2018/02/upcoming-intel-sgx-features-explained#key-sharing-and-separation-kss>https://www.fortanix.com/blog/2018/02/upcoming-intel-sgx-features-explained#key-sharing-and-separation-kss</a><p><strong>Premise:</strong> Communicating between two different enclaves is cumbersome. The KSS feature adds more flexibility.<p>The new KSS feature adds a configuration value+SVN and two extra 16-byte product IDs.<p>The 64-byte configuration value and 2-byte SVN is used as a post-init identity. The value affects the attestation identity and (optionally) seal key derivation, but isn't included in the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-signature-struct-sigstruct>Sigstruct</a>. This allows a single enclave binary that is specialized into different services (with different identities!) at load time.<p>The extra product IDs are "family ID" and "extra product ID" (but can be used for other purposes). They can be used in seal key derivation. The IDs <em>are</em> included in the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-signature-struct-sigstruct>Sigstruct</a> but not the <a href=https://phlip9.com/notes/confidential%20computing/intel%20SGX/SGX%20lingo/#enclave-init-token-einittoken>EINITTOKEN</a>. meaning a launch enclave can't use these for access controls.</main></div></div></div><form class=d-none id=search-bar><div class=container><div class="row justify-content-center"><div class="col col-lg-11 col-xl-9" id=search-container><input aria-label="Search notes..." class="form-control is-search" placeholder="Search notes..." autocomplete=off id=userinput type=search><div class="shadow rounded" id=suggestions></div></div></div></div></form><script defer src=https://phlip9.com/notes/js/elasticlunr.min.js></script><script defer src=https://phlip9.com/notes/search_index.en.js></script><script defer src=https://phlip9.com/notes/js/search.js></script>