<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link href=https://phlip9.com/notes/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>enarx (WASM TEE) | philip's notes</title><meta content="a collection of my notes" name=description><link href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/" rel=canonical><meta content=summary name=twitter:card><meta content="enarx (WASM TEE)" name=twitter:title><meta content=@phlip9 name=twitter:site><meta content=@phlip9 name=twitter:creator><meta content="enarx (WASM TEE)" property=og:title><meta content="a collection of my notes" property=og:description><meta content=article property=og:type><meta content="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/" property=og:url><meta content=2024-10-21T04:08:44.982615 property=og:updated_time><meta content="philip's notes" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "/confidential computing/enarx (WASM TEE)/"
    },
    "headline": "enarx (WASM TEE)",
    "image": ,
    "datePublished": "2022-02-17",
    "dateModified": "2024-10-21",
    "author": {
      "@type": "Person",
      "name": "Philip Hayes"
    },
    "publisher": {
      "@type": "Person",
      "name": "Philip Hayes",
      
    },
    "description": "a collection of my notes"
  }
  </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://phlip9.com/notes/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Confidential Computing",
            "item": "https://phlip9.com/notes/confidential computing/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Enarx (Wasm Tee)",
            "item": "https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/"
          },
        
      
    
  }
</script><meta content=#383866 name=theme-color><link href=https://phlip9.com/notes/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://phlip9.com/notes/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://phlip9.com/notes/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://phlip9.com/notes/site.webmanifest rel=manifest><script>// https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html
        window.MathJax = {
          tex: {
            inlineMath: [
              ['$', '$']
            ],
            displayMath: [
              ['$$', '$$'],
              ['\\[', '\\]']
            ],
            processEscapes: true,
            processEnvironments: true,
          },
          options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          }
        };</script><script integrity="sha256-z47L98YXVhVIaY0uyDzt675P5Ea+w3RsPh9VD5NuoTY=" async crossorigin=anonymous defer id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js></script><body class="notes single dark"><div class=container role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 notes-sidebar"><nav aria-label="Main navigation" class=notes-links><a class="navbar-brand link-internal" href=https://phlip9.com/notes/> philip's notes </a><a class="notes-link sidebar-social" href=https://twitter.com/phlip9> <svg class="feather feather-twitter" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg> <span class=visually-hidden>Twitter</span> </a><a class="notes-link sidebar-social" href=https://github.com/phlip9> <svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> <span class=visually-hidden>GitHub</span> </a><a class="notes-link sidebar-social" href=# id=sidebar-open-search> <svg aria-labelledby="title desc" viewbox="0 0 19.9 19.7" fill=none height=20 id=search-icon role=img stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 tabindex=0 width=20 xmlns=http://www.w3.org/2000/svg> <g class=search-path><path d="M18.5 18.3l-5.4-5.4"></path><circle cx=8 cy=8 r=7></circle> </g> </svg> </a><hr><ol id=sidebar-tree-root><li><input id=sidebar-input-ai-ml type=checkbox> <label class=h3 for=sidebar-input-ai-ml>AI ML</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Expectimax Search/"> Expectimax Search </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/AI ML/Markov Decision Process (MDP)/"> Markov Decision Process (MDP) </a></ol><li><input id=sidebar-input-wsl type=checkbox> <label class=h3 for=sidebar-input-wsl>WSL</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/WSL/WSL2 custom kernel/"> WSL2 custom kernel </a></ol><li><li><input id=sidebar-input-android type=checkbox> <label class=h3 for=sidebar-input-android>android</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/ADB over TCP inside WSL2/"> ADB over TCP inside WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/OTA updates for rooted android phone/"> OTA updates for rooted android phone </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/android cli setup/"> android cli setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/building signal-android in WSL2/"> building signal-android in WSL2 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/linux ADB udev setup/"> linux ADB udev setup </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/android/root phone with magisk/"> root phone with magisk </a></ol><li><input id=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n type=checkbox> <label class=h3 for=sidebar-input-b-i-g-m-o-n-e-y-l-a-w-r-e-g-u-l-a-t-i-o-n>b i g m o n e y l a w r e g u l a t i o n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/financial instituion/"> financial instituion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/foreign bank account report (FBAR)/"> foreign bank account report (FBAR) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/monetary instruments/"> monetary instruments </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b i g m o n e y l a w r e g u l a t i o n/money services business (MSB)/"> money services business (MSB) </a></ol><li><input id=sidebar-input-b-l-o-c-k-c-h-a-i-n type=checkbox> <label class=h3 for=sidebar-input-b-l-o-c-k-c-h-a-i-n>b l o c k c h a i n</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/aptos/"> aptos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/bip158 - compact block filters/"> bip158 - compact block filters </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/btc utreexo - utxo accumulator/"> btc utreexo - utxo accumulator </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/fastpay/"> fastpay </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/oasis/"> oasis </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/b l o c k c h a i n/sui/"> sui </a></ol><li><input id=sidebar-input-btc-ln type=checkbox> <label class=h3 for=sidebar-input-btc-ln>btc-ln</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 11 - invoices/"> BOLT 11 - invoices </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 2 - channel management protocol/"> BOLT 2 - channel management protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 4 - onion routing protocol/"> BOLT 4 - onion routing protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 7 - p2p node and channel discovery/"> BOLT 7 - p2p node and channel discovery </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/BOLT 8 - secure noise transport/"> BOLT 8 - secure noise transport </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/atomic multipath payments (AMP)/"> atomic multipath payments (AMP) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/breez lightning service providers/"> breez lightning service providers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/hosted channels/"> hosted channels </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning libs/"> lightning libs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning network notes/"> lightning network notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightning rod/"> lightning rod </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/lightningdevkit - rust-lightning/"> lightningdevkit - rust-lightning </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/submarine swaps/"> submarine swaps </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/btc-ln/zero-conf channels/"> zero-conf channels </a></ol><li><input id=sidebar-input-combinatorics type=checkbox> <label class=h3 for=sidebar-input-combinatorics>combinatorics</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/combinatorics/k-combinations of a multiset/"> k-combinations of a multiset </a></ol><li><input checked id=sidebar-input-confidential-computing type=checkbox> <label class=h3 for=sidebar-input-confidential-computing>confidential computing</label> <ol><li><input id=sidebar-input-confidential-computing-intel-sgx type=checkbox> <label class=h3 for=sidebar-input-confidential-computing-intel-sgx>intel SGX</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/SGX lingo/"> SGX lingo </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/overview/"> overview </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/remote attestation/"> remote attestation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/sealing/"> sealing </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel SGX/secure time/"> secure time </a></ol><li class=sidebar-note><a class="notes-link link-internal active" href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/"> enarx (WASM TEE) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/fortanix rust tutorial/"> fortanix rust tutorial </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/gramine/"> gramine </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/intel TDX/"> intel TDX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/marblerun/"> marblerun </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/mystikos/"> mystikos </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/confidential computing/remote attestation protocols/"> remote attestation protocols </a></ol><li><input id=sidebar-input-crypto type=checkbox> <label class=h3 for=sidebar-input-crypto>crypto</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/(talk) authenticated data structures for stateless validation/"> (talk) authenticated data structures for stateless validation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/TLS self-signed pubkey-only certs/"> TLS self-signed pubkey-only certs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/acme protocol/"> acme protocol </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/biscuit authz/"> biscuit authz </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/dex - open-source OIDC & OAuth 2.0 provider/"> dex - open-source OIDC & OAuth 2.0 provider </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/hkdf-sha256/> hkdf-sha256 </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/smallstep - private online CA & ACME server/"> smallstep - private online CA & ACME server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/crypto/tls exported keying material/"> tls exported keying material </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/crypto/zkdocs/> zkdocs </a></ol><li><input id=sidebar-input-design type=checkbox> <label class=h3 for=sidebar-input-design>design</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/design/form design/"> form design </a></ol><li><input id=sidebar-input-devops type=checkbox> <label class=h3 for=sidebar-input-devops>devops</label> <ol><li><input id=sidebar-input-devops-o11y type=checkbox> <label class=h3 for=sidebar-input-devops-o11y>o11y</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/o11y/jaeger oss e2e tracing/"> jaeger oss e2e tracing </a></ol><li><input id=sidebar-input-devops-secrets type=checkbox> <label class=h3 for=sidebar-input-devops-secrets>secrets</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/1password - secrets automation/"> 1password - secrets automation </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/doppler/> doppler </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson (Shopify)/"> ejson (Shopify) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/ejson-kms (AWS)/"> ejson-kms (AWS) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/envkey/> envkey </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/fortanix DSM/"> fortanix DSM </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/mozilla SOPS/"> mozilla SOPS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/secrets/sops-nix/> sops-nix </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/secrets/sy - share secrets safely/"> sy - share secrets safely </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/AKS - azure kubernetes service/"> AKS - azure kubernetes service </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/algo wireguard VPN server/"> algo wireguard VPN server </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/azure CLI/"> azure CLI </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/consul/> consul </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/deployment strategies/"> deployment strategies </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/docker compose/"> docker compose </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/k3s/> k3s </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/kind (kubernetes in docker)/"> kind (kubernetes in docker) </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/kubernetes/> kubernetes </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/linkerd/> linkerd </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/minikube/> minikube </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/devops/nomad/> nomad </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/devops/service mesh/"> service mesh </a></ol><li><input id=sidebar-input-distributed-systems type=checkbox> <label class=h3 for=sidebar-input-distributed-systems>distributed systems</label> <ol><li><input id=sidebar-input-distributed-systems-papers type=checkbox> <label class=h3 for=sidebar-input-distributed-systems-papers>papers</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast/"> (2020) Semi-Fast Byzantine-tolerant Shared Register without Reliable Broadcast </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/papers/(2021) Leaderless Consensus/"> (2021) Leaderless Consensus </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/distributed systems/the siren song of backpressure/"> the siren song of backpressure </a></ol><li><input id=sidebar-input-fuzzing type=checkbox> <label class=h3 for=sidebar-input-fuzzing>fuzzing</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/fuzzing/bolero - fuzzing + property testing/"> bolero - fuzzing + property testing </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzcheck-rs/> fuzzcheck-rs </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/fuzzing/fuzzing/> fuzzing </a></ol><li><input id=sidebar-input-ios type=checkbox> <label class=h3 for=sidebar-input-ios>ios</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/ios/ios setup/"> ios setup </a></ol><li><input id=sidebar-input-keyboards type=checkbox> <label class=h3 for=sidebar-input-keyboards>keyboards</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/keyboards/moergo glove80/"> moergo glove80 </a></ol><li><input id=sidebar-input-lang type=checkbox> <label class=h3 for=sidebar-input-lang>lang</label> <ol><li><input id=sidebar-input-lang-ats type=checkbox> <label class=h3 for=sidebar-input-lang-ats>ATS</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/ATS2 Notes/"> ATS2 Notes </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/ATS/Install ATS2/"> Install ATS2 </a></ol><li><input id=sidebar-input-lang-flutter type=checkbox> <label class=h3 for=sidebar-input-lang-flutter>flutter</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/dart lang/"> dart lang </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/flutter/flutter setup/"> flutter setup </a></ol><li><input id=sidebar-input-lang-rust type=checkbox> <label class=h3 for=sidebar-input-lang-rust>rust</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/optimizing binary size/"> optimizing binary size </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rr with rust/"> rr with rust </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust verification tools/"> rust verification tools </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/rust x SGX/"> rust x SGX </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/self-referencing structs/"> self-referencing structs </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/sycamore x futures/"> sycamore x futures </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/rust/understanding sycamore reactivity/"> understanding sycamore reactivity </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/gdb ref/"> gdb ref </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/koka-lang/> koka-lang </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/lang/lua/> lua </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/lang/operator fixity and precedence/"> operator fixity and precedence </a></ol><li><input id=sidebar-input-management type=checkbox> <label class=h3 for=sidebar-input-management>management</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/management/relieve often - why generals were more successful in WWII/"> relieve often - why generals were more successful in WWII </a></ol><li><input id=sidebar-input-misc type=checkbox> <label class=h3 for=sidebar-input-misc>misc</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/arm target triples/"> arm target triples </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/envsubst/> envsubst </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/git multirepo to monorepo/"> git multirepo to monorepo </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/kintsugi/> kintsugi </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/optimization solvers/"> optimization solvers </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/pop_OS! tweaks/"> pop_OS! tweaks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/prepping RPI for embedded dev/"> prepping RPI for embedded dev </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/misc/rgbxmas/> rgbxmas </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/scanning QR codes on desktop/"> scanning QR codes on desktop </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/setting up a headless raspbian boot image/"> setting up a headless raspbian boot image </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/uptime to downtime conversion/"> uptime to downtime conversion </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/misc/water distillation setup/"> water distillation setup </a></ol><li><input id=sidebar-input-networking type=checkbox> <label class=h3 for=sidebar-input-networking>networking</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/networking/CIDR/> CIDR </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/ipv6 address space/"> ipv6 address space </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interface card (NIC)/"> network interface card (NIC) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/networking/network interfaces/"> network interfaces </a></ol><li><input id=sidebar-input-nvim type=checkbox> <label class=h3 for=sidebar-input-nvim>nvim</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/nvim/universal-ctags Notes/"> universal-ctags Notes </a></ol><li><input id=sidebar-input-performance type=checkbox> <label class=h3 for=sidebar-input-performance>performance</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/bit hacks/"> bit hacks </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/dtrace on macOS/"> dtrace on macOS </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/performance/profiling/> profiling </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/performance/simdjson talk/"> simdjson talk </a></ol><li><input id=sidebar-input-postgres type=checkbox> <label class=h3 for=sidebar-input-postgres>postgres</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/postgres performance tuning/"> postgres performance tuning </a><li class=sidebar-note><a class="notes-link link-internal" href=https://phlip9.com/notes/postgres/snippets/> snippets </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/postgres/types of scans/"> types of scans </a></ol><li><input id=sidebar-input-reproducible-builds type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds>reproducible builds</label> <ol><li><input id=sidebar-input-reproducible-builds-nix type=checkbox> <label class=h3 for=sidebar-input-reproducible-builds-nix>nix</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/links/"> links </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix auto-allocate-uids -> nixbld users/"> nix auto-allocate-uids -> nixbld users </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug broken package build/"> nix debug broken package build </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/nix/nix debug spurrious rebuilds/"> nix debug spurrious rebuilds </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/earthly/"> earthly </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/rebuilderd/"> rebuilderd </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/reproducible builds/reproducible-builds.org/"> reproducible-builds.org </a></ol><li><input id=sidebar-input-router type=checkbox> <label class=h3 for=sidebar-input-router>router</label> <ol><li><input id=sidebar-input-router-lightning-router type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router>lightning router</label> <ol><li><input id=sidebar-input-router-lightning-router-captive-portal type=checkbox> <label class=h3 for=sidebar-input-router-lightning-router-captive-portal>captive portal</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/RFC 6585 (Additional HTTP Status Codes)/"> RFC 6585 (Additional HTTP Status Codes) </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/arubanetworks captive portal/"> arubanetworks captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal/"> captive portal </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/captive portal/captive portal (wikipedia)/"> captive portal (wikipedia) </a></ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/router/lightning router/lightning router overview/"> lightning router overview </a></ol></ol><li><input id=sidebar-input-statistics-probability type=checkbox> <label class=h3 for=sidebar-input-statistics-probability>statistics probability</label> <ol><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/CDF confidence bands - DKW inequality/"> CDF confidence bands - DKW inequality </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/G-test - multinomial goodness-of-fit/"> G-test - multinomial goodness-of-fit </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/MAD - median absolute deviation/"> MAD - median absolute deviation </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/cheat sheet/"> cheat sheet </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/herbie - float error fixer/"> herbie - float error fixer </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/kelly criterion + ELO/"> kelly criterion + ELO </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/multinomial distribution/"> multinomial distribution </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/p-value/"> p-value </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/standard error/"> standard error </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/testing whether a coin is fair/"> testing whether a coin is fair </a><li class=sidebar-note><a class="notes-link link-internal" href="https://phlip9.com/notes/statistics probability/winsorize/"> winsorize </a></ol></ol></nav></div><nav aria-label="Secondary navigation" class="notes-toc d-none d-xl-block col-xl-4"><div class=page-links><h3 class=text-muted>on this page</h3><nav id=table-of-contents><ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#enarx-wasm-tee" class=link-internal>enarx (WASM TEE)</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#tee" class=link-internal>TEE</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#enarx" class=link-internal>Enarx</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#components" class=link-internal>Components</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#threat-model" class=link-internal>Threat Model</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#attestation" class=link-internal>Attestation</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#amd-sev-remote-attestation-protocol" class=link-internal>AMD SEV Remote Attestation Protocol</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#goal" class=link-internal>Goal</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#message-formats" class=link-internal>Message Formats</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#sequence-diagram" class=link-internal>Sequence Diagram</a></ul></ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#syscall-proxy" class=link-internal>Syscall Proxy</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#existing-systems" class=link-internal>Existing Systems</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#the-plan" class=link-internal>The Plan</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#syscall-categories-and-their-layers" class=link-internal>Syscall Categories and their Layers</a></ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#faq" class=link-internal>FAQ</a> <ul><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#why-not-do-containers" class=link-internal>Why not do containers?</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#will-enarx-offer-protection-against-side-channel-attacks" class=link-internal>Will Enarx offer protection against side-channel attacks?</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#tee-vs-tpm" class=link-internal>TEE vs TPM</a><li><a href="https://phlip9.com/notes/confidential computing/enarx (WASM TEE)/#tee-vs-hsm" class=link-internal>TEE vs HSM</a></ul></ul></ul></nav></div></nav><main class="notes-content tags-content col-lg-11 col-xl-8"><h1 id=enarx-wasm-tee>enarx (WASM TEE)</h1><p class=text-muted>2022-02-17 · 13 min read<ul class=tags><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/confidential-computing/>#confidential-computing</a><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/sgx/>#sgx</a><li><a class="btn btn-outline-primary btn-sm link-internal" href=https://phlip9.com/notes/tags/libos/>#libOS</a></ul><p>site: <a href=https://enarx.dev>https://enarx.dev</a><h2 id=tee>TEE <a aria-label="anchor link" class=anchor-link href=#tee> # </a></h2><blockquote><p>Trusted Execution Environments (TEEs) allow organizations to run applications within a set of memory pages that are encrypted with a secret key by the host CPU in such a way that these pages are not accessible to the operating system or any other software, even running at the highest privilege level.<p>There are currently two leading models of TEEs:<ul><li><strong>Process-based:</strong> current implementations include <strong>Intel’s SGX</strong> (Software Guard eXtensions).<li><strong>VM-based:</strong> current implementations include <strong>AMD’s SEV</strong> (Secure Encrypted Virtualization).</ul><p><strong>Applications</strong> that need to run in a TEE must be <strong>developed specifically for each platform</strong>, and they differ significantly depending if it’s a process-based or VM-based TEE model. Additionally, they must implement something called attestation, which is a validation process for the TEE to prove that it’s genuine before it can be trusted by the application. Rewriting the application or the custom VMM that runs it, as well as the attestation, for each hardware platform is <strong>extremely complex and time-consuming</strong>.<p>In the next section, we will introduce <strong>Enarx</strong>, an open source <strong>framework for running applications in TEEs</strong> that addresses many of the issues raised. We’ll give a simplified overview of the component architecture of Enarx (and how it allows for support for multiple hardware platforms) and the process of creating and deploying applications to TEE instances using Enarx.</blockquote><h2 id=enarx>Enarx <a aria-label="anchor link" class=anchor-link href=#enarx> # </a></h2><blockquote><p><strong>Enarx</strong> is a <strong>framework</strong> for running applications in <strong>TEE instances</strong> – which we refer to as “<strong>Keeps</strong>”–without the need to trust lots of dependencies, <strong>without the need to rewrite the application</strong>, and <strong>without the need to implement attestation separately</strong>.<p>Enarx aims to minimize the trust relationships required when executing applications, meaning that the only components which need to be trusted are: the CPU and associated firmware, the workload itself, and the Enarx middleware, which is fully open source and auditable. Applications run without any of the layers in the stack (e.g. hypervisor, kernel, user-space) being able to look into or alter the Keep or its contents.<p>It <strong>provides a WebAssembly runtime, based on wasmtime</strong>, offering developers a wide range of language choices for implementation, including Rust, C, C++, C#, Go, Java, Python and Haskell. It is designed to work across silicon architectures transparently to the user so that the <strong>application can run</strong> equally simple <strong>on Intel platforms</strong> (SGX or the recently-announced TDX), <strong>AMD platforms (SEV)</strong> or forthcoming platforms such as <strong>Arms’ Realms</strong> and <strong>IBM’s PEF</strong> - all <strong>without having to recompile</strong> the application code.<p>Enarx is CPU-architecture independent, enabling the same application code to be deployed across multiple targets, abstracting issues such as cross-compilation and differing attestation mechanisms between hardware vendors.<p>Enarx provides attestation, packaging and provisioning of the application to take place in a way which is transparent to the user. Every instance of an application goes through three steps:<ul><li><strong>Attestation:</strong> Enarx checks that the <strong>host</strong> to which you’re planning to deploy is a <strong>genuine TEE instance</strong>.<li><strong>Packaging:</strong> Once the attestation is complete and the TEE instance verified, the Enarx management component <strong>encrypts the application and any required data</strong>.<li><strong>Provisioning:</strong> Enarx then sends the application and data along to the host for execution in the Enarx Keep.</ul><p>At no point is the host system able to look inside or change the code or data within a Keep. Thus, Enarx allows organizations with sensitive code or data to run their applications with strong integrity and confidentiality protections.</blockquote><h2 id=components>Components <a aria-label="anchor link" class=anchor-link href=#components> # </a></h2><p><img alt="Enarx component details image" src=https://raw.githubusercontent.com/enarx/enarx.github.io/main/static/assets/images/enarx-component-detail.png><h2 id=threat-model>Threat Model <a aria-label="anchor link" class=anchor-link href=#threat-model> # </a></h2><p><img alt='A representation of a computing stack, with "CPU | Firmware" at the bottom and "Application" and "Middleware" at the top. The other six middle layers in between are crossed out.' src=https://raw.githubusercontent.com/enarx/enarx.github.io/main/static/assets/images/enarx-trust-stack.png><p><img alt="Enarx trust architecture (VM case)" src=https://raw.githubusercontent.com/enarx/enarx.github.io/main/static/assets/images/trust-architecture.png><blockquote><p>Enarx provides four layers in the run-time stack. Working from the lowest up, they are:<ol><li>a <strong>VMM</strong> (Virtual Memory Manager)<li>a <strong>microkernel</strong> (μkernel)<li>a <strong>WASM runtime</strong> (WebAssembly)<li>a <strong>WASI</strong> implementation (WebAssembly <strong>System Interface</strong>).</ol></blockquote><h2 id=attestation>Attestation <a aria-label="anchor link" class=anchor-link href=#attestation> # </a></h2><p>An application which is going to run in an <strong>Enarx Keep needs to attest two thing</strong>s:<ol><li>The <strong>hardware TEE providing Keeps</strong>.<li><strong>A measurement of the Enarx runtime</strong>. This means that Red Hat may need to launch a service to abstract attestation. The way that this works is that the client requests attestation from Enarx. Enarx supplies a blob. The client forwards this to Red Hat. Red Hat will then complete attestation of the h/w environment and translate the measurements of Enarx into a something which allows you to identify the specific version of Enarx.</ol><p><em>(??? what is Red Hat in this case? the abstract cloud provider? is "requests from Enarx" like request from a local library, or actually hitting an API??)</em><p>From the client’s point of view, the attestation steps of Enarx end up with the following two cryptographically validated assertions:<ol><li>The <strong>TEE type and version</strong>;<li>The <strong>Enarx version and integrity</strong>. The <strong>attestation processes associated with the various hardware architectures are very different</strong> (see <a href=https://enarx.dev/docs/Technical/AMD-SEV>SEV architectural</a> and <a href=https://enarx.dev/docs/Technical/Intel-SGX>SGX architectural</a>): providing a common mechanism to abstract this is expected to be a major part of the work associated with this project.</ol><p><img alt="Simplified Enarx process flow" src=https://raw.githubusercontent.com/enarx/enarx.github.io/main/static/assets/images/simplified-enarx-flow.png><h3 id=amd-sev-remote-attestation-protocol>AMD SEV Remote Attestation Protocol <a aria-label="anchor link" class=anchor-link href=#amd-sev-remote-attestation-protocol> # </a></h3><h4 id=goal>Goal <a aria-label="anchor link" class=anchor-link href=#goal> # </a></h4><p>This protocol allows a <strong>tenant</strong> to:<ol><li><strong>Verify the platform certificate chain belonging to the remote host</strong> where the Enarx Keep is constructed<li>Establish a <strong>secure channel with the remote CPU</strong> AMD Secure Processor (AMD SP) on the remote host<li><strong>Compare</strong> its own <strong>measurement</strong> of the <strong>guest's initial state</strong> <strong>with</strong> the AMD SP's <strong>measurement from the untrusted host</strong><li>Safely <strong>deliver</strong> its <strong>workload</strong> to the AMD SP</ol><p>This protocol maps the regular SEV launch procedure onto a simple client-server model (<strong>client sends request to server; server sends its response to client</strong>). In fact, the message formats are comprised of data structures defined in the AMD SEV specification.<p>It is a short, serialized exchange. More importantly, however, it is <strong>meant to be an “atomic” transaction</strong>. What this means is that the client and the backend complete attestation successfully in this exchange or they don’t. There are no “in-between” end conditions. Therefore, neither party should have any expectation of “retrying” a previous step. It is <strong>always forward progress or none at all</strong>. As the orchestrator, it is the <strong>Keep Manager’s responsibility to know if the keep becomes defunct during attestation, launch, or normal operation</strong>. It is expected that the Keep Manager will inform the client of an appropriate error condition and tear down the defunct Keep if necessary.<h4 id=message-formats>Message Formats <a aria-label="anchor link" class=anchor-link href=#message-formats> # </a></h4><p>The data structures defined in the SEV specification form the substrate for this protocol. As a result, message payloads are binary structures. The messages for this protocol are <strong><a href=http://cbor.io/>CBOR-encoded</a></strong>. They will be represented here in <a href=https://tools.ietf.org/html/rfc8610>Concise Data Definition Language (CDDL)</a>.<pre class=language-cbor data-lang=cbor style=background-color:#2b303b;color:#c0c5ce;><code class=language-cbor data-lang=cbor><span>message = {
</span><span>      certificate-chain-naples //
</span><span>      certificate-chain-rome //
</span><span>      launch-start //
</span><span>      measurement //
</span><span>      secret //
</span><span>      finish
</span><span>}
</span><span>
</span><span>certificate-chain-naples = (
</span><span>      "ark": certificate-ca-small,
</span><span>      "ask": certificate-ca-small,
</span><span>      "pdh": certificate-sev,
</span><span>      "pek": certificate-sev,
</span><span>      "oca": certificate-sev,
</span><span>      "cek": certificate-sev,
</span><span>)
</span><span>
</span><span>certificate-chain-rome = (
</span><span>      "ark": certificate-ca-large,
</span><span>      "ask": certificate-ca-large,
</span><span>      "pdh": certificate-sev,
</span><span>      "pek": certificate-sev,
</span><span>      "oca": certificate-sev,
</span><span>      "cek": certificate-sev,
</span><span>)
</span><span>
</span><span>launch-start = (
</span><span>      "policy": policy,
</span><span>      "pdh": certificate-sev,
</span><span>      "session": session,
</span><span>)
</span><span>
</span><span>measurement = (
</span><span>      "build": build,
</span><span>      "measurement": bytes .size 32,
</span><span>      "nonce": bytes .size 16,
</span><span>)
</span><span>
</span><span>secret = (
</span><span>      "header": {
</span><span>            "iv": bytes .size 16,
</span><span>            "mac": bytes .size 32,
</span><span>      },
</span><span>      "ciphertext": bytes,
</span><span>)
</span><span>
</span><span>finish = /* TODO */
</span><span>
</span><span>version = (
</span><span>      "major": uint .size 1,
</span><span>      "minor": uint .size 1,
</span><span>)
</span><span>
</span><span>build = (
</span><span>      "version": version,
</span><span>      "build": uint .size 1,
</span><span>)
</span><span>
</span><span>policy = (
</span><span>      "flags": uint .size 2,
</span><span>      "minfw": version,
</span><span>)
</span><span>
</span><span>session = (
</span><span>      "nonce": bytes .size 16,
</span><span>      "wrap_tk": bytes .size 32,
</span><span>      "wrap_iv": bytes .size 16,
</span><span>      "wrap_mac": bytes .size 32,
</span><span>      "policy_mac": bytes .size 32,
</span><span>)
</span></code></pre><h4 id=sequence-diagram>Sequence Diagram <a aria-label="anchor link" class=anchor-link href=#sequence-diagram> # </a></h4><p><img alt="message sequence diagram" src=https://raw.githubusercontent.com/wiki/enarx/enarx/images/amd-sev-remote-attestation.svg><h2 id=syscall-proxy>Syscall Proxy <a aria-label="anchor link" class=anchor-link href=#syscall-proxy> # </a></h2><p>Enarx needs to support Keeps that are built on encrypted virtual machine technologies such as AMD SEV and IBM Power PEF. This means that we <strong>need to boot an operating system inside the guest VM</strong>. However, <strong>existing operating systems do not meet the Enarx design principles</strong> (especially: minimal trusted computing base [TCB], external network stack and memory safety). Therefore, this page outlines a <strong>plan for building a minimal OS</strong> which intends to service only the minimal requirements to run Enarx.<h3 id=existing-systems>Existing Systems <a aria-label="anchor link" class=anchor-link href=#existing-systems> # </a></h3><p>A traditional virtualization stack (such as Qemu + Linux) is typically composed of four components:<ol><li>The Virtual Machine Manager (e.g. Qemu)<li>The VM BIOS / Firmware (e.g. OVMF)<li>The Guest Bootloader<li>The Guest Kernel</ol><h3 id=the-plan>The Plan <a aria-label="anchor link" class=anchor-link href=#the-plan> # </a></h3><p>In order to remove these problems, Enarx plans to produce three components when running in a VM-based TEE:<ol><li>The <strong>Enarx VMM</strong><li>The <strong>Enarx μKernel</strong><li>The <strong>Enarx Userspace WASM / WASI Runtime</strong></ol><p>These three components will be tightly coupled and shipped as an integrated system. The interfaces between the components will be considered an internal implementation detail that can be changed at any time. <strong>Enarx tenants will validate</strong> the cryptographic measurement of <strong>the three component</strong>s (VMM Guest Memory Setup, μKernel and Userspace Runtime) <strong>as a single unit</strong> to reduce combinatorial complexity.<p><img alt="Enarx Syscall Proxy" src=https://enarx.dev/assets/images/syscall_proxy-54262c4d74e0cf9ec3b0f7812d5539ee.svg><p>In order to keep the TCB small, especially the exclusion of a full network stack, <strong>we intend to proxy syscalls to the host.</strong> This allows us to use as many of the host resources as possible while maintaining a small Keep size. It also <strong>allows for performance optimizations</strong> as Enarx gets more mature. The above chart shows a full trace of a single syscall across the various components. This works as follows:<ol><li><p><strong>An Enarx application</strong>, compiled to WebAssembly, <strong>makes a WASI call</strong>, for example: <code>read()</code>. This causes a <strong>transition from the JIT-compiled code into our guest userspace Rust</strong> code. This does <strong>not</strong> entail <strong>a full context switch</strong> and should be <strong>fast</strong>.</p><li><p>The hand-crafted Rust code should <strong>translate the WASI call into a Linux <code>read()</code> syscall</strong>. From here we leave Ring 3 (on <code>x86</code>; other architectures have similar structures) and <strong>jump into the μKernel</strong>, performing a context switch. At this point, <strong>some syscalls will be handled internally by the μKernel</strong>, for example, memory allocation where the virtual machine has sufficiently allocated pages to handle the request immediately.</p><li><p>All syscalls which cannot be handled internally by the μKernel must be passed to the host, so the <strong>guest μKernel passes the syscall request to the host (Linux) kernel</strong>. As an optimization, some syscalls may be handled by the host (Linux) kernel directly. For example, <code>read()</code> of a socket can be handled immediately by the host kernel, avoiding future context switches. This requires the (future) development of a Linux kernel module to handle these request directly in the host kernel. Since this is an optimization step, we can wait until the interfaces have settled before pursuing this.</p><li><p>All syscalls which cannot be handled internally by the host kernel must <strong>cause a <code>vmexit</code> in the host VMM</strong>. For example, a request for additional pages to be mapped into the guest must be passed to the VMM since that is the component which manages the allocated pages. Like previous layers, any syscalls which can be handled directly in the VMM (for example allocation from a pre-allocated memory pool) should be handled immediately to avoid future context switches.</p><li><p><strong>In some cases, the VMM will have to re-enter the host kernel in order to fulfil the request</strong>. This is the <strong>slowest</strong> performance path and should be avoided wherever possible.</p></ol><h3 id=syscall-categories-and-their-layers>Syscall Categories and their Layers <a aria-label="anchor link" class=anchor-link href=#syscall-categories-and-their-layers> # </a></h3><ul><li><p><strong>Memory Allocation:</strong> Memory allocation syscalls should be <strong>served by the μKernel from pre-allocated pools of huge pages</strong>. Allocation of huge pages should be passed through to the host layers.</p><li><p><strong>Networking</strong>: All networking syscalls should be <strong>passed to the host layers</strong>. This ensures that the network stack lives outside the TCB.</p><li><p><strong>Filesystem</strong>: The <strong>guest μKernel should implement a filesystem on top of block encryption and authentication</strong>. Block IO should be passed to the host layers. It may even be possible to implement this functionality directly in userspace to reduce the number of context switches. Block authentication, block encryption and the filesystem should be implemented as reusable crates for use in other (non-VM-based keep) contexts.</p><li><p><strong>Threading</strong>: Techniques like NUMA are extremely hard to implement. Therefore, the <strong>μKernel should pass this to the host layers where possible</strong>. One particular strategy to accomplish this is to perform vCPU hotplug. When a new thread is created in the guest userspace, a new vCPU is created by the VMM. Therefore there is always a 1:1 mapping between userspace threads and vCPUs. The guest μKernel can pool pre-allocated vCPUs to increase performance.</p></ul><h2 id=faq>FAQ <a aria-label="anchor link" class=anchor-link href=#faq> # </a></h2><h3 id=why-not-do-containers>Why not do containers? <a aria-label="anchor link" class=anchor-link href=#why-not-do-containers> # </a></h3><p>Would it be possible to implement containers within TEEs? That depends somewhat on the TEE implementation, but the answer is a <strong>"kind of yes"</strong>. However, when you run containers on a host, the <strong>interactions that the container runtime has with the host leak all sorts of information</strong> that we really don't want to be making available to it. One of the design goals of Enarx is to reduce the number of layers that you need to trust, so this isn't a great fit. We know that containers are great, and one of the interesting sets of questions around Enarx revolves around exactly how you orchestrate Keeps, but whatever that looks like, we won't be doing something which meets the specification for containers, for the reasons outlined above.<p>(wish they were a bit more specific about this)<h3 id=will-enarx-offer-protection-against-side-channel-attacks>Will Enarx offer protection against side-channel attacks? <a aria-label="anchor link" class=anchor-link href=#will-enarx-offer-protection-against-side-channel-attacks> # </a></h3><p>The short answer is <strong>yes, where possible.</strong> To expand on this, first of all this is only a goal for now, as we won't be focusing our efforts on it immediately given we are still working on core functionality. Secondly, it is likely to be impossible to mitigate all side-channel attacks, but we certainly will attempt to do so where possible, as part of our aim to make Enarx Keeps as secure as possible.<h3 id=tee-vs-tpm>TEE vs TPM <a aria-label="anchor link" class=anchor-link href=#tee-vs-tpm> # </a></h3><p>You could implement many of the capabilities of a TPM within a TEE, but it doesn't make sense to create a "full" TPM implementation within a TEE on two levels:<ul><li>One of the key points of a TPM is that it's linked to the hardware, meaning that the boot sequence can be tied into PCRs (Platform Configuration Registers). <strong>TEEs aren't necessarily suitable as Hardware-Based Roots of Trust</strong>.<li><strong>Enarx provides a general processing environment</strong>. The capabilities of a TPM are carefully scoped, and to meet the requirements of the TCG (Trusted Computing Group, the standards body for TPMs), you need to implement these very carefully.</ul><h3 id=tee-vs-hsm>TEE vs HSM <a aria-label="anchor link" class=anchor-link href=#tee-vs-hsm> # </a></h3><p><strong>HSM's provide higher levels of protection than TEEs</strong>, but are separate modules, accessed via PCI bus, network, etc. TEEs are integral to the CPU packages on a motherboard. <strong>Both HSMs and TEE instances can be used as general-function processing units</strong> (depending on the model), and both can be programmed for particular uses (e.g. PKCS#11 modules). The <strong>cost of HSMs is high</strong> (typically thousands of dollars), whereas TEEs are integral to a chipset. The work to <strong>program an HSM is difficult</strong>.</main></div></div></div><form class=d-none id=search-bar><div class=container><div class="row justify-content-center"><div class="col col-lg-11 col-xl-9" id=search-container><input aria-label="Search notes..." class="form-control is-search" placeholder="Search notes..." autocomplete=off id=userinput type=search><div class="shadow rounded" id=suggestions></div></div></div></div></form><script defer src=https://phlip9.com/notes/js/elasticlunr.min.js></script><script defer src=https://phlip9.com/notes/search_index.en.js></script><script defer src=https://phlip9.com/notes/js/search.js></script>